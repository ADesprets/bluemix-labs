<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>IBM API Connect V10.0.x</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article toc2 toc-left data-line-1">
<div id="header">
<h1>IBM API Connect V10.0.x</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of contents</div>
<ul class="sectlevel1">
<li><a href="#_api_connect_architecture_concepts_and_practice">API Connect: Architecture, Concepts and practice</a></li>
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_objectives">Objectives</a></li>
<li><a href="#_pre_requisites">Pre-Requisites</a></li>
<li><a href="#_goals_of_api_connect_main_use_cases">Goals of API Connect, main use cases</a>
<ul class="sectlevel2">
<li><a href="#_main_use_cases">Main use cases</a></li>
<li><a href="#_where_apis_are_used_in_companies">Where APIs are used in companies?</a></li>
</ul>
</li>
<li><a href="#_architecture_and_terminology">Architecture and terminology</a>
<ul class="sectlevel2">
<li><a href="#_api_connect_architecture">API Connect architecture</a></li>
<li><a href="#_terminology">Terminology</a></li>
<li><a href="#_concepts_maps">Concepts maps</a></li>
<li><a href="#_some_design_principles_of_api_connect">Some design principles of API Connect</a></li>
<li><a href="#_topologies_and_multitenancy_aspects">Topologies and multitenancy aspects</a></li>
<li><a href="#_a_word_on_quorum">A word on quorum</a></li>
<li><a href="#_policies">Policies</a></li>
</ul>
</li>
<li><a href="#_lifecycle_of_a_product">Lifecycle of a Product</a></li>
<li><a href="#_roles">Roles</a></li>
<li><a href="#_overall_design_of_the_lab">Overall design of the lab</a></li>
<li><a href="#_steps_for_the_lab">Steps for the lab</a>
<ul class="sectlevel2">
<li><a href="#_step_1_check_the_development_environment">Step 1 - Check the development environment</a></li>
<li><a href="#_step_2_expose_an_existing_rest_api">Step 2 - Expose an existing REST API</a></li>
<li><a href="#_step_3_creating_and_publishing_a_product">Step 3 - Creating and publishing a Product</a></li>
<li><a href="#_step_4_consumer_experience">Step 4 - Consumer Experience</a></li>
<li><a href="#_step_5_invoke_the_api">Step 5 - Invoke the API</a></li>
<li><a href="#_step_6_analytics">Step 6 - Analytics</a></li>
<li><a href="#_step_7_create_a_soap_api">Step 7 - Create a SOAP API</a></li>
<li><a href="#_step_8_create_a_soap_to_rest_api">Step 8 - Create a SOAP to REST API</a></li>
<li><a href="#_step_9_create_a_cloudant_service">Step 9 - Create a Cloudant service</a></li>
<li><a href="#_step_10_create_a_loopback_application">Step 10 - Create a LoopBack application</a></li>
<li><a href="#_step_11_manage_your_api_in_api_designer">Step 11 - Manage your API in API Designer</a></li>
<li><a href="#_step_12_using_oauth_to_protect_your_api">Step 12 - Using OAuth to protect your API</a></li>
<li><a href="#_step_13_testing_the_quality_of_your_api">Step 13 - Testing the quality of your API</a></li>
<li><a href="#_step_14_cicd_integration">Step 14 - CI/CD integration</a></li>
<li><a href="#_additional_resources">Additional Resources</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1 data-line-35">
<h2 id="_api_connect_architecture_concepts_and_practice">API Connect: Architecture, Concepts and practice</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1 data-line-40">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph data-line-42">
<p>This article is the updated version for V10. The original versions were addressing V5 and V2018 and can be found here V5/V2018. V10 has the same base code as V2018. So there is not much disruption and the transition from V2018 to V10 is pretty easy. The V10 focus has been a lot of enhancements regarding performance of the user interfaces. In fact, the development team has adopted new ways of working to address performances aspects from the design phase up to the deployment phase. Changes in the organization, in the build, in the tests, etc&#8230;&#8203; In a few words, V10 is addressing user experience improvements adopting a new graphical chart, and new interactions, improved search feature, creation of GraphQL APIs, new tests tab in the assembly for improved debugging, enhancement to Gateway server extensions, dynamic API actions when creating user-defined policies and upgrade to use Loopback V4 in the developer toolkit.</p>
</div>
<div class="admonitionblock note data-line-44">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This is a Kubernetes installation with IBM API Connect V10.0.1.x (LTS). It will be updated as much as possible to follow the new versions of API Connect.
The version V10.0.0.0 is out since 29th May 2020. This lab is based on the on-premise version, it can be installed anywhere.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-47">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
For any comments, please send an email to <a href="mailto:arnauld_desprets@fr.ibm.com" data-href="mailto:arnauld_desprets@fr.ibm.com">arnauld_desprets@fr.ibm.com</a> (Arnauld Desprets).
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1 data-line-49">
<h2 id="_objectives">Objectives</h2>
<div class="sectionbody">
<div class="ulist data-line-50">
<ul>
<li class="data-line-50">
<p>Goals of API Connect, main use cases (Presentation)</p>
</li>
<li class="data-line-51">
<p>Basics on the architecture of the API Connect v10 and terminology useful with API Connect (Presentation)</p>
</li>
<li class="data-line-52">
<p>Installation (Presentation)</p>
</li>
<li class="data-line-53">
<p>Use API Connect</p>
<div class="ulist data-line-54">
<ul>
<li class="data-line-54">
<p>Create and test a REST API definition (Lab)</p>
</li>
<li class="data-line-55">
<p>Publish an API to Bluemix (Lab)</p>
</li>
<li class="data-line-56">
<p>Subscribe to an API previously published and test in the portal (Lab)</p>
</li>
<li class="data-line-57">
<p>Create a simple LoopBack application to implement Microservice architecture (Lab)</p>
</li>
<li class="data-line-58">
<p>Version an API and deploy another version of an API (Lab)</p>
</li>
<li class="data-line-59">
<p>Create and manage a SOAP API (Lab)</p>
</li>
<li class="data-line-60">
<p>Basics about the command line apic to script recurring operations (Lab)</p>
</li>
<li class="data-line-61">
<p>Transformation JSON to SOAP (Lab)</p>
</li>
<li class="data-line-62">
<p>Extensive API and API Connect Platform security (Lab)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-64">
<h2 id="_pre_requisites">Pre-Requisites</h2>
<div class="sectionbody">
<div class="paragraph data-line-65">
<p>It is possible in IBM API Connect to either develop locally on a developer machine or develop directly in the Manager. The user experience is very similar in both cases. Developing locally provide the benefits of being able to directly use a source control management system such as Git.</p>
</div>
<div class="ulist data-line-67">
<ul>
<li class="data-line-67">
<p>Download the Designer</p>
</li>
<li class="data-line-68">
<p>Have an API Connect instance available (in our case an OpenShift 4.10 with V10.0.0. instance deployed) To perform some basic local testing, we will also use the LTE - Local Test Environment which allows to perform simple testing locally.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-70">
<p>There is no need to install the designer since this is a simple executable. For the Local Test environment, I&#8217;m using a Ubuntu desktop because it is simpler to use Docker on it rather than on Windows where there are some incompatibilities between Docker and VMWare. The installation of the LTE is explained here.</p>
</div>
<div class="paragraph data-line-72">
<p>Note: Hint: to find the various executable for a specific version, you can find all the link in the article called IBM API Connect is available. for example, you will find an articled called IBM API Connect V2018.4.1.13 is available here. In this article, you will find the content of the fix, the link to the various images usually in Fix Central and optionally the link to the LTE.</p>
</div>
</div>
</div>
<div class="sect1 data-line-74">
<h2 id="_goals_of_api_connect_main_use_cases">Goals of API Connect, main use cases</h2>
<div class="sectionbody">
<div class="paragraph data-line-75">
<p>This chapter does not intend to describe all the possible use cases of API Connect, but instead provide some simple and concrete common usages of API Connect.</p>
</div>
<div class="sect2 data-line-77">
<h3 id="_main_use_cases">Main use cases</h3>
<div class="olist arabic data-line-78">
<ol class="arabic">
<li class="data-line-78">
<p><strong>Use case 1</strong>: I have existing internal SOAP services and/or REST APIs. I want to expose and increase visibility internally and externally. I need to understand how my APIs/Services are used and apply quotas. I need to provide to secure the access.
Solution: Simple proxyfication, not complex policies, use OOTB portal, manager.</p>
</li>
<li class="data-line-80">
<p><strong>Use case 2</strong>: All the above + my APIs/services do not have the right granularity or the right format to be used by my Apps.
Solution: Use map policies to adapt the interfaces, and/or use JSON &lt;&#8594; XML policies with a powerful versioning management.</p>
</li>
<li class="data-line-82">
<p><strong>Use case 3</strong>: I organise a hackathon or I&#8217;m in context of co-creation with extended eco-system and I need to rapidly create APIs from data sources or from models.
Solution: Create Loopback Applications and expose them as APIs. Cloud workload are good candidates.</p>
</li>
<li class="data-line-84">
<p><strong>Use case 4</strong>: I need some kind of composition/aggregation and expose an API.
Solution: Create a Loopback Application and add remote hook</p>
</li>
</ol>
</div>
</div>
<div class="sect2 data-line-87">
<h3 id="_where_apis_are_used_in_companies">Where APIs are used in companies?</h3>
<div class="paragraph data-line-89">
<p>Here is the result of Forrester study, performed in February 2017.</p>
</div>
<div class="imageblock data-line-91">
<div class="content">
<img src="../images/ForresterStudy.png" alt="Forrester Study">
</div>
</div>
<div class="paragraph data-line-93">
<p>Fig. 1: Forrester use cases study</p>
</div>
<div class="paragraph data-line-95">
<p>As you can see a lot of projects are using API internally and the very visible part, the public projects represents 35%.</p>
</div>
<div class="paragraph data-line-97">
<p>Read the full study: The Total Economic Impact™ of an API Management Solution <a href="http://ibm.biz/APICTEIstudy" class="undefined" data-href="http://ibm.biz/APICTEIstudy">http://ibm.biz/APICTEIstudy</a> The Forrester Wave™: API Management Solutions, Q3 2020: <a href="https://www.forrester.com/report/The+Forrester+Wave+API+Management+Solutions+Q3+2020/-/E-RES159081?objectid=RES159081#" class="undefined" data-href="https://www.forrester.com/report/The+Forrester+Wave+API+Management+Solutions+Q3+2020/-/E-RES159081?objectid=RES159081#">https://www.forrester.com/report/The+Forrester+Wave+API+Management+Solutions+Q3+2020/-/E-RES159081?objectid=RES159081#</a></p>
</div>
<div class="paragraph data-line-99">
<p>The deployment of API Connect are usually as follow:</p>
</div>
<div class="ulist data-line-101">
<ul>
<li class="data-line-101">
<p>One non production API Connect Cloud use to test the product, the API, perform update of new version of API Connect before going to Production. Use of several catalogs for several purpose (Development, tests, QA, &#8230;&#8203;). Those instances are used to test API Connect, the API, perform update of new versions of API Connect before going to Production. Use of several catalogs for several purpose (Development, tests, QA, &#8230;&#8203;)</p>
</li>
<li class="data-line-102">
<p>One production API Connect Cloud for on-premise with a set of internal gateways and a set for external gateways.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1 data-line-104">
<h2 id="_architecture_and_terminology">Architecture and terminology</h2>
<div class="sectionbody">
<div class="sect2 data-line-105">
<h3 id="_api_connect_architecture">API Connect architecture</h3>
<div class="sect3 data-line-106">
<h4 id="_components_in_ibm_api_connect_v10">Components in IBM API Connect V10</h4>
<div class="paragraph data-line-107">
<p>The main components composing API Connect are:</p>
</div>
<div class="ulist data-line-109">
<ul>
<li class="data-line-109">
<p>The <strong>Gateway</strong> (IBM DataPower Gateway). The requests from apps are going through the gateway, security and policies are enforced and API events for the analytics are generated.</p>
</li>
<li class="data-line-110">
<p>The <strong>Analytics</strong> is a full Elastic Stack deployment. The analytics are closed to the clusters of gateways, they can be deployed in another separated environment along the gateways which requires colocalization for performance reasons. Notice that the Elastic Stack is partially optional, in the case, where you do already have your own instance of monitoring. In the case, where you really do not want to use the internal analytics then it is possible to only install the ingestion part.</p>
</li>
<li class="data-line-111">
<p>The <strong>Portal</strong>, an open-source Drupal CMS - Content Management System. For the API consumers (Apps developers), they create Apps and subscribe to API within the portal. Based on Drupal, it is highly customizable. In v2018, Drupal was updated to version 8.</p>
</li>
<li class="data-line-112">
<p>The <strong>Loopback runtime</strong> or micro services runtime. This is where the loopback applications are running. This component is originally coming from StrongLoop acquisition. Loopback applications can be created in minutes to expose data from SQL or NoSQL database and a good place to perform composition of APIs, especially if you do not have some ESB capabilities.</p>
</li>
<li class="data-line-113">
<p>Associated to the Loopback runtime is the <strong>Kubernetes</strong> that monitors the Loopback runtime and can provide advanced feature such as auto-scaling.</p>
</li>
<li class="data-line-114">
<p>The <strong>Designer</strong>, it offers the same web experience as the manager to manage APIs and allow development on the developer&#8217;s machine.</p>
</li>
<li class="data-line-115">
<p>The <strong>apic toolkit</strong>, really the CLI for APIC. API Connect is developed in a simple manner and accessible through REST/JSON API. So, the Web UI, the apic CLI are just using those REST API. From 2018, we have now a complete set of supported REST API, to configure initially the product (APIC Cloud), the Manager and the portal.</p>
</li>
<li class="data-line-116">
<p><strong>API Connect Test and Monitor</strong> can now be installed in a standalone mode, unlike V2018 where there was only a SaaS offering. It provides a no code solution to test the API with fined grained assertions.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-118">
<p>From an architecture point of view and it is important to consider that for HA the notion of quorum , and I would advise to have a good understanding of what are the implications. If you do not have a Kubernetes platform available, it is possible to use OVA that are encapsulating the Kubernetes environments. apic CLI encapsulate the kubectl command hiding the complexity of this platform. I would argue that even with OVA, it will be an advantage to understand Kubernetes and Docker principle. In V10 the product is enhanced to allow some configurations where only 2 members of API Connect components are necessary.</p>
</div>
<div class="paragraph data-line-120">
<p>Below a sample of deployment of API Connect on premise. System API is a generic term to define an API implementation, for example running in WAS Liberty (JAX-RS) or an API exposed on another layer such as an ESB.</p>
</div>
<div class="imageblock data-line-122">
<div class="content">
<img src="../images/v10.apic-archi-on-prem.png" alt="V10 APIC Architecture">
</div>
</div>
<div class="paragraph data-line-123">
<p>Fig. 2: V10 Architecture</p>
</div>
<div class="paragraph data-line-125">
<p>In more details some of the communications between each component in an OVA deployment non-HA. For more information, see the Required Ports between zones <a href="https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=deployment-firewall-requirements-vmware" data-href="https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=deployment-firewall-requirements-vmware">here</a> for OVA deployments or <a href="https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=deployment-firewall-requirements-kubernetes" data-href="https://www.ibm.com/docs/en/api-connect/10.0.1.x?topic=deployment-firewall-requirements-kubernetes">here</a> for Kubernetes deployments.</p>
</div>
<div class="imageblock data-line-127">
<div class="content">
<img src="../images/V2018OVADeploymentCommunications.png" alt="V10 APIC communications">
</div>
</div>
<div class="paragraph data-line-128">
<p>Fig. 3: Communications between components</p>
</div>
</div>
</div>
<div class="sect2 data-line-130">
<h3 id="_terminology">Terminology</h3>
<div class="ulist data-line-131">
<ul>
<li class="data-line-131">
<p>An <strong>Organization</strong>: It is the highest logical level of separation; it may provide multitenancy if required. An organization has its own catalog, members, resources, etc &#8230;&#8203; It is managed from the cloud console (not the manager).</p>
</li>
<li class="data-line-132">
<p>An <strong>API</strong>: Can be SOAP or REpresentational State Transfer - REST API defined with an Open API definition (Swagger) as a YAML file. One API = one yaml file though WSDLs and Schema are separated in a zip file for a SOAP API.</p>
</li>
<li class="data-line-133">
<p>A <strong>Plan</strong>: this is where we specify the quotas and if an approval is needed to subscribe to a Product/API.</p>
</li>
<li class="data-line-134">
<p>A <strong>Product</strong>: this is an aggregation of APIs and one or many plans associated to those APIs. This is what is published to a catalog. One Product = one yaml file.</p>
</li>
<li class="data-line-135">
<p>A <strong>Catalog</strong>: it&#8217;s relates to a cluster of gateways and a portal. It sounds like an environment, but it also contains a business dimension. For example, good names for a catalog are Sandbox, Dev, Production, CRM (for my CRM APIs exposed to a specific population), etc &#8230;&#8203;</p>
</li>
<li class="data-line-136">
<p>An API Connect <strong>Cloud</strong>: not to be confused with a cloud infrastructure/platform, it is a combination of gateways clusters, managers cluster, portal clusters and loopback applications runtimes. Usually a customer will have one, two, sometime three or more API Connect clouds, based on its organization and needs to separate the infrastructures.</p>
</li>
<li class="data-line-137">
<p><strong>Assembly panel</strong>: this is where we specify the policies to be executed in the gateway for each transaction.</p>
</li>
</ul>
</div>
</div>
<div class="sect2 data-line-139">
<h3 id="_concepts_maps">Concepts maps</h3>
<div class="paragraph data-line-140">
<p>Below the concepts related to the overall product. There are many ways to choose the right deployment based on requirements.</p>
</div>
<div class="olist arabic data-line-142">
<ol class="arabic">
<li class="data-line-142">
<p>How many APIC clouds? (usually between 1 and 3, driver: production separated or not from non-production and other environments)</p>
</li>
<li class="data-line-143">
<p>How many clusters of gateways? (separate instances, driver: usually security zones (DMZ or not and other zones))</p>
</li>
<li class="data-line-144">
<p>How many gateway services? (drivers: the number of clusters of gateways above and isolation)</p>
</li>
<li class="data-line-145">
<p>How many instances for each component? (how many instances of managers (usually 2 per APIC Cloud), instances of gateways (usually at least 2 depending on the traffic and high availability desired), instances of portals (usually 3 per APIC Cloud))</p>
</li>
<li class="data-line-146">
<p>How many organisations? (Drivers: Multi-tenancy and organisation of the company, segregation, governance)</p>
</li>
</ol>
</div>
<div class="imageblock data-line-148">
<div class="content">
<img src="../images/v2018.apic-ConceptsMap.png" alt="APIC Concepts">
</div>
</div>
<div class="paragraph data-line-150">
<p>Below the concepts related to the subscription of an App to a Plan within a product referring to all APIs or a set of APIs within that product.</p>
</div>
<div class="imageblock data-line-152">
<div class="content">
<img src="../images/subscription.png" alt="APIC Subscription">
</div>
</div>
<div class="paragraph data-line-154">
<p>Below the concepts related to the organisation of the user registries.</p>
</div>
<div class="imageblock data-line-156">
<div class="content">
<img src="../images/apic-registries2018.png" alt="APIC User Registries">
</div>
</div>
</div>
<div class="sect2 data-line-158">
<h3 id="_some_design_principles_of_api_connect">Some design principles of API Connect</h3>
<div class="ulist data-line-159">
<ul>
<li class="data-line-159">
<p>1 API = 1 YAML file &#8658; simplifies the management of the API (CI/CD). No need for fat client and policies to manage externally</p>
</li>
<li class="data-line-160">
<p>1 Product = 1 YAML file &#8658; simplifies the management of the Products (CI/CD)</p>
</li>
<li class="data-line-161">
<p>API First, the manager is based on a set of core API that are encapsulated for the CLI, used by the Web UI, and can also be called directly (full documentation) &#8658; simplifies the integration with CI/CD tooling. The other components also offers interfaces for example the gateway has REST/SOAP/SNMP/CLI interfaces, Drupal has its own API.</p>
</li>
<li class="data-line-162">
<p>Microservices architecture based on Docker/Kubernetes &#8658; simplifies deployments in any cloud. We also encapsulate the Kubernetes clusters of each component in OVA if needed (OVA = VMWare Open Virtual Appliance)</p>
</li>
<li class="data-line-163">
<p>Multi cloud and hybrid by nature: One cluster of Managers somewhere, as many clusters of gateways/portals instances/Elastic Stack instances anywhere. Communication based on HTTPS usually on 443. &#8658; simplifies installation and deployment. No difference types of gateways in the cloud or on-premise.</p>
</li>
<li class="data-line-164">
<p>Open approach: based on Elastic Stack/Drupal/Operators/Open API specifications compliance/OAuth/OIDC support &#8658; simplifies developments, customization, and maintenance.</p>
</li>
<li class="data-line-165">
<p>Secured and robust gateway, using IBM DataPower Gateway a market leading IBM product since 1999 offers unprecedent performance and very high security features.</p>
</li>
<li class="data-line-166">
<p>The access to the Cloud Manager, the API Manager and the Portal always allow the use of multiple user registries at the same time. In other words, I can use a LUR - Local User Registry and at the same time an OIDC provider.</p>
</li>
</ul>
</div>
<div class="sect3 data-line-168">
<h4 id="_a_word_on_themes">A word on themes</h4>
<div class="paragraph data-line-169">
<p>There are four WEB interfaces with a coloured theme. You see in the table below, a small screen capture of the top left corner of the consoles.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-171">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Component</th>
<th class="tableblock halign-left valign-top">Runs on</th>
<th class="tableblock halign-left valign-top">Colour</th>
<th class="tableblock halign-left valign-top">Image</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cloud Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Green</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../images/v10-theme-cmc.png" alt="Theme Cloud Manager">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Manager</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blue</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../images/v10-theme-mgr.png" alt="Theme API Manager">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Designer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LTE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blue</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../images/v10-theme-des.png" alt="Theme API Designer">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dev Portal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Portal (Drupal)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Purple</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../images/V10-theme-dev.png" alt="Theme Dev Portal">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2 data-line-180">
<h3 id="_topologies_and_multitenancy_aspects">Topologies and multitenancy aspects</h3>
<div class="sect3 data-line-181">
<h4 id="_topologies_generic">Topologies - Generic</h4>
<div class="paragraph data-line-182">
<p>Below high-level a typical hybrid deployment. In this diagram, there is no focus on analytics and portal components.</p>
</div>
<div class="imageblock data-line-184">
<div class="content">
<img src="../images/topology-generic.png" alt="Topology:">
</div>
</div>
</div>
<div class="sect3 data-line-186">
<h4 id="_topologies_api_connect_focus">Topologies - API Connect focus</h4>
<div class="paragraph data-line-187">
<p>Below some illustrations of various deployments. This is not an exhaustive list. But we want to illustrate the variety of the possible deployments.
In the first sample, the manager is deployed on-premise, and instances of the gateway/analytics and portal are installed in various locations, 2 sets on-premise (maybe internal and external API), and other sets in various clouds.</p>
</div>
<div class="imageblock data-line-190">
<div class="content">
<img src="../images/Topologie-1.png" alt="Topology 1:">
</div>
</div>
<div class="paragraph data-line-192">
<p>In this second sample, the manager is deployed on cloud, it can be installed and managed by IBM or not. The instances of the gateway/analytics and portal are installed in various locations, 2 sets on-premise (maybe internal and external API), and other sets in various clouds. The instances in IBM cloud can be deployed and managed by IBM or not.</p>
</div>
<div class="imageblock data-line-194">
<div class="content">
<img src="../images/Topologie-2.png" alt="Topology 2:">
</div>
</div>
<div class="paragraph data-line-196">
<p>In this third sample, we illustrate the Public SaaS version of API Connect. Deployments and management is assured by IBM. Notice that a freemium version is available. This approach can be used for production or not, can be used to start and get familiar with API Connect.</p>
</div>
<div class="imageblock data-line-198">
<div class="content">
<img src="../images/Topologie-3.png" alt="Topology:">
</div>
</div>
<div class="paragraph data-line-200">
<p>In this fourth sample, we illustrate the deployment of API Connect within the Cloud Pak for Integration. Using the Cloud Pak provides additional integration components such as an ESB (App Connect), messaging support (Event Stream), etc &#8230;&#8203; It provides additional service such as end to end tracing between those components.</p>
</div>
<div class="imageblock data-line-202">
<div class="content">
<img src="../images/Topologie-4.png" alt="Topology:">
</div>
</div>
</div>
<div class="sect3 data-line-204">
<h4 id="_governance_and_multitenancy">Governance and multitenancy</h4>
<div class="paragraph data-line-205">
<p>There are many variations around what we refer as multitenancy. At a high-level, this is the level of separation and governance of the API. The level of separation may vary significantly when looking at the requirements in a specific situation and organisation structure. From a strong and highly separation required to a lightweight one where for example, we only want to separate the consumptions of the API for different groups of consumers.
The level of separation may even imply a separation of the deployed instances of the components. In this chapter, we are going to consider only a few cases where we do not consider specific instances of IBM API Connect clouds or cluster of components within an API Connect cloud. In fact, we really consider the "logical" separation in an instance.</p>
</div>
<div class="ulist data-line-208">
<ul>
<li class="data-line-208">
<p>In the first sample, a company has many subsidiaries or brands, referred as entity from now on, maybe in one or more countries. The members of those entities are working pretty much independently, they probably have different marketing strategies, different branding, etc&#8230;&#8203; The need for a common entity to share a common set of API may exist. A variation of this case is where one entity may provide the API for the other entities, but then each entity will manage the API entirely. The one entity may provide a common backends that serves those API.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-210">
<p>In this case, we are using the highest level of "logical" separation: the organisation. In that case, they may use their own user registries, they have their own catalogs, the set of developed APIs are independent, of course the lifecycle are independent, they manage their own set of consumers organisations. To address the requirement of a common set of API, is solved by creating a "common" organisation, where the API that need to be shared are simply copied from the various entities. This can be automated with CI/CD approach. Notice that the use of Organisation to support multitenancy is what IBM is using for the SaaS public version (For Reserved Instance, it is possible to have IBM Managed specific instances).</p>
</div>
<div class="imageblock data-line-212">
<div class="content">
<img src="../images/tenancy1.png" alt="Multitenancy organisation level">
</div>
</div>
<div class="ulist data-line-214">
<ul>
<li class="data-line-214">
<p>In the second sample, a company has many departments, those departments want to expose and control precisely sets of APIs and they want to control the lifecycle of those API. They are not concerned that they have a common repository for the development of the API. Also, they are ways to address this separation with API Connect (Using Catalog' Spaces and/or using a SCM - Source Control Management system). The members who are developing the API may be the same people, but the API owners belongs to different departments. A variation of this case, is a single company, let&#8217;s call it PA, provides the API, to different business partners or departments, but those departments are separated enough so that they will not have the same sets of APIs. PA will publish the API in the various catalogs, and the business partners will be able to expose the API with their own branding (since each Portal has their own site that can be configured).</p>
</li>
</ul>
</div>
<div class="paragraph data-line-216">
<p>In this case, we have only one organisation, but we use various catalogs for each department. Each department may customise the portal as they wish. The lifecycle of the API beyond development is handled within each department. The management of consumer organisations is also the responsibility of each department.</p>
</div>
<div class="imageblock data-line-218">
<div class="content">
<img src="../images/tenancy2.png" alt="Multitenancy catalog level">
</div>
</div>
<div class="ulist data-line-220">
<ul>
<li class="data-line-220">
<p>In the third sample, we really want to control the set of API to various API consumers.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-222">
<p>In this case, there is one organisation, probably one catalog, one portal, with one branding. But we use the API Visibility to restrict the visibility and the subscriptions to a limited set of consumer organisations.</p>
</div>
<div class="imageblock data-line-224">
<div class="content">
<img src="../images/tenancy3.png" alt="Multitenancy Consumer Organisations level">
</div>
</div>
</div>
</div>
<div class="sect2 data-line-226">
<h3 id="_a_word_on_quorum">A word on quorum</h3>
<div class="paragraph data-line-227">
<p>Nowadays a lot of systems containing data are distributed. This increases availability but at the same time data consistency between the various instances is highly required. There are several strategies to support this requirement, active-passive, active-active where it becomes a little bit more difficult. One approach to solve this is to use the notion of quorum, where using a simple mathematical decision (N-1)/2 a decision can be taken to identify whether the system should be shut down to avoid data corruption or to keep the system available but alert that data corruption has occurred, and some reconciliation work may have to happen. Many components in API Connect or related to API Connect are based on distributed databases. Kubernetes etcd, Elastic Stack, Cassandra, Redis, etc &#8230;&#8203; When you design your topology, I would really advise that you understand what you want, what can be done and what may happen if losing quorum, how the individual component will behave. You should also perform some disaster testing according to what you try to achieve. There are a lot of literature on this topic available. One final word, for fun, remember that ∀ n ∈ ℕ (n-1)/2 &lt; n/2 , that means that if you lose half of your instances you are in trouble and you need to start worrying about what is happening!</p>
</div>
</div>
<div class="sect2 data-line-229">
<h3 id="_policies">Policies</h3>
<div class="paragraph data-line-230">
<p>Below the available policies in API Connect V10.0.0.0</p>
</div>
<div class="imageblock data-line-232">
<div class="content">
<img src="../images/V10-policies.png" alt="V10 Policies">
</div>
</div>
<table class="tableblock frame-all grid-all stretch data-line-234">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">-</th>
<th class="tableblock halign-left valign-top">Category</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operation Switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">switch per ops</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GraphQL introspection</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GraphQL support</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">switch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Invoke</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">invocation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Logic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throw</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exception handling</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Log</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON to XML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rate limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quota mgmt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Map</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mapping</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Parse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">deserialise</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Schema validates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML to JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">authenticate</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">obfuscate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generate JWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate token</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XSLT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">user Security</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Other</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GatewayScript</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">any code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Security</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validate JWT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">validate token</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="sect1 data-line-248">
<h2 id="_lifecycle_of_a_product">Lifecycle of a Product</h2>
<div class="sectionbody">
<div class="paragraph data-line-249">
<p>The lifecycle of a product is as follow:</p>
</div>
<div class="imageblock data-line-251">
<div class="content">
<img src="../images/diagram_product_lifecycle.jpg" alt="ProductsLifeCycle">
</div>
</div>
<div class="paragraph data-line-253">
<p>It is possible to use an approbation control between each transition</p>
</div>
</div>
</div>
<div class="sect1 data-line-255">
<h2 id="_roles">Roles</h2>
<div class="sectionbody">
<div class="paragraph data-line-256">
<p>Below a high-level view of the roles defined in API Connect.</p>
</div>
<div class="paragraph data-line-258">
<p>Although it is possible to create custom role, I would argue for the need to do that. There are already a pretty large number of default roles defined.</p>
</div>
<div class="imageblock data-line-260">
<div class="content">
<img src="../images/default-roles.png" alt="default roles">
</div>
</div>
<div class="paragraph data-line-262">
<p><strong>Cloud level</strong></p>
</div>
<div class="ulist data-line-264">
<ul>
<li class="data-line-264">
<p>Administrator: Administers the admin organization</p>
</li>
<li class="data-line-265">
<p>Member: Minimum role</p>
</li>
<li class="data-line-266">
<p>Organization Manager: Manages API provider organizations</p>
</li>
<li class="data-line-267">
<p>Owner: Owns and administers the admin organization</p>
</li>
<li class="data-line-268">
<p>Topology Administrator: Administers the cloud topology</p>
</li>
<li class="data-line-269">
<p>Viewer: Views the admin organization</p>
</li>
</ul>
</div>
<div class="paragraph data-line-271">
<p><strong>Organisation level</strong></p>
</div>
<div class="ulist data-line-273">
<ul>
<li class="data-line-273">
<p>Developer: Authors API and product definitions</p>
</li>
<li class="data-line-274">
<p>Administrator: Administers the API provider organization</p>
</li>
<li class="data-line-275">
<p>Community Manager: Manages application developer communities</p>
</li>
<li class="data-line-276">
<p>Viewer: Views the API provider organization</p>
</li>
<li class="data-line-277">
<p>API Administrator: Manages the API product lifecycle</p>
</li>
<li class="data-line-278">
<p>Member: Minimum role</p>
</li>
<li class="data-line-279">
<p>Owner: Owns and administers the API provider organization</p>
</li>
</ul>
</div>
<div class="paragraph data-line-281">
<p><strong>Consumer Organisation level</strong></p>
</div>
<div class="ulist data-line-283">
<ul>
<li class="data-line-283">
<p>Owner: Owns and administers the app developer organization</p>
</li>
<li class="data-line-284">
<p>Administrator: Administers the app developer organization</p>
</li>
<li class="data-line-285">
<p>Developer: Builds and manages apps in the developer organization</p>
</li>
<li class="data-line-286">
<p>Member: Member of the app developer organization</p>
</li>
<li class="data-line-287">
<p>Viewer: Viewer of the app developer organization</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1 data-line-289">
<h2 id="_overall_design_of_the_lab">Overall design of the lab</h2>
<div class="sectionbody">
<div class="paragraph data-line-290">
<p>The goal of this lab is to build the following APIs:</p>
</div>
<div class="imageblock data-line-292">
<div class="content">
<img src="../images/ProductsAPIsToBuild.png" alt="ProductsAndAPIsToBuild">
</div>
</div>
<div class="paragraph data-line-294">
<p>This provides a mix of REST and SOAP APIs, with or without mapping, using or not a Loopback Application.</p>
</div>
<div class="paragraph data-line-296">
<p>The corresponding back end runtimes are as follow:</p>
</div>
<div class="imageblock data-line-298">
<div class="content">
<img src="../images/RuntimesAndBackEnd.png" alt="RuntimesAndBackEnd">
</div>
</div>
<div class="paragraph data-line-300">
<p>This provides a mix of JAX RS, JAX WS and NodeJS (with Loopback Application) for pure cloud APIs. The use of Secure Gateway in relation with a local deployment would demonstrate hybrid APIs.</p>
</div>
</div>
</div>
<div class="sect1 data-line-302">
<h2 id="_steps_for_the_lab">Steps for the lab</h2>
<div class="sectionbody">
<div class="olist arabic data-line-303">
<ol class="arabic">
<li class="data-line-303">
<p><a href="#_step_1_check_the_development_environment">Check the development environment</a></p>
</li>
<li class="data-line-304">
<p><a href="#_step_2_expose_an_existing_rest_api">Expose an existing REST API</a></p>
</li>
<li class="data-line-305">
<p><a href="#_step_3_creating_and_publishing_a_product">Creating and publishing a Product</a></p>
</li>
<li class="data-line-306">
<p><a href="#_step_4_consumer_experience">Consumer Experience</a></p>
</li>
<li class="data-line-307">
<p><a href="#_step_5_invoke_the_api">Invoke the API</a></p>
</li>
<li class="data-line-308">
<p><a href="#_step_6_analytics">Analytics</a></p>
</li>
<li class="data-line-309">
<p><a href="#_step_7_create_a_soap_api">Create a SOAP API</a></p>
</li>
<li class="data-line-310">
<p><a href="#_step_8_create_a_soap_to_rest_api">Create a SOAP to REST API</a></p>
</li>
<li class="data-line-311">
<p><a href="#_step_9_create_a_cloudant_service">Create a Cloudant service</a></p>
</li>
<li class="data-line-312">
<p><a href="#_step_10_create_a_loopback_application">Create a LoopBack application</a></p>
</li>
<li class="data-line-313">
<p><a href="#_step_11_manage_your_api_in_api_designer">Manage your API in API Designer</a></p>
</li>
<li class="data-line-314">
<p><a href="#_step_12_using_oauth_to_protect_your_api">Using OAuth to protect your API</a></p>
</li>
<li class="data-line-315">
<p><a href="#_step_13_testing_the_quality_of_your_api">Testing the quality of your API</a></p>
</li>
<li class="data-line-316">
<p><a href="#_step_14_cicd_integration">CI/CD integration</a></p>
</li>
</ol>
</div>
<div class="sect2 data-line-319">
<h3 id="_step_1_check_the_development_environment">Step 1 - Check the development environment</h3>
<div class="paragraph data-line-320">
<p>For this lab, we are going to use the Designer and the LTE - Local Test Environment  instead of using the manager (central). We will then deploy the API into the sandbox catalog from the designer.
&gt;*Note*: Using the toolkit/designer (locally) or using manager directly (remote server) is a pretty important decision. The toolkit has the benefit to allow the use of a Source Control Management System to perform micro versioning as well as backup of the various yaml (and WSDLs). It also provides a local experience with usually a lower response time. Using the Manager simplifies sharing the API Drafts. There are ways to benefit of both approaches, especially considering a devOps approach. I&#8217;m using a Linux environment; you may have to adjust the commands with your specific environment being Windows or MacOS.</p>
</div>
<div class="paragraph data-line-323">
<p>Let&#8217;s check that development environment is ok.
We first prepare the docker environment to start the local test environment. <code>sudo docker load &lt; apic-lte-images_10.0.1.2-ifix2.tar.gz</code>.
The information on the local test environment can be found under the title <strong>Testing an API with the Local Test Environment</strong> in the IBM Knowledge Center.
To start the  LTE, in my case, <code>cd ~/apic-lte/linux</code>, then <code>sudo ./apic-lte start</code>.</p>
</div>
<div class="imageblock data-line-328">
<div class="content">
<img src="../images/start-lte.png" alt="Start LTE">
</div>
</div>
<div class="paragraph data-line-330">
<p>Take a note of the Platform API URL and the user/pwd to be used. we will need them when we start the Designer.</p>
</div>
<div class="admonitionblock note data-line-332">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To check that the LTE is correctly started: <code>apic login --server localhost:2000 --username shavon --password 7iron-hide --realm provider/default-idp-2</code> or <code>./apic-lte status</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-334">
<p>If you get Unauthorized you may have to clear the credentials with the following command: <code>apic client-creds:clear</code></p>
</div>
<div class="paragraph data-line-336">
<p>You should get the following message: Logged into localhost:2000 successfully</p>
</div>
<div class="paragraph data-line-338">
<p>To start the designer, just execute the ./api_designer-linux. I assume here you downloaded the version of the Designer from the IBM support site; the version must be similar to the API connect installation.
It does start a window, the first information to specify is the working directory, where the artefacts (yaml) will be created.</p>
</div>
<div class="imageblock data-line-341">
<div class="content">
<img src="../images/designer-specify-work-dirv10.png" alt="Designer specify working directory">
</div>
</div>
<div class="paragraph data-line-343">
<p>Click on Open a folder and specify the directory where you work.</p>
</div>
<div class="imageblock data-line-345">
<div class="content">
<img src="../images/designer-specify-work-dir-spec.png" alt="Designer specify working directory folder">
</div>
</div>
<div class="paragraph data-line-347">
<p>The specify the manager you want to work with, in our case, we will have two locations, the local test environment and the manager of a remote instance. First let&#8217;s use the LTE. We enter the information for the local test environment, in our case <a href="https://localhost:2000" class="undefined" data-href="https://localhost:2000">https://localhost:2000</a>.</p>
</div>
<div class="imageblock data-line-349">
<div class="content">
<img src="../images/designer-new-connectionV10.png" alt="Designer specify working directory folder">
</div>
</div>
<div class="paragraph data-line-351">
<p>The login screen appears, we enter the credentials that were indicated when starting the LTE, in our case shavon/7iron-hide.</p>
</div>
<div class="imageblock data-line-353">
<div class="content">
<img src="../images/designer-connect-managerV10.png" alt="Designer specify working directory folder">
</div>
</div>
<div class="paragraph data-line-355">
<p>The first screen appears, we are ready to create our first API.</p>
</div>
<div class="imageblock data-line-357">
<div class="content">
<img src="../images/designer-first-screenv10.png" alt="Designer specify working directory folder">
</div>
</div>
</div>
<div class="sect2 data-line-359">
<h3 id="_step_2_expose_an_existing_rest_api">Step 2 - Expose an existing REST API</h3>
<div class="paragraph data-line-360">
<p>In this first step, we assume that a developer of an API is providing you the Swagger associated with that API. The developer is using WAS Liberty as the runtime and he also uses JAX-RS annotations along apidiscovery feature. This allows him to get a Swagger easily consumed by API Connect. Download the Swagger [here](./materials/step2/QuoteManagementAPI_AW_S.yaml) on your file system, for example under ~/apic-dev assuming that you have created such directory.</p>
</div>
<div class="olist arabic data-line-362">
<ol class="arabic">
<li class="data-line-362">
<p>Ensure that you have downloaded the yaml correctly <code>cd ~/Downloads</code> and the <code>head QuoteManagementAPI_AW_S.yaml</code> you should obtain the following:</p>
</li>
</ol>
</div>
<div class="listingblock data-line-363">
<div class="content">
<pre class="highlight"><code>swagger: '2.0'
info:
  description: Quote API
  version: 1.0.0
  title: Quote API
  contact:
    name: Arnauld Desprets
    url: 'http://thequoteapi/terms.html'
    email: arnauld_desprets@fr.ibm.com
  x-ibm-name: quote-api</code></pre>
</div>
</div>
<div class="paragraph data-line-375">
<p>If this is not the case, then download it again or copy it in a file.</p>
</div>
<div class="olist arabic data-line-377">
<ol class="arabic">
<li class="data-line-377">
<p>It  is a good idea to check that the back end API is running before exposing it. In this case, we are going to use the GET verb on the quote operation. Type the following:  <code>curl -H "Accept: application/json" "http://SampleJAXRS20-aw.eu-gb.mybluemix.net/loanmgt/resources/loans/v1/quote?loanAmount=10000&amp;annualInterestRate=1.1&amp;termInMonths=36"</code>
You should obtain the following results: {"loanAmount":10000,"annualInterestRate":1.1,"termInMonths":36,"monthlyPaymentAmount":282.51360281363674}.</p>
</li>
</ol>
</div>
<div class="admonitionblock note data-line-380">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
This API is not exposed, is not protected, is not monitored, is not governed. Let&#8217;s use API Connect to fix this.
</td>
</tr>
</table>
</div>
<div class="olist arabic data-line-382">
<ol class="arabic">
<li class="data-line-382">
<p>We are using the designer that we opened earlier. Click on <strong>Develop APIs and Products</strong> button. Then click on <strong>Add</strong> and select <strong>API</strong> button on the top right of the screen.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-384">
<div class="content">
<img src="../images/designer-add-APIV10.png" alt="Designer add API">
</div>
</div>
<div class="paragraph data-line-386">
<p>Select the <strong>From existing OpenAPI service</strong> and click <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-388">
<div class="content">
<img src="../images/designer-select-from-existingV10.png" alt="Designer Select from existing Open API">
</div>
</div>
<div class="paragraph data-line-390">
<p>Select the file downloaded previously and click <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-392">
<div class="content">
<img src="../images/designer-select-openapi-fileV10.png" alt="Designer Select OpenAPI file">
</div>
</div>
<div class="paragraph data-line-394">
<p>Change the following details
* Base path: /loans/v1
* Description: Supports Loan quote operation and also provide a simple way to add a delay in the back end response time and get variable length messages from back end.
Then click <strong>Next</strong> button.</p>
</div>
<div class="admonitionblock note data-line-399">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
The base path has been chosen carefully to avoid URI rewriting and simplify this first example. You always must be careful with the exposed URI and back end URI and adopt strategy to avoid URI rewriting or if not possible to reduce the work required to do this mapping. The worst case is to have a specific URI for each combination VERB + PATH.
</td>
</tr>
</table>
</div>
<div class="imageblock data-line-401">
<div class="content">
<img src="../images/designer-specify-quote-api.png" alt="Designer Specify quote api">
</div>
</div>
<div class="paragraph data-line-403">
<p>Keep the default value for CORS and using a client id to secure the API, click <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-405">
<div class="content">
<img src="../images/designer-quote-api-corsV10.png" alt="Designer quote api CORS settings">
</div>
</div>
<div class="paragraph data-line-407">
<p>Click on the Edit <strong>API button</strong>.</p>
</div>
<div class="imageblock data-line-409">
<div class="content">
<img src="../images/designer-edit-apiV10.png" alt="Designer edit api">
</div>
</div>
<div class="paragraph data-line-411">
<p>Before testing it, in the development environment, let&#8217;s review what has been created under the cover. The Designer can be considered in certain ways a Swagger (Open API) editor.</p>
</div>
<div class="paragraph data-line-413">
<p>Let&#8217;s see first the API Setup part. Notice that the Schemes supported by default is HTTPS, API Connect does not support HTTP scheme for security reason. Some specifications such as OAuth specifications do require the use of HTTPS scheme anyway.</p>
</div>
<div class="paragraph data-line-415">
<p>The host field has been set to $(catalog.host). This indicates where the API is deployed and it is dependent of where we deploy it, so it depends on the catalog, hence why this value for this variable.</p>
</div>
<div class="imageblock data-line-417">
<div class="content">
<img src="../images/designer-quote-api-info-part.png" alt="Designer Quote-api info part">
</div>
</div>
<div class="paragraph data-line-419">
<p>A quick look at the Security Definitions and Security information, which are standard information within an Open API document shows that the API is as expected protected using an API Key, client-id only.</p>
</div>
<div class="paragraph data-line-421">
<p>We see that there are 2 paths, /extquote (one verb, GET) and /quote (2 verbs GET and POST).</p>
</div>
<div class="paragraph data-line-423">
<p>Now let&#8217;s see the Properties section, there is a property called target-url.
Properties is a very important concept. It allows the definition of any variable for each catalog. The target-url is by convention a variable to indicate the back end url. In our case, we are going to adjust it to <a href="http://SampleJAXRS20-aw.eu-gb.mybluemix.net/loanmgt/resources" class="undefined" data-href="http://SampleJAXRS20-aw.eu-gb.mybluemix.net/loanmgt/resources">http://SampleJAXRS20-aw.eu-gb.mybluemix.net/loanmgt/resources</a>. For now, we just use the default value, because we do not care of other catalogs than Sandbox. Click <strong>Save</strong> button.</p>
</div>
<div class="imageblock data-line-426">
<div class="content">
<img src="../images/designer-quote-api-propertiesV10.png" alt="Designer Quote api properties">
</div>
</div>
<div class="paragraph data-line-428">
<p>Before testing we have one small adjustment to perform. The back end URL invoked and we are going to use the target-url just set.</p>
</div>
<div class="paragraph data-line-430">
<p>We go in the Assembly Panel and click on the Invocation policy. The panel with the properties is displayed on the right.
&gt; Hint: For compatibility of the gateway aspects, here delete the invoke policy and add it again. The choice here is based on which gateway type do we use. In our case, we use the new one, referred as DataPower API Gateway.</p>
</div>
<div class="paragraph data-line-433">
<p>We change the value to $(target-url)$(request.path)$(request.search) and click <strong>Save</strong> button.</p>
</div>
<div class="imageblock data-line-435">
<div class="content">
<img src="../images/designer-quote-api-invokeV10.png" alt="Designer Quote api invoke">
</div>
</div>
<div class="paragraph data-line-437">
<p>We can test the API which is available in the local Sandbox catalog with a generated auto product. We ensure that the API is running. If it stopped start it, so it goes in the running state.</p>
</div>
<div class="imageblock data-line-439">
<div class="content">
<img src="../images/designer-run-API.png" alt="Designer Start API">
</div>
</div>
<div class="paragraph data-line-441">
<p>In a terminal type
 <code>curl -v -k -H "accept: application/json" -H "content-type: application/json" -H "x-ibm-client-id: c920f9c18395e6ecb3f15375a74fe8be" "https://localhost:9444/localtest/sandbox/loans/v1/quote?loanAmount=10000&amp;annualInterestRate=1.1&amp;termInMonths=3"</code></p>
</div>
<div class="paragraph data-line-444">
<p>You should get as before when accessing the back end API directly:
{"loanAmount":10000,"annualInterestRate":1.1,"termInMonths":3,"monthlyPaymentAmount":3339.4463108727305}</p>
</div>
<div class="paragraph data-line-447">
<p>Before moving on, let&#8217;s discuss some debugging techniques.</p>
</div>
<div class="paragraph data-line-449">
<p>To do this, we are introducing a few errors and see what we can do to handle them and how to understand them.</p>
</div>
<div class="paragraph data-line-451">
<p>Using the wrong client-id:
{"httpCode":"401","httpMessage":"Unauthorized","moreInformation":"Invalid client id or secret."}
This is situation is clear. Get an unauthorized message.
One way to get a little bit more information is to use the -v option with curl. This will show you the headers sent and received, the TLS session information, etc &#8230;&#8203;</p>
</div>
<div class="paragraph data-line-456">
<p>Now let&#8217;s use a wrong host or URI for the back end.</p>
</div>
<div class="imageblock data-line-458">
<div class="content">
<img src="../images/troubleshoot-wrong-uri-1.png" alt="Trouble shoot 1">
</div>
</div>
<div class="paragraph data-line-460">
<p>No information whatsoever!</p>
</div>
<div class="paragraph data-line-462">
<p>Let&#8217;s use the -v option.</p>
</div>
<div class="imageblock data-line-464">
<div class="content">
<img src="../images/troubleshoot-wrong-uri-2.png" alt="Trouble shoot 2">
</div>
</div>
<div class="paragraph data-line-466">
<p>Now we see that there was a 500 error. This is better. We do not see any root cause, there is no problem with the plan (still 92 calls possible). It is not clear that the back end URI is wrong. So, let&#8217;s see the logs from the Gateway itself. We know that we are running DataPower as a docker container. So, let&#8217;s get the container id by issuing <code>sudo docker ps</code>, then now we can check the logs of the gateway using the <code>sudo docker logs -f &lt;gateway-container-id&gt;</code>. (To get the gateway container id, issue the command sudo docker ps). It becomes very clear that the error is the URL&#8230;&#8203;</p>
</div>
<div class="imageblock data-line-468">
<div class="content">
<img src="../images/troubleshoot-wrong-uri-3.png" alt="Trouble shoot 3">
</div>
</div>
<div class="paragraph data-line-470">
<p>Note: You can determine the port mapping for the gateway container and derive from it the  gateway web console knowing that the default internal port for the web UI is 9090. Issue the command <code>sudo docker port &lt;gateway-container-id&gt;</code></p>
</div>
<div class="imageblock data-line-472">
<div class="content">
<img src="../images/troubleshoot-wrong-uri-4.png" alt="Trouble shoot 4">
</div>
</div>
<div class="paragraph data-line-474">
<p>You can then access the console at <a href="https://localhost:9091/" class="undefined" data-href="https://localhost:9091/">https://localhost:9091/</a>, the default uid/pwd is admin/admin.</p>
</div>
<div class="imageblock data-line-476">
<div class="content">
<img src="../images/troubleshoot-wrong-uri-5.V10.png" alt="Trouble shoot 5">
</div>
</div>
<div class="paragraph data-line-478">
<p>Let&#8217;s fix the URI before publishing the API to the remote manager since we are happy now that the API is correctly working.</p>
</div>
<div class="paragraph data-line-480">
<p>The API is definition is complete. We need now to add the Product and publish it and then we are ready to test our Quote API before publishing it to the remote Manager.</p>
</div>
</div>
<div class="sect2 data-line-482">
<h3 id="_step_3_creating_and_publishing_a_product">Step 3 - Creating and publishing a Product</h3>
<div class="paragraph data-line-484">
<p>To create a product, click on the Develop icon on the navigation panel (left). Then click on the <strong>Add</strong> button and select Product.</p>
</div>
<div class="imageblock data-line-486">
<div class="content">
<img src="../images/design-add-product.png" alt="Designer Add product">
</div>
</div>
<div class="paragraph data-line-488">
<p>Select <strong>New product</strong> button and <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-490">
<div class="content">
<img src="../images/designer-new-product.png" alt="Designer New product">
</div>
</div>
<div class="paragraph data-line-492">
<p>Enter the following information:
* Title: Quote Management Product
* Summary: Includes the Quote API</p>
</div>
<div class="paragraph data-line-496">
<p>Click on <strong>Next</strong> button</p>
</div>
<div class="imageblock data-line-498">
<div class="content">
<img src="../images/designer-new-product-info.png" alt="Designer New product Information">
</div>
</div>
<div class="paragraph data-line-500">
<p>Select the Quote API by clicking on the check box and the click <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-502">
<div class="content">
<img src="../images/designer-new-product-selectapi.png" alt="Designer New product Select API">
</div>
</div>
<div class="paragraph data-line-504">
<p>Change or adjust the plan according to your requirements plan and then click on <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-506">
<div class="content">
<img src="../images/designer-new-product-plan.png" alt="Designer New product Select plan">
</div>
</div>
<div class="paragraph data-line-508">
<p>Change or adjust the visibility or subscribability according to your requirements plan and then click on <strong>Next</strong> button.</p>
</div>
<div class="imageblock data-line-510">
<div class="content">
<img src="../images/designer-new-product-visibility.png" alt="Designer New product Select visibility">
</div>
</div>
<div class="paragraph data-line-512">
<p>click on <strong>Edit Product</strong> button.</p>
</div>
<div class="imageblock data-line-514">
<div class="content">
<img src="../images/designer-new-product-done.png" alt="Designer New product Done">
</div>
</div>
<div class="paragraph data-line-516">
<p>We want to publish the API on the remote manager. So first, we start to add this manager to the Designer so we can choose where we want to deploy the product. We click on the <strong>Switch cloud connection</strong> link at the top of the window and then click on <strong>Add Another Cloud</strong> button. Enter the URL of the remote manager, in my case, <a href="https://manager.159.8.70.38.xip.io" class="undefined" data-href="https://manager.159.8.70.38.xip.io">https://manager.159.8.70.38.xip.io</a>, then enter the credentials to access the organization you work with.</p>
</div>
<div class="paragraph data-line-518">
<p>We publish the API, by clicking on the Develop icon, then clicking on the &#8230;&#8203; close to the new product and select Publish.</p>
</div>
<div class="imageblock data-line-520">
<div class="content">
<img src="../images/designer-quote-product-publish.png" alt="Designer Quote product publish">
</div>
</div>
<div class="paragraph data-line-522">
<p>Then click on the <strong>Publish</strong> button.</p>
</div>
<div class="imageblock data-line-524">
<div class="content">
<img src="../images/designer-quote-product-publish-done.png" alt="Designer Quote product publish done">
</div>
</div>
<div class="paragraph data-line-526">
<p>We can check on the remote Manager that the Product containing the Quote API has been correctly published.</p>
</div>
<div class="imageblock data-line-528">
<div class="content">
<img src="../images/designer-publish-product-remote.png" alt="Designer Quote product publish remote">
</div>
</div>
<div class="paragraph data-line-530">
<p>We want to automate the publishing and do not use the Designer and instead the CLI.</p>
</div>
<div class="paragraph data-line-532">
<p>Note: If you want to use the REST API, it is easy to use the CLI with the --debug option at the end. This will show you exactly the REST commands issued under the cover.</p>
</div>
<div class="paragraph data-line-534">
<p>For example:</p>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre class="highlight"><code>apic login -s manager.159.8.70.38.xip.io -u org1owner -p ******** -r provider/default-idp-2 --debug
2020/03/17 07:27:11 CURL:
curl -X 'POST' -d '{"client_id":"599b7aef-8841-4ee2-88a0-84d49c4d6ff2","client_secret":"0ea28423-e73b-47d4-b40e-ddb45c48bb0c","grant_type":"password","password":"********","realm":"provider/default-idp-2","username":"org1owner"}
' -H 'Accept: application/json' -H 'Accept-Language: en-us' -H 'Content-Type: application/json' -H 'User-Agent: Toolkit/c81e13c07d3c2c7730827610fcaf08bbec88fe04' -H 'X-Ibm-Client-Id: 599b7aef-8841-4ee2-88a0-84d49c4d6ff2' -H 'X-Ibm-Client-Secret: 0ea28423-e73b-47d4-b40e-ddb45c48bb0c' 'https://manager.159.8.70.38.xip.io/api/token'

, Request dump:
POST /api/token HTTP/1.1
Host: manager.159.8.70.38.xip.io
User-Agent: Toolkit/c81e13c07d3c2c7730827610fcaf08bbec88fe04
Content-Length: 211
Accept: application/json
Accept-Language: en-us
Content-Type: application/json
X-Ibm-Client-Id: 599b7aef-8841-4ee2-88a0-84d49c4d6ff2
X-Ibm-Client-Secret: 0ea28423-e73b-47d4-b40e-ddb45c48bb0c
Accept-Encoding: gzip


, Request body:
{"client_id":"599b7aef-8841-4ee2-88a0-84d49c4d6ff2","client_secret":"0ea28423-e73b-47d4-b40e-ddb45c48bb0c","grant_type":"password","password":"********","realm":"provider/default-idp-2","username":"org1owner"}

2020/03/17 07:27:11 Response dump:
HTTP/1.1 200 OK
Transfer-Encoding: chunked
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization
Access-Control-Allow-Methods: GET, PUT, POST, DELETE, PATCH, OPTIONS
Access-Control-Allow-Origin: *
Cache-Control: no-store
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Tue, 17 Mar 2020 14:27:11 GMT
Etag: W/"796-uuzjeFcKQJgIb4beYqsTqyRZQww"
Pragma: no-cache
Strict-Transport-Security: max-age=31536000; includeSubDomains;
Vary: Accept-Encoding
X-Request-Id: 6c9542e7c7951b4512235eb5d404740a

796
{
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4MGU2MjM4Yy01MzE1LTRjODUtYTYwNS1kODAzNmZmMjdiNDUiLCJuYW1lc3BhY2UiOiIzMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTA6NmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5OmVmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImF1ZCI6Ii9hcGkvY2xvdWQvcmVnaXN0cmF0aW9ucy8yZmY0NWY0Ny05MGJlLTQ1NDEtYmYxMi04ZjlhNDJjOGQ0NzkiLCJzdWIiOiIvYXBpL3VzZXItcmVnaXN0cmllcy8zMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTAvNmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5L3VzZXJzL2VmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImlzcyI6IklCTSBBUEkgQ29ubmVjdCIsImV4cCI6MTU4NDQ4NDAzMSwiaWF0IjoxNTg0NDU1MjMxLCJncmFudF90eXBlIjoicGFzc3dvcmQiLCJ1c2VyX3JlZ2lzdHJ5X3VybCI6Ii9hcGkvdXNlci1yZWdpc3RyaWVzLzMwYTM5OWViLWYwOTktNGU3Ny1hODExLTUyZGNhOGFhMTIxMC82ZjM3NDNkMy1mMDJhLTQ4OGMtYTRkYi05Zjg1ZWY1MTNmZDkiLCJyZWFsbSI6InByb3ZpZGVyL2RlZmF1bHQtaWRwLTIiLCJ1c2VybmFtZSI6Im9yZzFvd25lciIsImlkX3Rva2VuIjoiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5Sm1hWEp6ZEY5dVlXMWxJam9pYjNKbk1XOTNibVZ5SWl3aWJHRnpkRjl1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpZFhObGNsOXBaQ0k2SW1Fek5qUm1PRGcwTFRnMlpEWXRORGc1TXkxaE1XWmxMVGRoWVRCbU1tTmhOVFExTkNJc0luVnpaWEp1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpYVdGMElqb3hOVGcwTkRVMU1qTXhmUS5vdTZuM3VxeG83aWdSQ21vVVlaU0E1WXMyY25GX3FtTlBfcGF6WEdvZlVnIiwic2NvcGVzIjpbImNsb3VkOnZpZXciLCJjbG91ZDptYW5hZ2UiLCJwcm92aWRlci1vcmc6dmlldyIsInByb3ZpZGVyLW9yZzptYW5hZ2UiLCJvcmc6dmlldyIsIm9yZzptYW5hZ2UiLCJkcmFmdHM6dmlldyIsImRyYWZ0czplZGl0IiwiY2hpbGQ6dmlldyIsImNoaWxkOmNyZWF0ZSIsImNoaWxkOm1hbmFnZSIsInByb2R1Y3Q6dmlldyIsInByb2R1Y3Q6c3RhZ2UiLCJwcm9kdWN0Om1hbmFnZSIsImFwcHJvdmFsOnZpZXciLCJhcHByb3ZhbDptYW5hZ2UiLCJhcGktYW5hbHl0aWNzOnZpZXciLCJhcGktYW5hbHl0aWNzOm1hbmFnZSIsImNvbnN1bWVyLW9yZzp2aWV3IiwiY29uc3VtZXItb3JnOm1hbmFnZSIsImFwcDp2aWV3OmFsbCIsImFwcDptYW5hZ2U6YWxsIiwibXk6dmlldyIsIm15Om1hbmFnZSIsIndlYmhvb2s6dmlldyJdfQ.PJ29zR15LMo1TcpF_qc2iAISRnubNF4MkTD2SfQxnTg",
    "token_type": "Bearer",
    "expires_in": 28800
}
0


Logged into manager.159.8.70.38.xip.io successfully
2020/03/17 07:27:11 CURL:
curl -X 'GET' -H 'Accept: application/yaml' -H 'Accept-Language: en-us' -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4MGU2MjM4Yy01MzE1LTRjODUtYTYwNS1kODAzNmZmMjdiNDUiLCJuYW1lc3BhY2UiOiIzMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTA6NmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5OmVmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImF1ZCI6Ii9hcGkvY2xvdWQvcmVnaXN0cmF0aW9ucy8yZmY0NWY0Ny05MGJlLTQ1NDEtYmYxMi04ZjlhNDJjOGQ0NzkiLCJzdWIiOiIvYXBpL3VzZXItcmVnaXN0cmllcy8zMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTAvNmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5L3VzZXJzL2VmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImlzcyI6IklCTSBBUEkgQ29ubmVjdCIsImV4cCI6MTU4NDQ4NDAzMSwiaWF0IjoxNTg0NDU1MjMxLCJncmFudF90eXBlIjoicGFzc3dvcmQiLCJ1c2VyX3JlZ2lzdHJ5X3VybCI6Ii9hcGkvdXNlci1yZWdpc3RyaWVzLzMwYTM5OWViLWYwOTktNGU3Ny1hODExLTUyZGNhOGFhMTIxMC82ZjM3NDNkMy1mMDJhLTQ4OGMtYTRkYi05Zjg1ZWY1MTNmZDkiLCJyZWFsbSI6InByb3ZpZGVyL2RlZmF1bHQtaWRwLTIiLCJ1c2VybmFtZSI6Im9yZzFvd25lciIsImlkX3Rva2VuIjoiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5Sm1hWEp6ZEY5dVlXMWxJam9pYjNKbk1XOTNibVZ5SWl3aWJHRnpkRjl1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpZFhObGNsOXBaQ0k2SW1Fek5qUm1PRGcwTFRnMlpEWXRORGc1TXkxaE1XWmxMVGRoWVRCbU1tTmhOVFExTkNJc0luVnpaWEp1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpYVdGMElqb3hOVGcwTkRVMU1qTXhmUS5vdTZuM3VxeG83aWdSQ21vVVlaU0E1WXMyY25GX3FtTlBfcGF6WEdvZlVnIiwic2NvcGVzIjpbImNsb3VkOnZpZXciLCJjbG91ZDptYW5hZ2UiLCJwcm92aWRlci1vcmc6dmlldyIsInByb3ZpZGVyLW9yZzptYW5hZ2UiLCJvcmc6dmlldyIsIm9yZzptYW5hZ2UiLCJkcmFmdHM6dmlldyIsImRyYWZ0czplZGl0IiwiY2hpbGQ6dmlldyIsImNoaWxkOmNyZWF0ZSIsImNoaWxkOm1hbmFnZSIsInByb2R1Y3Q6dmlldyIsInByb2R1Y3Q6c3RhZ2UiLCJwcm9kdWN0Om1hbmFnZSIsImFwcHJvdmFsOnZpZXciLCJhcHByb3ZhbDptYW5hZ2UiLCJhcGktYW5hbHl0aWNzOnZpZXciLCJhcGktYW5hbHl0aWNzOm1hbmFnZSIsImNvbnN1bWVyLW9yZzp2aWV3IiwiY29uc3VtZXItb3JnOm1hbmFnZSIsImFwcDp2aWV3OmFsbCIsImFwcDptYW5hZ2U6YWxsIiwibXk6dmlldyIsIm15Om1hbmFnZSIsIndlYmhvb2s6dmlldyJdfQ.PJ29zR15LMo1TcpF_qc2iAISRnubNF4MkTD2SfQxnTg' -H 'User-Agent: Toolkit/c81e13c07d3c2c7730827610fcaf08bbec88fe04' -H 'X-Ibm-Client-Id: 599b7aef-8841-4ee2-88a0-84d49c4d6ff2' -H 'X-Ibm-Client-Secret: 0ea28423-e73b-47d4-b40e-ddb45c48bb0c' 'https://manager.159.8.70.38.xip.io/api/me?fields=force_password_change'

, Request dump:
GET /api/me?fields=force_password_change HTTP/1.1
Host: manager.159.8.70.38.xip.io
User-Agent: Toolkit/c81e13c07d3c2c7730827610fcaf08bbec88fe04
Accept: application/yaml
Accept-Language: en-us
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI4MGU2MjM4Yy01MzE1LTRjODUtYTYwNS1kODAzNmZmMjdiNDUiLCJuYW1lc3BhY2UiOiIzMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTA6NmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5OmVmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImF1ZCI6Ii9hcGkvY2xvdWQvcmVnaXN0cmF0aW9ucy8yZmY0NWY0Ny05MGJlLTQ1NDEtYmYxMi04ZjlhNDJjOGQ0NzkiLCJzdWIiOiIvYXBpL3VzZXItcmVnaXN0cmllcy8zMGEzOTllYi1mMDk5LTRlNzctYTgxMS01MmRjYThhYTEyMTAvNmYzNzQzZDMtZjAyYS00ODhjLWE0ZGItOWY4NWVmNTEzZmQ5L3VzZXJzL2VmNDgwZGRkLWVmMmUtNDY3Mi05MTk2LWFhZTE3ODJiOWE5OSIsImlzcyI6IklCTSBBUEkgQ29ubmVjdCIsImV4cCI6MTU4NDQ4NDAzMSwiaWF0IjoxNTg0NDU1MjMxLCJncmFudF90eXBlIjoicGFzc3dvcmQiLCJ1c2VyX3JlZ2lzdHJ5X3VybCI6Ii9hcGkvdXNlci1yZWdpc3RyaWVzLzMwYTM5OWViLWYwOTktNGU3Ny1hODExLTUyZGNhOGFhMTIxMC82ZjM3NDNkMy1mMDJhLTQ4OGMtYTRkYi05Zjg1ZWY1MTNmZDkiLCJyZWFsbSI6InByb3ZpZGVyL2RlZmF1bHQtaWRwLTIiLCJ1c2VybmFtZSI6Im9yZzFvd25lciIsImlkX3Rva2VuIjoiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5Sm1hWEp6ZEY5dVlXMWxJam9pYjNKbk1XOTNibVZ5SWl3aWJHRnpkRjl1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpZFhObGNsOXBaQ0k2SW1Fek5qUm1PRGcwTFRnMlpEWXRORGc1TXkxaE1XWmxMVGRoWVRCbU1tTmhOVFExTkNJc0luVnpaWEp1WVcxbElqb2liM0puTVc5M2JtVnlJaXdpYVdGMElqb3hOVGcwTkRVMU1qTXhmUS5vdTZuM3VxeG83aWdSQ21vVVlaU0E1WXMyY25GX3FtTlBfcGF6WEdvZlVnIiwic2NvcGVzIjpbImNsb3VkOnZpZXciLCJjbG91ZDptYW5hZ2UiLCJwcm92aWRlci1vcmc6dmlldyIsInByb3ZpZGVyLW9yZzptYW5hZ2UiLCJvcmc6dmlldyIsIm9yZzptYW5hZ2UiLCJkcmFmdHM6dmlldyIsImRyYWZ0czplZGl0IiwiY2hpbGQ6dmlldyIsImNoaWxkOmNyZWF0ZSIsImNoaWxkOm1hbmFnZSIsInByb2R1Y3Q6dmlldyIsInByb2R1Y3Q6c3RhZ2UiLCJwcm9kdWN0Om1hbmFnZSIsImFwcHJvdmFsOnZpZXciLCJhcHByb3ZhbDptYW5hZ2UiLCJhcGktYW5hbHl0aWNzOnZpZXciLCJhcGktYW5hbHl0aWNzOm1hbmFnZSIsImNvbnN1bWVyLW9yZzp2aWV3IiwiY29uc3VtZXItb3JnOm1hbmFnZSIsImFwcDp2aWV3OmFsbCIsImFwcDptYW5hZ2U6YWxsIiwibXk6dmlldyIsIm15Om1hbmFnZSIsIndlYmhvb2s6dmlldyJdfQ.PJ29zR15LMo1TcpF_qc2iAISRnubNF4MkTD2SfQxnTg
X-Ibm-Client-Id: 599b7aef-8841-4ee2-88a0-84d49c4d6ff2
X-Ibm-Client-Secret: 0ea28423-e73b-47d4-b40e-ddb45c48bb0c
Accept-Encoding: gzip

, Request body:

2020/03/17 07:27:11 Response dump:
HTTP/1.1 200 OK
Content-Length: 2
Access-Control-Allow-Credentials: true
Access-Control-Allow-Headers: DNT,X-CustomHeader,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Authorization
Access-Control-Allow-Methods: GET, PUT, POST, DELETE, PATCH, OPTIONS
Access-Control-Allow-Origin: *
Connection: keep-alive
Content-Type: application/json; charset=utf-8
Date: Tue, 17 Mar 2020 14:27:11 GMT
Etag: W/"2-vyGp6PvFo4RvsFtPoIWeCReyIC8"
Strict-Transport-Security: max-age=31536000; includeSubDomains;
Vary: Accept-Encoding
X-Request-Id: 68312d45ecdaa0a9cbf972f5dd8a49c5

{}</code></pre>
</div>
</div>
<div class="paragraph data-line-618">
<p>First let&#8217;s make sure with in the right directory (where the swaggers are created), in my case, <code>cd apic-dev</code>, then let&#8217;s login to the remote manager with apic. <code>apic login -s manager.159.8.70.38.xip.io -u org1owner -p <strong><strong></strong></strong>*** -r provider/default-idp-2</code> then we are ready to publish the product into the Integration environment for example. We issue the command: <code>apic products publish -s manager.159.8.70.38.xip.io -o org1 -c integration quote-management-product_1.0.0.yaml</code>
image::../images/cli_publish.png[Publish a product using CLI]</p>
</div>
</div>
<div class="sect2 data-line-622">
<h3 id="_step_4_consumer_experience">Step 4 - Consumer Experience</h3>
<div class="paragraph data-line-624">
<p>&gt;Summary: In this step, you will learn the consumer experience for APIs that have been exposed to your developer org:..\imagesanization. You login as a developer to register your application and then subscribe to the product just published and then test the API included in the product. We are referring to the Portal that is associated with the "remote" API Connect Cloud.</p>
</div>
<div class="sect3 data-line-626">
<h4 id="_open_the_portal_login_page">Open the Portal login page</h4>
<div class="paragraph data-line-627">
<p>You can get the URL of the portal associated to a catalog in the settings of this catalog.</p>
</div>
<div class="olist arabic data-line-629">
<ol class="arabic">
<li class="data-line-629">
<p>Go to the API Manager screen, in my case, <a href="https://manager.159.8.70.38.xip.io" class="undefined" data-href="https://manager.159.8.70.38.xip.io">https://manager.159.8.70.38.xip.io</a>.</p>
</li>
<li class="data-line-630">
<p>Click on Manage and click on the Integration Catalog tile (created previously and we assume that the Portal was instantiated for this catalog here)</p>
</li>
<li class="data-line-631">
<p>Choose the Settings tab, followed by the Portal option.</p>
</li>
<li class="data-line-632">
<p>Click on the Portal URL link to launch the Developer Portal</p>
</li>
</ol>
</div>
<div class="imageblock data-line-634">
<div class="content">
<img src="../images/launch-portal2018.png" alt="Launch Integration Portal">
</div>
</div>
<div class="olist arabic data-line-636">
<ol class="arabic">
<li class="data-line-636">
<p>Click on <strong>Quote Management Product 1.0.0 Product</strong> <strong>API Products</strong> to explore the API</p>
</li>
</ol>
</div>
<div class="imageblock data-line-638">
<div class="content">
<img src="../images/portal_QuoteProduct.png" alt="Quote Product in the Portal">
</div>
</div>
</div>
<div class="sect3 data-line-640">
<h4 id="_register_an_application_as_a_developer">Register an Application as a developer</h4>
<div class="paragraph data-line-642">
<p>Let&#8217;s now subscribe to the Product. You will log into the portal as a user in the application developer role, then register an application that will be used to consume APIs.</p>
</div>
<div class="paragraph data-line-644">
<p>If you have not created a developer account, you will need to use the <strong>Create an account</strong> link to do so now.</p>
</div>
<div class="imageblock data-line-646">
<div class="content">
<img src="../images/portal_createAcount.png" alt="Create account">
</div>
</div>
<div class="olist arabic data-line-649">
<ol class="arabic">
<li class="data-line-649">
<p>Enter in your account information for the developer account. This must be a different email address than your Bluemix account. Click <strong>Create New Account</strong> once all the requisite data in the form has been filled out.</p>
</li>
<li class="data-line-651">
<p>A validation email will be sent out to the email address used at sign-up. Click on the validation link and then you will have completed the sign-up process and will be authenticated into the page.</p>
</li>
<li class="data-line-653">
<p>Login into the developer portal as an application developer using your developer credentials.</p>
</li>
<li class="data-line-655">
<p>Click the Apps link, then click on the <strong>Create new App</strong> link.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-657">
<div class="content">
<img src="../images/portal_createAppButton.png" alt="Create app button">
</div>
</div>
<div class="olist arabic data-line-659">
<ol class="arabic">
<li class="data-line-659">
<p>Enter a title and description for the application and click the Submit button.</p>
<div class="literalblock data-line-661">
<div class="content">
<pre>&gt;Title: Mobile App Consumer</pre>
</div>
</div>
<div class="literalblock data-line-663">
<div class="content">
<pre>&gt;Description: Test Application for the various API products</pre>
</div>
</div>
<div class="literalblock data-line-665">
<div class="content">
<pre>&gt;OAuth Redirect URI: &lt; leave blank &gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="imageblock data-line-667">
<div class="content">
<img src="../images/portal_createAppInput.png" alt="Create app input">
</div>
</div>
<div class="paragraph data-line-669">
<p>We need to capture the Client Secret and Client ID in a text editor for later use by our test application.</p>
</div>
<div class="olist arabic data-line-671">
<ol class="arabic">
<li class="data-line-671">
<p>Select the Show check boxes for the Key and Secret.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-673">
<div class="content">
<img src="../images/portal_createAppKeys.png" alt="Create app keys">
</div>
</div>
<div class="olist arabic data-line-675">
<ol class="arabic">
<li class="data-line-675">
<p><strong>Copy Client Secret and Client ID in a text editor</strong> and keep them securely.</p>
</li>
</ol>
</div>
</div>
<div class="sect3 data-line-677">
<h4 id="_subscribe_to_a_plan_for_the_quotemgmt_product">Subscribe to a Plan for the "QuoteMgmt" product</h4>
<div class="paragraph data-line-679">
<p>In this section, we will subscribe to a plan for the "QuoteMgmt" using the Mobile App Consumer application.</p>
</div>
<div class="olist arabic data-line-681">
<ol class="arabic">
<li class="data-line-681">
<p>Click the <code><code>API Products link.</code></code></p>
</li>
<li class="data-line-682">
<p>Click the Quote Management Product (1.0.0) API product link.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-684">
<div class="content">
<img src="../images/portal_quoteMgmtProd.png" alt="Create app keys">
</div>
</div>
<div class="paragraph data-line-686">
<p>You will be directed to the Product page which lists the available plans for subscription.</p>
</div>
<div class="olist arabic data-line-688">
<ol class="arabic">
<li class="data-line-688">
<p>Click on the <strong>Subscribe</strong> button under the <strong>Default plan</strong>.</p>
</li>
<li class="data-line-689">
<p>Select the <strong>Mobile App Consumer</strong> toggle and click the <strong>Subscribe</strong> button.</p>
</li>
</ol>
</div>
<div class="paragraph data-line-691">
<p>The MobileApp Consumer application is now subscribed to the <strong>Default plan</strong> for the QuoteMgmt product.</p>
</div>
</div>
<div class="sect3 data-line-693">
<h4 id="_test_quotemgmt_apis_from_the_developer_portal">Test QuoteMgmt APIs from the Developer Portal</h4>
<div class="paragraph data-line-695">
<p>In this section, we will use the developer portal to test Quote Management API REST API. This is useful for application developers to try out the APIs before their application is fully developed or to simply see the expected response based on inputs, they provide the API. We will test the <strong>Quote Management API REST</strong> API from the developer portal.</p>
</div>
<div class="olist arabic data-line-697">
<ol class="arabic">
<li class="data-line-697">
<p>Click the <strong>Quote API</strong> link on the left-hand navigation menu and then expand the GET /quote path by clicking on the twisty next to the path, click on the Try it tab.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-699">
<div class="content">
<img src="../images/portal-testapi.png" alt="Test app">
</div>
</div>
<div class="olist arabic data-line-701">
<ol class="arabic">
<li class="data-line-701">
<p>Scroll down, click on the three <strong>Generate</strong> link to populate the values and click the Send button</p>
</li>
<li class="data-line-702">
<p>Scroll down below the Call operation button. You should see a 200 OK and a response body as shown below.
You get the response from the back end.
image::../images/portal-testsend.png[Test app]</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2 data-line-706">
<h3 id="_step_5_invoke_the_api">Step 5 - Invoke the API</h3>
<div class="paragraph data-line-708">
<p>Now that you have browsed the API Portal and registered / tested the API’s that <strong>Quote</strong> is providing, it’s time to test them out from a real application.</p>
</div>
<div class="paragraph data-line-710">
<p>Sample code (snippets) are provided from developer portal for different language (cUrl, Ruby, Python, PHP, JavaScript, Java, Go, Swift) .</p>
</div>
<div class="olist arabic data-line-712">
<ol class="arabic">
<li class="data-line-712">
<p>Login into the developer portal as an application developer using your developer credentials.</p>
</li>
<li class="data-line-713">
<p>Click the <strong>API Products</strong> link</p>
</li>
<li class="data-line-714">
<p>Click the <strong>Quote API (1.0.0)</strong> API link within the Quote Management Product.</p>
</li>
<li class="data-line-715">
<p>Now, you can discover all operations with their properties and on the right hand side sample code.</p>
</li>
<li class="data-line-716">
<p>Select an Operation, for example, <strong>POST /quote</strong></p>
</li>
<li class="data-line-717">
<p>On the right hand side you&#8217;ll see the <strong>curl</strong> expression</p>
</li>
<li class="data-line-718">
<p>Copy it into your text editor window replacing <strong>Client ID</strong> with your client id and your client secret saved from the prior step</p>
</li>
</ol>
</div>
<div class="listingblock data-line-720">
<div class="content">
<pre class="highlight"><code>curl --request POST \
  --url https://gw.159.8.70.38.xip.io/org1/integration/loans/v1/quote \
  --header 'accept: application/json' \
  --header 'content-type: application/json' \
  --header 'x-ibm-client-id: Client ID' \
  --data '{"loanAmount":"10000","annualInterestRate":"1.1","termInMonths":"36"}'</code></pre>
</div>
</div>
<div class="olist arabic data-line-729">
<ol class="arabic">
<li class="data-line-729">
<p>Copy and try it into your terminal windows</p>
</li>
</ol>
</div>
<div class="paragraph data-line-731">
<p>If all is OK, you should see the result of the quote in JSON format. (Below slightly modified for Windows)</p>
</div>
<div class="imageblock data-line-733">
<div class="content">
<img src="../images/portal-testcurl.png" alt="Portal curl">
</div>
</div>
</div>
<div class="sect2 data-line-735">
<h3 id="_step_6_analytics">Step 6 - Analytics</h3>
<div class="olist arabic data-line-737">
<ol class="arabic">
<li class="data-line-737">
<p>Return to the API Manager screen.</p>
</li>
<li class="data-line-738">
<p>Click on the Manage Catalogs tile and click on the <strong>Integration</strong> catalog tile.</p>
</li>
<li class="data-line-739">
<p>Click on the Analytics navigation menu.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-741">
<div class="content">
<img src="../images/manager-analytics.png" alt="Analytic screen">
</div>
</div>
<div class="olist arabic data-line-743">
<ol class="arabic">
<li class="data-line-743">
<p>Select the API Default dashboard.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-745">
<div class="content">
<img src="../images/manager-analytic-defaultdb.png" alt="Analytic icon app">
</div>
</div>
<div class="olist arabic data-line-747">
<ol class="arabic">
<li class="data-line-747">
<p>You can also look at all the events, click on Discover link and then on All events link</p>
</li>
</ol>
</div>
<div class="imageblock data-line-749">
<div class="content">
<img src="../images/manager-analytics-events.png" alt="Analytic icon app">
</div>
</div>
<div class="paragraph data-line-751">
<p>There are many dashboards provided out of the box and events discoveries that focus on specific aspects such as the latencies, the errors, the data sizes, etc&#8230;&#8203;
Do not hesitate to explore the various dashboards and events lists.
You can create your own dashboards and events lists with predefined filters.</p>
</div>
<div class="imageblock data-line-755">
<div class="content">
<img src="../images/manager-analytics-dashboards.png" alt="Analytic icon app">
</div>
</div>
</div>
<div class="sect2 data-line-757">
<h3 id="_step_7_create_a_soap_api">Step 7 - Create a SOAP API</h3>
<div class="paragraph data-line-758">
<p>This is very similar to the creation of a REST API. The big difference is that we use a WSDL. The explanations will be short. Before starting, it is important to understand what we try to achieve. In the designer (or the Manager), you find two different possibilities regarding the integration of an existing SOAP API from the WSDL defining this service. The first one is a SOAP proxy which means that we create an API (An Open API document) that exposes SOAP and accesses the SOAP service back end, the second one is a REST proxy which means that we create an API (An Open API document) that exposes REST/JSON and accesses the SOAP service back end. This is a very different scenario; we will discuss the difference of implementation in the next Step.</p>
</div>
<div class="olist arabic data-line-760">
<ol class="arabic">
<li class="data-line-760">
<p>Download the WSDL for the Branch SOAP Service, you can find it
[here](./materials/step7/BranchSOAP.wsdl).
You can also get the WSDL at the following URL <a href="https://addressmanagementwebservice.eu-gb.mybluemix.net/branches/Branches?WSDL" class="undefined" data-href="https://addressmanagementwebservice.eu-gb.mybluemix.net/branches/Branches?WSDL">https://addressmanagementwebservice.eu-gb.mybluemix.net/branches/Branches?WSDL</a></p>
</li>
<li class="data-line-764">
<p>In the Designer, click on Add API and select From existing WSDL service (SOAP proxy)</p>
</li>
</ol>
</div>
<div class="imageblock data-line-766">
<div class="content">
<img src="../images/manager-soap-create.png" alt="SOAP API Create">
</div>
</div>
<div class="olist arabic data-line-768">
<ol class="arabic">
<li class="data-line-768">
<p>Select the BranchSOAP.wsdl file to load</p>
</li>
</ol>
</div>
<div class="imageblock data-line-770">
<div class="content">
<img src="../images/designer-soap-create-load.png" alt="SOAP API Load">
</div>
</div>
<div class="paragraph data-line-772">
<p>and click Next.</p>
</div>
<div class="olist arabic data-line-774">
<ol class="arabic">
<li class="data-line-774">
<p>You can check the Service defined in the WSDL, click Next</p>
</li>
</ol>
</div>
<div class="imageblock data-line-776">
<div class="content">
<img src="../images/designer-soap-service-load.png" alt="SOAP API Load Service Def">
</div>
</div>
<div class="olist arabic data-line-778">
<ol class="arabic">
<li class="data-line-778">
<p>Review the API definitions such as name, version and description.
For example, add SOAP API to get Branches information for the description field, click Next button.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-781">
<div class="content">
<img src="../images/designer-soap-api-def-load.png" alt="SOAP API Load API Definition">
</div>
</div>
<div class="olist arabic data-line-783">
<ol class="arabic">
<li class="data-line-783">
<p>Review the Security and CORS definitions, click Next</p>
</li>
</ol>
</div>
<div class="imageblock data-line-785">
<div class="content">
<img src="../images/designer-soap-cors-load.png" alt="SOAP API Load CORS and Security">
</div>
</div>
<div class="olist arabic data-line-787">
<ol class="arabic">
<li class="data-line-787">
<p>Click Edit API button</p>
</li>
</ol>
</div>
<div class="imageblock data-line-789">
<div class="content">
<img src="../images/designer-soap-edit-load.png" alt="SOAP API Load end">
</div>
</div>
<div class="paragraph data-line-791">
<p>You can see what has been generated under the cover. As expected, the consume content type is text/xml and produce content type is application/xml in the assembly panel. In the assembly panel we see only one Invoke action, the invoke URL is the one extracted from the WSDL.</p>
</div>
<div class="imageblock data-line-793">
<div class="content">
<img src="../images/designer-soap-proxy-assembly.png" alt="SOAP Proxy Assembly">
</div>
</div>
<div class="paragraph data-line-795">
<p>We are going to test it. Go to the Assembly panel. Click on the Test icon and the Activate API button. Then choose an operation to test for example, post /getAllBranches, click on the generate link for the body parameter and click Invoke button. You should get a response from the SOAP backend service.</p>
</div>
<div class="imageblock data-line-797">
<div class="content">
<img src="../images/designer-soap-proxy-test-allB.png" alt="SOAP API Proxy test">
</div>
</div>
<div class="paragraph data-line-799">
<p>&gt;*Note:* We did not use a Properties and did not change the endpoint for the Proxy policy in the assembly panel, because the WSDL does have the correct endpoint on the Secure Gateway in Bluemix. You would probably want to create a property that will point to the right endpoint depending on the environment.
We did not publish the service in the integration catalog on the remote Manager since this is exactly the same procedure as for a REST Service.</p>
</div>
</div>
<div class="sect2 data-line-802">
<h3 id="_step_8_create_a_soap_to_rest_api">Step 8 - Create a SOAP to REST API</h3>
<div class="paragraph data-line-803">
<p>&gt;With the 2018 version, this step has been greatly simplified. Similarly to the previous step, we use the designer but instead of using SOAP proxy, we use a REST proxy. We will see that API Connect generates a lot of configurations automatically. Notice that SOAP to REST in this context means that we have a SOAP back end and we expose it in REST JSON, hence SOAP to REST. We could have had another view and call it REST to SOAP :-). We are not documenting all the steps to add the API because it is very similar to the previous step, the only difference being the selection of REST proxy at the very beginning.</p>
</div>
<div class="olist arabic data-line-805">
<ol class="arabic">
<li class="data-line-805">
<p>Click on Add and select New API</p>
</li>
</ol>
</div>
<div class="imageblock data-line-807">
<div class="content">
<img src="../images/designer-soap-rest-create.png" alt="SOAP API REST Create">
</div>
</div>
<div class="paragraph data-line-809">
<p>The next steps are as before. For the Info panel, I used:
&gt;Title: BranchesREST</p>
</div>
<div class="paragraph data-line-812">
<p>&gt;Description: REST exposure for the back end SOAP service</p>
</div>
<div class="paragraph data-line-814">
<p>At the end click on the Edit API button.</p>
</div>
<div class="paragraph data-line-816">
<p>Let&#8217;s see two seconds the definition, unlike the previous step, the consume and produce content-types are now application/json. The definitions have been auto generated. And we can see for the XSD elements corresponding JSON elements. This is a great feature and nice enhancement from the V5 version.</p>
</div>
<div class="imageblock data-line-818">
<div class="content">
<img src="../images/designer-soap-rest-definitions.png" alt="SOAP API REST Create">
</div>
</div>
<div class="paragraph data-line-820">
<p>We can see that in the Assembly, it is quite different than before.</p>
</div>
<div class="imageblock data-line-822">
<div class="content">
<img src="../images/designer-soap-rest-assembly.png" alt="SOAP API REST Create">
</div>
</div>
<div class="paragraph data-line-824">
<p>You can see that for each operation, there are two REST operations created a GET and a POST.
For each operation, you can see two mapping actions, REST to SOAP (for the request) and SOAP to REST (for the response).
You can also see that for each operation there are one or two parse actions. This is a very important concept to understand and also when to use it or not. By default, with the new API Gateway (Native Gateway) messages are streamed and messages are not buffered. This is a very efficient way to serve messages, since the messages can be sent directly to the back end even if the message was not received completely. This is a very common approaches when dealing with video streaming. Now, when you want to manipulate the message, you cannot do that, let&#8217;s say you want to remove some pieces especially at the beginning, so you must get the full message and to manipulate you need to get the message and parse it (in other words deserialize it). This is what the parse action does in those flows. Notice that this applies to JSON or XML since you may need to deserialize both types of messages. Of course, parsing a message has a cost in terms of resources and latency and the price will vary a lot depending on the size and complexity of the message.</p>
</div>
<div class="paragraph data-line-828">
<p>Looking at the mapping actions, we see that it is a very simple one and you have also the opportunity to make more complex ones. As you can see in the following sample, the response of the XML/SOAP message is simply copied to the response to the JSON response.</p>
</div>
<div class="imageblock data-line-830">
<div class="content">
<img src="../images/designer-soap-rest-map.png" alt="SOAP API REST Create">
</div>
</div>
<div class="paragraph data-line-832">
<p>Let&#8217;s test it, as usual we use the Test feature within the Assembly panel. We have a similar result than before, except that the response is in JSON (as the request).</p>
</div>
<div class="imageblock data-line-834">
<div class="content">
<img src="../images/designer-soap-rest-test.png" alt="SOAP API REST Create">
</div>
</div>
</div>
<div class="sect2 data-line-837">
<h3 id="_step_9_create_a_cloudant_service">Step 9 - Create a Cloudant service</h3>
<div class="paragraph data-line-838">
<p><strong>This section has not been updated yet because we want to show the new advanced security features included in 2018</strong></p>
</div>
<div class="paragraph data-line-840">
<p>To store our data used by our API, we will need a persistent storage. To do so, we will use a Cloudant NoSQL database, a JSON document-oriented store, compatible with CouchDB.</p>
</div>
<div class="paragraph data-line-842">
<p>You can use a existing Cloudant service or create an instance of the service Cloudant DB.</p>
</div>
<div class="olist arabic data-line-844">
<ol class="arabic">
<li class="data-line-844">
<p>Go to the Bluemix Catalog, create an instance of the service Cloudant NoSQL DB.</p>
</li>
<li class="data-line-846">
<p>Search for <strong>Cloudant</strong> in the catalog</p>
</li>
<li class="data-line-848">
<p>Select the free <strong>Lite</strong> plan</p>
</li>
<li class="data-line-850">
<p>Give it a name such as <strong>cloudant-db</strong>.</p>
</li>
<li class="data-line-852">
<p>Launch the Cloudant Dashboard. A new tab should open automatically with the list of databases.</p>
</li>
<li class="data-line-854">
<p>Create a new database with the button on top right corner. Call this database : <strong>test</strong>. Make sure to use this name as this is expected by the persistence layer of API Connect.</p>
</li>
<li class="data-line-856">
<p>Go back to Bluemix console and click the tab Service Credentials.</p>
<div class="literalblock data-line-858">
<div class="content">
<pre> ```
{
"credentials": {
    "username": "XXXXXX",
    "password": "XXXXXX",
    "host": "f9246334-58d1-4a97-8bde-34c30121f063-bluemix.cloudant.com",
    "port": 443,
    "url": "https://USERNAME:PASSWORD@f9246334-58d1-4a97-8bde-34c30121f063-bluemix.cloudant.com"
}
}</pre>
</div>
</div>
<div class="listingblock data-line-868">
<div class="content">
<pre class="highlight"><code>1. Copy the url, username and password from the credentials into your preferred text editor. we will use these values later.</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2 data-line-872">
<h3 id="_step_10_create_a_loopback_application">Step 10 - Create a LoopBack application</h3>
<div class="paragraph data-line-873">
<p><strong>This section has not been updated yet because we want to show the new advanced security features included in 2018</strong></p>
</div>
<div class="paragraph data-line-875">
<p>API Connect comes with a developer toolkit. This toolkit provides an offline graphical user interface named API Designer for creating APIs, the LoopBack framework for developing REST applications, a local unit test environment that includes a Micro Gateway for testing APIs and a set of command line tools for augmenting the development toolset and assisting devops engineers with continuous integration and delivery.</p>
</div>
<div class="olist arabic data-line-877">
<ol class="arabic">
<li class="data-line-877">
<p>Get help on the <strong>apic</strong> command set:
<code>`
apic -h
</code>`</p>
</li>
</ol>
</div>
<div class="paragraph data-line-882">
<p>The developer toolkit provides an integrated development environment for developing APIs and applications that use the LoopBack framework.</p>
</div>
<div class="paragraph data-line-884">
<p>To create a new LoopBack project, use the command apic loopback; then use the apic edit command to edit the project in the API Designer.</p>
</div>
<div class="paragraph data-line-886">
<p>&gt;*Note*: When working with the toolkit always be careful of where you are located on your file system. The working directory from where the apic command are started will be considered as the root of the loopback projects and products/APIs you are working at some point. Cautious must be taken on how you organize the directories. It also must take in considerations that at some point you will want to source control some of the generated files (such as the yaml files for example) in a Source Control Management system such as GitHub.</p>
</div>
<div class="olist arabic data-line-889">
<ol class="arabic">
<li class="data-line-889">
<p>Create an API Connect LoopBack application.</p>
<div class="literalblock data-line-891">
<div class="content">
<pre>```
$ mkdir -p &lt;your-favourite-working-dir&gt;/apic/myfirstproject
$ cd &lt;your-favourite-working-dir&gt;/apic/myfirstproject
$ apic loopback
```</pre>
</div>
</div>
<div class="literalblock data-line-897">
<div class="content">
<pre>Next you will be asked to supply the name of the directory where the application will be created. Enter *Customer*</pre>
</div>
</div>
<div class="literalblock data-line-899">
<div class="content">
<pre>```
What's the name of your application? Quote
```</pre>
</div>
</div>
</li>
<li class="data-line-903">
<p>LoopBack will default the project directory name to the name of the application.</p>
</li>
<li class="data-line-905">
<p>Press the <strong>Enter</strong> or <strong>Return</strong> key to accept the default value of inventory.</p>
</li>
<li class="data-line-907">
<p>Next you will be asked to select the type of application. Use the arrow keys to select the <strong>empty-server</strong> option and press the <strong>Enter</strong> or <strong>Return</strong> key.</p>
</li>
</ol>
</div>
<div class="listingblock data-line-909">
<div class="content">
<pre class="highlight"><code>❯ empty-server (An empty LoopBack API, without any configured models or data sources)</code></pre>
</div>
</div>
<div class="olist arabic data-line-913">
<ol class="arabic">
<li class="data-line-913">
<p>At this point, the project builder will install the core dependencies for our Node.js application.</p>
<div class="literalblock data-line-915">
<div class="content">
<pre>```
? Please review the license for API Connect available in /usr/local/lib/node_modules/apiconnect/LICENSE.txt and select yes to accept. yes arrow keys)
? What's the name of your application? Customer
? Enter name of the directory to contain the project: Customer
? What kind of application do you have in mind? empty-server (An empty LoopBack API, without any configured models or data sources)
```</pre>
</div>
</div>
</li>
<li class="data-line-922">
<p>Change directory to your application directory</p>
<div class="literalblock data-line-924">
<div class="content">
<pre>```
cd Customer
```</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect4 data-line-928">
<h5 id="_create_a_data_source_connector_to_cloudant">Create a Data source Connector to Cloudant</h5>
<div class="paragraph data-line-930">
<p>The data source is what allows the API to communicate with the backend data repository. In this case we will be using Cloudant to store the data item information.</p>
</div>
<div class="paragraph data-line-932">
<p>There are two parts to this. First is the definition of how to connect to the backend system. The second is downloading the actual loopback connector for Cloudant.</p>
</div>
<div class="paragraph data-line-934">
<p>In your terminal ensure that you are in the <strong>Customer</strong> directory.</p>
</div>
<div class="literalblock data-line-936">
<div class="content">
<pre>```
cd Customer
```</pre>
</div>
</div>
<div class="paragraph data-line-940">
<p>In your terminal, type:</p>
</div>
<div class="literalblock data-line-942">
<div class="content">
<pre>```
apic create --type datasource
```</pre>
</div>
</div>
<div class="literalblock data-line-946">
<div class="content">
<pre>The terminal will bring up the configuration wizard for our new data source for the item database. The configuration wizard will prompt you with a series of questions. Some questions require text input, others offer a selectable menu of pre-defined choices.</pre>
</div>
</div>
<div class="paragraph data-line-948">
<p>Answer the questions with the following data:</p>
</div>
<div class="paragraph data-line-950">
<p>NOTE:For <strong>Connection String url</strong> paste the previous value you copied about Cloudant credential in Step 1</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-952">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Option name</th>
<th class="tableblock halign-left valign-top">Values</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enter the data-source name :</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>db</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Select the connector for db :</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IBM Cloudant DB</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection String URL to override other settings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>YOUR Connection URL <a href="https://username:password@host" class="undefined" data-href="https://username:password@host">https://username:password@host</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">database :</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>test</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username :</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password :</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">modelIndex :</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Install loopback-connector-cloudant@^1.0.4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Y</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-964">
<p>Example :</p>
</div>
<div class="listingblock data-line-966">
<div class="content">
<pre class="highlight"><code>? Enter the data-source name: db
? Select the connector for db: IBM Cloudant DB (supported by StrongLoop)
Connector-specific configuration:
? Connection String URL to override other settings (e.g.: https://username:password@host): https:
//a836946d-92b5-41cc-b730-442b4235aae8-bluemix:7911bb5592e65f126903c59f6fa3d7f3b5bd4a1141951e31
938b6c6cb2efa852@a836946d-92b5-41cc-b730-442b4235aae8-bluemix.cloudant.com
? database: test
? username:
? password:
? modelIndex:
? Install loopback-connector-cloudant@^1.0.4 Yes</code></pre>
</div>
</div>
<div class="paragraph data-line-981">
<p>NOTE:
By typing Y (Yes) to the question Install loopback-connector-cloudant, the Cloudant Connector will be downloaded and saved to your project automatically.</p>
</div>
<div class="paragraph data-line-984">
<p>&gt;This will create a connection profile in the ~/Customer/server/datasources.json file. It is effectively the same as running the following to install the connector:</p>
</div>
<div class="paragraph data-line-986">
<p>&gt;npm install loopback-connector-cloudant --save</p>
</div>
<div class="paragraph data-line-988">
<p>&gt;For more information on the LoopBack Connector for Cloudant, see: <a href="https://www.npmjs.com/package/loopback-connector-cloudant" class="undefined" data-href="https://www.npmjs.com/package/loopback-connector-cloudant">https://www.npmjs.com/package/loopback-connector-cloudant</a></p>
</div>
<div class="admonitionblock note data-line-991">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can create an api directly from an existing web service from the WSDL. Create a SOAP API definition from a WSDL definition file, or a .zip file that contains the WSDL definition files for a service with the following command: <code><code>apic create --type api --wsdl filename</code></code>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note data-line-993">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can create an API or Product from an Open API (Swagger 2.0) template file by using the '--template template-name' option.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2 data-line-996">
<h3 id="_step_11_manage_your_api_in_api_designer">Step 11 - Manage your API in API Designer</h3>
<div class="olist arabic data-line-998">
<ol class="arabic">
<li class="data-line-998">
<p>Launch API Connect Designer</p>
<div class="literalblock data-line-1000">
<div class="content">
<pre>```
apic edit
```</pre>
</div>
</div>
<div class="literalblock data-line-1004">
<div class="content">
<pre>If the designer started correctly, a webpage will automatically open and the terminal will show a message similar to this one:</pre>
</div>
</div>
<div class="literalblock data-line-1006">
<div class="content">
<pre>```
Express server listening on http://127.0.0.1:9000
```</pre>
</div>
</div>
</li>
<li class="data-line-1010">
<p>Click <strong>Sign in with Bluemix</strong>. If you&#8217;re already sign in with Bluemix, you&#8217;ll be automatically signed into the designer.</p>
</li>
<li class="data-line-1012">
<p>The designer opens into the APIs section showing the API definition we created from the command line.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-1014">
<div class="content">
<img src="../images/apic-firstscreen.png" alt="APIC Screenshot">
</div>
</div>
<div class="sect4 data-line-1016">
<h5 id="_create_a_model_for_the_customer_items">Create a Model for the <strong>Customer</strong> items</h5>
<div class="paragraph data-line-1018">
<p>In this section, you will define the item data model for our <strong>Customer</strong> API and attach it to the Cloudant datasource. LoopBack is a data model driven framework. The properties of the data model will become the JSON elements of the API request and response payloads.</p>
</div>
<div class="olist arabic data-line-1020">
<ol class="arabic">
<li class="data-line-1020">
<p>Click the <strong>Models</strong> tab.</p>
</li>
<li class="data-line-1022">
<p>Click the <code><code>+ Add</code></code> button.</p>
</li>
<li class="data-line-1024">
<p>In the New LoopBack Model dialog, enter <strong>Customer</strong> as the model name, then click the New button.</p>
</li>
<li class="data-line-1026">
<p>When the Model edit page for the item model displays, select the <strong>db</strong> Data Source:</p>
</li>
</ol>
</div>
<div class="sect5 data-line-1028">
<h6 id="_create_properties_for_the_customer_model">Create Properties for the Customer Model</h6>
<div class="paragraph data-line-1030">
<p>The <code><code>Customer</code></code> table in the database has 6 columns that will need to map as well. To start creating properties for the item model:</p>
</div>
<div class="olist arabic data-line-1032">
<ol class="arabic">
<li class="data-line-1032">
<p>Click the <code><code>+ button</code></code> in the Properties section.</p>
</li>
<li class="data-line-1034">
<p>The <code><code>Customer</code></code> data model consists of six properties. Use the data below to add each of the properties:</p>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1036">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Required</th>
<th class="tableblock halign-left valign-top">Property Name</th>
<th class="tableblock halign-left valign-top">Is Array</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">ID</th>
<th class="tableblock halign-left valign-top">Index</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">age</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Age</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic data-line-1043">
<ol class="arabic">
<li class="data-line-1043">
<p>Scroll to the top of the page and click the <strong>Save button</strong> to save the data model.</p>
</li>
</ol>
</div>
<div class="imageblock data-line-1045">
<div class="content">
<img src="../images/allmodel.png" alt="All Models">
</div>
</div>
<div class="olist arabic data-line-1047">
<ol class="arabic">
<li class="data-line-1047">
<p>Click the All Models link to return to the main API Designer page.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-1050">
<h3 id="_step_12_using_oauth_to_protect_your_api">Step 12 - Using OAuth to protect your API</h3>
<div class="paragraph data-line-1052">
<p>In the materials, you also find a POSTMAN collection (alongside the environment definitions). You may have to change the env file to have it working for your environment.</p>
</div>
<div class="paragraph data-line-1054">
<p>To perform all the scenarios below, we are going to use the same API that will be versioned, each version will have a different security scheme and a different base path /fakemagento/v&lt;n&gt;, for example, /fakemagento/v1. In the table below, the version refers to the version of the fake magento API with different security mechanisms.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1056">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Version</th>
<th class="tableblock halign-left valign-top">Security scheme</th>
<th class="tableblock halign-left valign-top">Referred as</th>
<th class="tableblock halign-left valign-top">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_protecting_an_api_with_an_api_key">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">API Key + Basic Authentication</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_protecting_an_api_with_basic_authentication">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource Owner Password Credentials Grant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource owner - Password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_oauth_resource_owner_password_credentials_grant">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Code grant + OIDC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_authorization_code_grant_and_oidc">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client Credentials grant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_oauth_client_credentials_grant">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implicit grant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Implicit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_oauth_implicit_grant">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External OAuth Provider</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_external_oauth_provider">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">V8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom JWT Generate and Validate</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_jwt_generate_and_validate">here</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Using an OIDC Registry to protect the platform</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_using_an_oidc_registry_to_protect_the_platform">here</a></p></td>
</tr>
</tbody>
</table>
<div class="sect3 data-line-1070">
<h4 id="_introduction_2">Introduction</h4>
<div class="paragraph data-line-1071">
<p>OAuth - Open Authorization is a great and modern security mechanism. It is used for two main cases: authentication and authorization. The very nice thing with OAuth is that there is a full control on the life of the token (client side or server side), it is possible to refresh the token, meaning being able to recreate an access token without the need of re-entering the user&#8217;s credentials, it is possible to perform authorization with the notion of scope, it is possible to authorize a third party to access your data without authenticating (or using your credentials) to this third party, it is possible to revoke the token, a lot of very good things. The only limitation was the content of the token regarding the identity of the parties, this is basically a UUID, but this limitation is corrected with OpenID Connect. One difficulty with OAuth is coming from its flexibility, it is so flexible that it implies a lot of various ways to use OAuth, choices to use different grant types, the way to extract the identity, to perform authentication, to control the revocation and introspection, the way the scope and the consents are handled, the redirection, etc …</p>
</div>
<div class="paragraph data-line-1073">
<p>We cannot work with OAuth without mentioning the various specifications around OAuth. And as usual with pretty recent technology, they evolve quite a lot. The Resource Owner Password Credentials scenario demonstrated below is not popular anymore.
Below is a table with the main specificatiNOTE:ons.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1075">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth 2.0 Core (RFC   6749)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc6749" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc6749">https://datatracker.ietf.org/doc/html/rfc6749</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bearer Token Usage (RFC 6750)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc6750" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc6750">https://datatracker.ietf.org/doc/html/rfc6750</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PKCE: Proof Key for Code Exchange (RFC 7636)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7636" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7636">https://datatracker.ietf.org/doc/html/rfc7636</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threat Model and Security Considerations (RFC 6819)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc6819" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc6819">https://datatracker.ietf.org/doc/html/rfc6819</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth 2.0 Security Best Current Practice (Security BCP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics" class="undefined" data-href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-security-topics</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token Revocation (RFC 7009)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7009" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7009">https://datatracker.ietf.org/doc/html/rfc7009</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Token Introspection (RFC 7662)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7662" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7662">https://datatracker.ietf.org/doc/html/rfc7662</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT Profile for OAuth Access Tokens (RFC 9068)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc9068" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc9068">https://datatracker.ietf.org/doc/html/rfc9068</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth 2.0 for Native Apps (RFC 8252)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc8252" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc8252">https://datatracker.ietf.org/doc/html/rfc8252</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Browser-Based Apps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps" class="undefined" data-href="http://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps">http://datatracker.ietf.org/doc/html/draft-ietf-oauth-browser-based-apps</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Device Authorization Grant (RFC 8628)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc8628" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc8628">https://datatracker.ietf.org/doc/html/rfc8628</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenID Connect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://openid.net/connect/" class="undefined" data-href="https://openid.net/connect/">https://openid.net/connect/</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authorization Server Metadata (RFC 8414)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc8414" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc8414">https://datatracker.ietf.org/doc/html/rfc8414</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Client Registration (RFC 7591)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7591" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7591">https://datatracker.ietf.org/doc/html/rfc7591</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic Client Management (RFC 7592)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7592" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7592">https://datatracker.ietf.org/doc/html/rfc7592</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High Security: Pushed Authorization Requests (RFC 9126)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc9126" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc9126">https://datatracker.ietf.org/doc/html/rfc9126</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT Authorization Request (RFC 9101)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc9101" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc9101">https://datatracker.ietf.org/doc/html/rfc9101</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mutual TLS Bound Access Tokens (RFC 8705)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc8705" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc8705">https://datatracker.ietf.org/doc/html/rfc8705</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rich Authorization Requests</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-rar" class="undefined" data-href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-rar">https://datatracker.ietf.org/doc/html/draft-ietf-oauth-rar</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DPoP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/draft-fett-oauth-dpop" class="undefined" data-href="https://datatracker.ietf.org/doc/html/draft-fett-oauth-dpop">https://datatracker.ietf.org/doc/html/draft-fett-oauth-dpop</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Assertion Framework (RFC 7521)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7521" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7521">https://datatracker.ietf.org/doc/html/rfc7521</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JWT Profile for Client Authentication   (RFC 7523)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7523" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7523">https://datatracker.ietf.org/doc/html/rfc7523</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SAML Assertions (RFC 7522)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://datatracker.ietf.org/doc/html/rfc7522" class="undefined" data-href="https://datatracker.ietf.org/doc/html/rfc7522">https://datatracker.ietf.org/doc/html/rfc7522</a></p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1104">
<p>JSON Web Key (JWK) is specified at [RFC 7517](<a href="https://tools.ietf.org/html/rfc7517" class="undefined" data-href="https://tools.ietf.org/html/rfc7517">https://tools.ietf.org/html/rfc7517</a> "RFC 7517 Specification").
A JSON Web Key (JWK) is a JavaScript Object Notation (JSON) data structure that represents a cryptographic key.
I&#8217;m using a Simple JSON Web Key generator: [mkjwk](<a href="https://mkjwk.org/" class="undefined" data-href="https://mkjwk.org/">https://mkjwk.org/</a> "Simple JSON Web Key generator ").
OIDC specification is based on the use of the idtoken which is a JSON Web Token - JWT specified at [RFC 7519](<a href="https://tools.ietf.org/html/rfc7519" class="undefined" data-href="https://tools.ietf.org/html/rfc7519">https://tools.ietf.org/html/rfc7519</a> "RFC 7519 Specification").</p>
</div>
</div>
<div class="sect3 data-line-1109">
<h4 id="_preparing_the_environment_fake_authentication_url_api">Preparing the environment - Fake Authentication URL API</h4>
<div class="paragraph data-line-1110">
<p>To perform some more advanced scenarii with security, we need a user registry where all the users are defined. There are several types of user registries for user authentication supported in API Connect:</p>
</div>
<div class="ulist data-line-1112">
<ul>
<li class="data-line-1112">
<p>Authentication URL User Registry - Based on an authentication URL (Following a simple HTTP/S based invocation)</p>
</li>
<li class="data-line-1113">
<p>LDAP User Registry - Based on a LDAP server (Standard LDAP integration)</p>
</li>
<li class="data-line-1114">
<p>Local User Registry - Based on API Connect Local User Registry (Internal registry of the solution)</p>
</li>
<li class="data-line-1115">
<p>OpenID Connect (OIDC) - Configure user authentication using JSON Web Tokens (External OIDC provider)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1117">
<p>Because we do not want to spend too much time to install an LDAP server, for simplicity of usage, we create a small API that will perform the role of an Authentication URL User Registry. The principle is very easy, if the password is equal to the uid, the user is authenticated, if not equal then the user in unauthenticated. <strong>This is for educational purpose only and is of course not secured and should not be used in a production environment</strong>. But this is perfect for educational purpose, and it is also an example of using API Connect with some gateway script samples.</p>
</div>
<div class="paragraph data-line-1119">
<p>The API provided contains a few more paths (operations) than what we describe here. We only describe the /basic-auth path. Below a screen capture of the  API assembly.</p>
</div>
<div class="imageblock data-line-1121">
<div class="content">
<img src="../images/V10_API-FakeURLUserRegistry-Assembly.png" alt="Fake Authentication URL Assembly">
</div>
</div>
<div class="paragraph data-line-1123">
<p>Below the processing performed in the "BA authc logic" gateway JavaScript:</p>
</div>
<div class="ulist data-line-1125">
<ul>
<li class="data-line-1125">
<p>Line 1: Get the Basic Authorization header and split it based on space, it must contain Basic: <code>&lt;base 64 encoding of uid:password&gt;</code></p>
</li>
<li class="data-line-1126">
<p>Line 2: Takes the uid:password base 64 and decode it. Then separate uid and password, separator :.</p>
</li>
<li class="data-line-1127">
<p>Line 7: Create a response header called <strong>api-authenticated-credential</strong> with the CN of the user with a hard coded email domain name.</p>
</li>
<li class="data-line-1128">
<p>Line 10: Provide the body of the response following the expected body as defined in the documentation.</p>
</li>
<li class="data-line-1129">
<p>Line 12: If username is different from password then returns UNAUTHENTICATED.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-1132">
<div class="content">
<pre class="highlight"><code>1 var reqauth =  context.get('request.headers.authorization').split(' ');
2 var splitval = new Buffer((reqauth[1] || ''), 'base64').toString('utf8').split(':');
3 var username = splitval[0] || '';
4 var password = splitval[1] || '';
5 console.error('&gt;&gt;&gt; User credentials: [' + username + ':' + password + ']');
6 if (username ===  password ) {
7 	context.set('message.headers.api-authenticated-credential', 'cn=' + username + ',email=' + username + '@fr.ibm.com');
8 	context.set('message.status.code', 200);
9 	context.set('message.headers.content-type', 'application/json');
10     context.message.body.write({username: username, email: username + '@fr.ibm.com', first_name: username, last_name: username});
11 } else {
12 	context.set('message.status.code', 401);
13 }</code></pre>
</div>
</div>
<div class="paragraph data-line-1148">
<p>Here are some characteristics of this API:</p>
</div>
<div class="ulist data-line-1150">
<ul>
<li class="data-line-1150">
<p>Base path:  /fakeauth/v1</p>
</li>
<li class="data-line-1151">
<p>No security, not even an API Key.</p>
</li>
<li class="data-line-1152">
<p>Four paths: /basic-auth (GET), /authenticate	(POST), /authenticate/{uid}/{pwd}	GET, /ping (GET)
Two definitions:</p>
</li>
<li class="data-line-1154">
<p>UserCredential	object	Object containing the credentials to perform authentication (uid and password)</p>
</li>
<li class="data-line-1155">
<p>AuthenticatedUser	object	Object returned when a user is authenticated</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1157">
<p>Here are the YAML definitions: [Fake Authentication API Open API Document](./materials/fakeauthenticationurl_1.0.0.yaml "FakeAuthenticationURL-1.0.0 API") and [Fake Authentication Product Open API Document](./materials/fakeauthenticationurlproduct_1.0.0.yaml "FakeAuthenticationProduct-1.0.0 Product").</p>
</div>
<div class="paragraph data-line-1159">
<p>You need to publish the API, let&#8217;s say in our Integration catalog. You can use the Web UI or like in my case use the CLI to do that.</p>
</div>
<div class="listingblock data-line-1160">
<div class="content">
<pre class="highlight"><code>apic login -s &lt;manager endpoint&gt; -u &lt;uid&gt; -p &lt;pwd&gt; -r provider/default-idp-2
apic products:publish -c integration -o org1 -s &lt;manager endpoint&gt; --scope catalog fakeauthenticationproduct_1.0.0.yaml</code></pre>
</div>
</div>
<div class="paragraph data-line-1164">
<p>We can now test the Fake authentication API</p>
</div>
<div class="paragraph data-line-1166">
<p>Request</p>
</div>
<div class="listingblock data-line-1167">
<div class="content">
<pre class="highlight"><code>curl -k -H "Accept: application/json" -H "Authorization: Basic: Zm9vOmZvbw" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/integration/fakeauth/v1/basic-auth</code></pre>
</div>
</div>
<div class="paragraph data-line-1171">
<p>Here is a sample response (formatted):</p>
</div>
<div class="listingblock data-line-1172">
<div class="content">
<pre class="highlight"><code>{
  "username" : "foo",
  "email" : "foo@fr.ibm.com",
  "first_name" : "foo",
  "last_name" : "foo"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1181">
<p>At this stage, we have configured the Fake Authentication URL API that we will use in the next chapters. Of course, in real life that would be more of a user registry or OIDC provider that should be used.</p>
</div>
</div>
<div class="sect3 data-line-1183">
<h4 id="_protecting_an_api_with_an_api_key">Protecting an API with an API key</h4>
<div class="paragraph data-line-1184">
<p>This chapter is only to illustrate the version V1 of the fakemagento API. This API does not contains an Invoke action, but rather a series of actions to demonstrate various capability of API Connect. Among them, we use a parse action, several gateway scripts, a validate action and a map.</p>
</div>
<div class="imageblock data-line-1186">
<div class="content">
<img src="../images/V10_fake-magento-v1-assembly.png" alt="Fake magento assembly">
</div>
</div>
<div class="paragraph data-line-1188">
<p>The important parts that we will change in the lab are the base path, the description to indicate the security mechanism used, the security requirement and security scheme.
It is important to change the base path to have deterministic results when invoking the API to have a different endpoint.</p>
</div>
<div class="sect4 data-line-1191">
<h5 id="_tests">Tests</h5>
<div class="sect5 data-line-1193">
<h6 id="_test_using_explorer">Test using Explorer</h6>
<div class="paragraph data-line-1194">
<p>Below, an invocation using the web explorer, showing the use of the API key client id only. Go to the Explorer, click on generte to get a sample body, and then click on the Send button.</p>
</div>
<div class="imageblock data-line-1196">
<div class="content">
<img src="../images/V10_fake-magento-v1-api-key.png" alt="Invoking the Fake magento API key">
</div>
</div>
<div class="paragraph data-line-1198">
<p>Notice the name of the element contains begins with an n in the response, result of the map action.</p>
</div>
</div>
<div class="sect5 data-line-1200">
<h6 id="_test_using_curl">Test using curl</h6>
<div class="paragraph data-line-1201">
<p>Request</p>
</div>
<div class="listingblock data-line-1202">
<div class="content">
<pre class="highlight"><code>curl -k --url https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/fakemagento/v1/order -H "X-IBM-Client-Id: d02c553d2f05277d91f6fb0189cc13c6" -H "accept: application/json" -H "content-type: application/json" --data "{   \"orderDetails\": \"2 plates\",   \"orderDate\": \"2019-12-25T10:00:00.000Z\" }" | jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1205">
<p>Response</p>
</div>
<div class="listingblock data-line-1206">
<div class="content">
<pre class="highlight"><code>{
  "norderId": "7275084087558144",
  "norderResult": true,
  "norderDetails": "2 plates",
  "norderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-1214">
<h4 id="_protecting_an_api_with_basic_authentication">Protecting an API with Basic Authentication</h4>
<div class="paragraph data-line-1215">
<p>First, please consider that using Basic Authentication is not the best and most secured approach! The reason we have this test, is because it is a simple way to check that the <strong>Fake Authentication URL API</strong> is correctly working and can be used to secure an API. If I may make a parallel with a Web application, using Basic Authentication is as secured as using it for a Web application. A 401-challenge compared to a form-based authentication will imply that every request contains the uid/pwd, not very secured indeed.</p>
</div>
<div class="paragraph data-line-1217">
<p>There is an important design decision regarding what is the scope of the resource we are going to configure. Resource, here, means User Registries, TLS configurations and OAuth Providers. Should they apply and be visible for only one organization, or should it be defined for all organizations. In our case, we have taken the decision that the resources will be defined for all organizations and so we defined them in the Cloud Management Console. We could have decided to do it for each organization so they all would have their specific configurations.</p>
</div>
<div class="paragraph data-line-1219">
<p>The list of Steps is the following:
* In the Cloud Management console, define the User Registry based on the <strong>Fake Authentication URL API</strong>
* In the Manager console, associate the user registry with the Catalogs
* Configure the API security to use Basic Authentication and publish it into the catalog
* Test and validate that everything is working</p>
</div>
<div class="paragraph data-line-1225">
<p>To add the User Registry, go in Cloud Management Console, click on Resources on the navigation panel, click on Create button.</p>
</div>
<div class="imageblock data-line-1227">
<div class="content">
<img src="../images/V10_cmc-create-user-registry.png" alt="Create User Registry">
</div>
</div>
<div class="paragraph data-line-1229">
<p>Select Authentication URL User Registry</p>
</div>
<div class="imageblock data-line-1231">
<div class="content">
<img src="../images/V10_cmc-user-registry-definition.png" alt="User Registry definitions start">
</div>
</div>
<div class="paragraph data-line-1233">
<p>Enter the following Information:
&gt;Title: SampleAuthURL</p>
</div>
<div class="ulist data-line-1236">
<ul>
<li class="data-line-1236">
<p>Summary: Created by OAuth Provider configuration as a sample. Make sure to update the OAuth Providers using this sample with a valid User Registry.</p>
</li>
<li class="data-line-1237">
<p>URL: <a href="https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0001.par01.containers.appdomain.cloud/org1/production/fakeauth/v1/basic-auth" class="undefined" data-href="https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0001.par01.containers.appdomain.cloud/org1/production/fakeauth/v1/basic-auth">https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0001.par01.containers.appdomain.cloud/org1/production/fakeauth/v1/basic-auth</a></p>
</li>
<li class="data-line-1238">
<p>TLS Client Profile: Select Default TLS Client Profile</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1240">
<div class="content">
<img src="../images/V10_cmc-user-registry-definition-values.png" alt="User Registry definitions">
</div>
</div>
<div class="paragraph data-line-1242">
<p>Click on Save. You have now defined a User registry at the platform level. It can be reused by the different organizations.</p>
</div>
<div class="paragraph data-line-1244">
<p>To associate the user registry with the Catalog, go in the Manager console, click on Manage, select the catalog where you want to use the user registry just created</p>
</div>
<div class="imageblock data-line-1246">
<div class="content">
<img src="../images/V10_manager-user-registry-edit.png" alt="User Registry definitions in the Catalog start">
</div>
</div>
<div class="paragraph data-line-1248">
<p>Click on User Registries, then on Catalog Settings</p>
</div>
<div class="imageblock data-line-1250">
<div class="content">
<img src="../images/V10_cmc-user-registry-definition-catalog-settings.png" alt="User Registry definitions in the Catalog start">
</div>
</div>
<div class="paragraph data-line-1252">
<p>Click on the checkbox for the SampleAuthURL and click Save button.</p>
</div>
<div class="imageblock data-line-1254">
<div class="content">
<img src="../images/V10_manager-user-registry-select.png" alt="User Registry definitions in the Catalog">
</div>
</div>
<div class="paragraph data-line-1256">
<p>Now, let&#8217;s configure the security for the API. In the Manager, click on the Develop menu, import the fakemagento API. This is the initial API to work with and it is available in the materials folder. It is at version 1.0. Now, we can edit the Security Definitions section and Add the Basic Authentication, click on Add.
Enter
&gt;Name: BA Protection</p>
</div>
<div class="ulist data-line-1260">
<ul>
<li class="data-line-1260">
<p>Type: Select Basic</p>
</li>
<li class="data-line-1261">
<p>Select SampleAuthURL for the <strong>Authenticate using User Registry</strong></p>
</li>
</ul>
</div>
<div class="imageblock data-line-1263">
<div class="content">
<img src="../images/V10_manager-BA-Security-definition.png" alt="Basic authentication Security Definition">
</div>
</div>
<div class="paragraph data-line-1265">
<p>In the Security section, select BA Protection.</p>
</div>
<div class="imageblock data-line-1267">
<div class="content">
<img src="../images/V10_manager-BA-Security-section.png" alt="Basic authentication Security section">
</div>
</div>
<div class="paragraph data-line-1269">
<p>Create a product and publish it to the Integration Catalog, then subscribe to it. (Not explained here, see previous steps).</p>
</div>
<div class="paragraph data-line-1271">
<p>We can now test the API. The credentials are in the Authorization header.</p>
</div>
<div class="sect4 data-line-1273">
<h5 id="_tests_2">Tests</h5>
<div class="sect5 data-line-1274">
<h6 id="_test_with_explorer">Test with Explorer</h6>
<div class="paragraph data-line-1275">
<p>You can use the Explorer to test the API.</p>
</div>
<div class="imageblock data-line-1277">
<div class="content">
<img src="../images/test-in-explorer.png" alt="Test in explorer">
</div>
</div>
</div>
<div class="sect5 data-line-1279">
<h6 id="_test_with_curl">Test With curl</h6>
<div class="paragraph data-line-1280">
<p>Below the equivalent with curl (on Windows):</p>
</div>
<div class="listingblock data-line-1281">
<div class="content">
<pre class="highlight"><code>curl -k -H "Content-Type: application/json" -H "Accept: application/json" -H "X-IBM-Client-Id: 3beaa6887601bb3a6c5f802e67372535" -H "Authorization: Basic Zm9vOmZvbw==" -d "{   \"orderDetails\": \"2 plates\", \"orderDate\": \"2019-12-25T10:00:00.000Z\"}" "https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/fakemagento/v2/order" | jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1284">
<p>You should obtain a response:</p>
</div>
<div class="listingblock data-line-1285">
<div class="content">
<pre class="highlight"><code>{
  "norderId": "7275084087558144",
  "norderResult": true,
  "norderDetails": "2 plates",
  "norderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
</div>
<div class="sect5 data-line-1293">
<h6 id="_test_with_postman">Test with POSTMAN</h6>
<div class="paragraph data-line-1295">
<p>Here, I&#8217;m introducing the POSTMAN collection.
In the POSTMAN, there is a number of requests that you can adapt for your environment.
The collection is called: API Education. The environment that you need to adjust for your environment is called: API_Education.</p>
</div>
<div class="paragraph data-line-1299">
<p>To test the API with Basic Authentication security. You can use the <strong>FakeMagentoOrderBA V2</strong> API.</p>
</div>
<div class="imageblock data-line-1301">
<div class="content">
<img src="../images/postman-ba-test.png" alt="Postman Basic Authentication test">
</div>
</div>
<div class="paragraph data-line-1303">
<p>Clicking on Send button will give you the expected result.</p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-1305">
<h4 id="_oauth_resource_owner_password_credentials_grant">OAuth Resource Owner Password Credentials grant</h4>
<div class="paragraph data-line-1306">
<p>The first test was not based on OAuth, all the following ones are. We will use two OAuth providers only. One for native support, API Connect acting as an OAuth/OIDC provider and one for third party integration, using IBM  AppId, one of IBM Cloud solution for OAuth/OIDC support.
The Resource Owner Password Credentials grant type is specified in [RFC 6749 - OAuth 2.0 Authorization Framework](<a href="https://tools.ietf.org/html/rfc6749" class="undefined" data-href="https://tools.ietf.org/html/rfc6749">https://tools.ietf.org/html/rfc6749</a> "The OAuth 2.0 Authorization Framework Specification"), likewise the other grants used in this article.</p>
</div>
<div class="paragraph data-line-1309">
<p>In this lab, we start with a very simple case, but still very useful: the use of the Password flow which really is the Resource Owner Password Credentials grant type in OAuth terminology. It is easy because it is 2-legged, for simplicity we also use Basic Authorization to extract identity, the user will be authenticated against the User Registry. We use API Connect as the OAuth provider, notice that it is also possible to use API Connect with an external OAuth provider, we will see it later. This grant type is used when there is a high trust between the client and the application. Some people may find it less secure than using the Authorization grant, but it does not mean that it cannot be used when the conditions of trust are met. The client authenticates directly to the native OAuth provider specified in API Connect with its uid/pwd along the application credentials (client-id/client-secret) and gets an Access Token. Then the application accesses API Connect.</p>
</div>
<div class="admonitionblock note data-line-1311">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this lab, we do not explain how to propagate the user information with a JWT token, it will be done in another version of this lab. But this is an important question and there are different ways to get user information like having the back end performing a call back with the OAuth token to get information. We are not explaining the generation of an OIDC token. As of today, this is not a mandatory scenario required by OpenID and we are still in discussion to decide to implement it.
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-1313">
<h5 id="_create_the_oauth_provider">Create the OAuth Provider</h5>
<div class="paragraph data-line-1314">
<p>So let&#8217;s start! First let&#8217;s create the native OAuth provider. As discussed earlier, we use the Cloud Management console, but it was a design decision and we could use the API Manager console and manage OAuth resources, if we wanted.</p>
</div>
<div class="paragraph data-line-1316">
<p>Login to the Cloud Manager console and select Resources (or Manage Resources from home). Select OAuth Providers and click on Add and select Native OAuth Provider button.</p>
</div>
<div class="imageblock data-line-1318">
<div class="content">
<img src="../images/OAuth-native-create.png" alt="Native OAuth provider creation">
</div>
</div>
<div class="paragraph data-line-1320">
<p>Enter
&gt; Title: NativeProvider</p>
</div>
<div class="ulist data-line-1323">
<ul>
<li class="data-line-1323">
<p>Description: Internal OAuth Provider shared among organisations</p>
</li>
<li class="data-line-1324">
<p>Base path: /nativeprovider</p>
</li>
<li class="data-line-1325">
<p>Select DataPower API Gateway</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1327">
<p>Click Next button</p>
</div>
<div class="imageblock data-line-1329">
<div class="content">
<img src="../images/V10_oauth-native-baseinfo.png" alt="Native OAuth provider creation base information">
</div>
</div>
<div class="paragraph data-line-1331">
<p>Select the grant types you want to support, in our case we are going to use : Application, Access code and Resource owner - Password. We also select the Public client type, as well as Confidential by default selected. We keep the default values for the endpoints.</p>
</div>
<div class="imageblock data-line-1333">
<div class="content">
<img src="../images/V10_OAuth-native-grants.png" alt="Native OAuth provider creation base information">
</div>
</div>
<div class="paragraph data-line-1335">
<p>Click Next button</p>
</div>
<div class="paragraph data-line-1337">
<p>Specify the scopes you want to support, in our case we will use only one scope <strong>details</strong>. To provide detailed access.</p>
</div>
<div class="imageblock data-line-1339">
<div class="content">
<img src="../images/V10_OAuth-native-scopes.png" alt="Native OAuth provider creation scopes">
</div>
</div>
<div class="paragraph data-line-1341">
<p>Click Next button</p>
</div>
<div class="paragraph data-line-1343">
<p>The following settings are very important and there are many ways to configure OAuth, API Connect is very flexible and extensible on this part.
The processing has been described in the specific steps happening during the token(s) creation procedure. It is similar in the way the AAA framework in DataPower is clearly separating each step. I do not want to explain all the combinations below but provide the different values for each step.</p>
</div>
<table class="tableblock frame-all grid-all stretch data-line-1346">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Identity Extraction</th>
<th class="tableblock halign-left valign-top">Authentication</th>
<th class="tableblock halign-left valign-top">Authorization</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Basic Authentication</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User Registry (LDAP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authenticated</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default HTML Form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication URL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default HTML Form</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom HTML Form</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom HTML Form</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Context variable</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Disabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Redirect</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-1357">
<p>There are many possible combinations, but you can have even further possibilities to add more processing as we will see later, especially in how the consents are managed, metadata is added, scopes are managed, etc..
In our case, it is simple and we keep all default values, so nothing to do!</p>
</div>
<div class="imageblock data-line-1360">
<div class="content">
<img src="../images/V10_OAuth-native-auth.png" alt="Native OAuth provider creation processing">
</div>
</div>
<div class="paragraph data-line-1362">
<p>Click Next button</p>
</div>
<div class="paragraph data-line-1364">
<p>You get a Summary screen.</p>
</div>
<div class="imageblock data-line-1366">
<div class="content">
<img src="../images/V10_OAuth-native-summary.png" alt="Native OAuth provider creation summary">
</div>
</div>
<div class="paragraph data-line-1368">
<p>Click on Finish button.</p>
</div>
<div class="paragraph data-line-1370">
<p>We are going to add a few features to the OAuth Provider, such as OIDC and use of other endpoints such as introspection.
Edit the NativeProvider:
* In the Scopes panel, add openid as a scope for the support of OIDC.</p>
</div>
<div class="imageblock data-line-1374">
<div class="content">
<img src="../images/V10_native-edit-scopes.png" alt="Native OAuth provider scopes configuration">
</div>
</div>
<div class="ulist data-line-1376">
<ul>
<li class="data-line-1376">
<p>In the Tokens panel, click on the Refresh tokens checkbox and click Save button</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1378">
<div class="content">
<img src="../images/V10_native-edit-token.png" alt="Native OAuth provider tokens configuration">
</div>
</div>
<div class="ulist data-line-1380">
<ul>
<li class="data-line-1380">
<p>In the Token Management panel, click on the Token Management checkbox, Resource owner revocation path checkbox and Client revocation path checkbox and then click Save button. It will ask you if you want to update the Assembly, keep yes and click on the Confirm button.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1382">
<div class="content">
<img src="../images/V10_native-edit-token-mgmt.png" alt="Native OAuth provider token management configuration">
</div>
</div>
<div class="ulist data-line-1384">
<ul>
<li class="data-line-1384">
<p>In the Introspection panel, click on the Introspection checkbox and then click on the Save button</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1386">
<div class="content">
<img src="../images/V10_native-edit-introspection.png" alt="Native OAuth provider introspection configuration">
</div>
</div>
<div class="ulist data-line-1388">
<ul>
<li class="data-line-1388">
<p>Look at the Metadata Panel, you will see other settings to collect metadata.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1390">
<div class="content">
<img src="../images/V10_native-edit-metadata.png" alt="Native OAuth provider metadata configuration">
</div>
</div>
<div class="ulist data-line-1392">
<ul>
<li class="data-line-1392">
<p>In the OpenID Connect panel, click on the Enable OIDC checkbox and keep the other values, then click on the Save button.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1394">
<div class="content">
<img src="../images/V10_native-edit-oidc.png" alt="Native OAuth provider OIDC configuration">
</div>
</div>
<div class="ulist data-line-1396">
<ul>
<li class="data-line-1396">
<p>Look at the API Editor Panel, this is where the code is implemented based on the settings used to configure the OAuth provider. This allows to extend even more how you want to manage your token, given the possibility to use your own code (Gateway script or XSLT). Click on Back and Save button.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1398">
<div class="content">
<img src="../images/V10_native-edit-assembly.png" alt="Native OAuth provider Assembly Panel">
</div>
</div>
<div class="paragraph data-line-1400">
<p>We have an OAuth provider definition.</p>
</div>
</div>
<div class="sect4 data-line-1402">
<h5 id="_make_the_oauth_provider_usable_in_the_catalogs">Make the OAuth provider usable in the catalogs</h5>
<div class="paragraph data-line-1404">
<p>We need to make this OAuth Provider accessible in the various catalogs where we want to use it.
We leave the Cloud Manager console and go to the Manager Console.
Click on Manage and select Sandbox, then Settings and OAuth Providers. Click on Edit button on the top left.</p>
</div>
<div class="imageblock data-line-1408">
<div class="content">
<img src="../images/V10_oauth-native-manager-associate.png" alt="OAuth provider association to Catalog Edit">
</div>
</div>
<div class="paragraph data-line-1410">
<p>Click on the checkbox close to the NativeProvider</p>
</div>
<div class="imageblock data-line-1412">
<div class="content">
<img src="../images/V10_oauth-native-manager-associate-edit.png" alt="OAuth provider association to Catalog">
</div>
</div>
<div class="paragraph data-line-1414">
<p>Repeat the same operation with the Integration Catalog.
It is not yet accessible because we are not using it in any API.</p>
</div>
</div>
<div class="sect4 data-line-1417">
<h5 id="_protect_the_api_with_oauth">Protect the API with OAuth</h5>
<div class="paragraph data-line-1418">
<p>Now let&#8217;s protect the FakeMagento, we create a version 3.0.0 API from the version 1.0.0.
Click on Develop and select the FakeMagento-3.0.0 API. We have changed the base path to /fakemagento/v3.</p>
</div>
<div class="paragraph data-line-1421">
<p>Create a security scheme for OAuth</p>
</div>
<div class="paragraph data-line-1423">
<p>enter:
&gt; Name: Native ROPW</p>
</div>
<div class="ulist data-line-1426">
<ul>
<li class="data-line-1426">
<p>Description: Using the native OAuth provider for Resource Owner Password grant</p>
</li>
<li class="data-line-1427">
<p>Select OAuth2</p>
</li>
<li class="data-line-1428">
<p>Select NativeProvider for the OAuth Provider</p>
</li>
<li class="data-line-1429">
<p>Select Resource Owner for the Flow</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1431">
<p>Click Save button.</p>
</div>
<div class="imageblock data-line-1433">
<div class="content">
<img src="../images/V10_native-ropc-security-scheme.png" alt="OAuth Resource Owner Password Credentials API security Requirement">
</div>
</div>
<div class="paragraph data-line-1435">
<p>Add the Security requirement</p>
</div>
<div class="imageblock data-line-1437">
<div class="content">
<img src="../images/V10_native-ropc-security-requirement.png" alt="OAuth Resource Owner Password Credentials API security Definition">
</div>
</div>
</div>
<div class="sect4 data-line-1439">
<h5 id="_tests_3">Tests</h5>
<div class="paragraph data-line-1440">
<p>Not explained in detail here, but we publish the product (or use versioning with the publish capability), we are using the Integration environment. Then we subscribe to the Product with the Gold Plan and approve the subscription. The API is published and ready to use.</p>
</div>
<div class="paragraph data-line-1442">
<p>I&#8217;m going to test it in different ways: using developer portal, curl and Postman.</p>
</div>
<div class="sect5 data-line-1444">
<h6 id="_using_the_developer_portal">Using the Developer portal</h6>
<div class="paragraph data-line-1445">
<p>We do not explain all the steps because it has been done in previous chapters. We sign into the developer Portal, then select the FakeMagento V3.0.0 API and click on Try it. In the first step, we get the token. We select the MyMobileApp application, then enter the client_secret, enter the username and password and click on the Get Token button. It returns the Access Token.</p>
</div>
<div class="paragraph data-line-1447">
<p>In the second step, we click on Generate link to automatically populate the parameters needed to call the API. Then click on Send button. This invokes the FakeMagento API using the access Token as a Bearer.</p>
</div>
<div class="imageblock data-line-1449">
<div class="content">
<img src="../images/V10_test-ropc-22.png" alt="Test Get Access Token">
</div>
</div>
</div>
<div class="sect5 data-line-1451">
<h6 id="_using_curl">Using curl</h6>
<div class="paragraph data-line-1452">
<p>1) Get token</p>
</div>
<div class="paragraph data-line-1454">
<p>Request</p>
</div>
<div class="listingblock data-line-1455">
<div class="content">
<pre class="highlight"><code>curl -k -X POST -H "Content-Type: application/x-www-form-urlencoded" -H "accept: application/json" -d "grant_type=password&amp;username=foo&amp;password=foo&amp;client_id=d02c553d2f05277d91f6fb0189cc13c6&amp;client_secret=e5ef1f10fa79402946f1b30f7af623c0&amp;scope=details&amp;APIm-Debug=true" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/token |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1458">
<p>Response</p>
</div>
<div class="listingblock data-line-1459">
<div class="content">
<pre class="highlight"><code>{
  "token_type": "Bearer",
  "access_token": "AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz",
  "scope": "details",
  "expires_in": 3600,
  "consented_on": 1670448393,
  "refresh_token": "AALZ8UzdVDKQ_bhEcQ5jr8u1du2R_0MoQBuWEmZewlOzJLT-7H9V_Ue3H0aNAe5C8U0RLozeIHPQULqmWxUDg0ZGrdiFX2DGx9pVLJyzhyEfWQ",
  "refresh_token_expires_in": 2682000
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1471">
<p>2) Use token to access FakeMagento V2.0.0 API</p>
</div>
<div class="paragraph data-line-1473">
<p>Request</p>
</div>
<div class="listingblock data-line-1474">
<div class="content">
<pre class="highlight"><code>curl -v -k -X POST -H "X-IBM-Client-Id: d02c553d2f05277d91f6fb0189cc13c6" -H "Authorization: Bearer AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz" -H "Content-Type: application/json" -H "accept: application/json" -d  "{\"orderDetails\": \"2 plates\", \"orderDate\": \"2019-12-25T10:00:00.000Z\" }" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/fakemagento/v3/order |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1477">
<p>Response</p>
</div>
<div class="listingblock data-line-1478">
<div class="content">
<pre class="highlight"><code>{
  "norderId": "7275084087558144",
  "norderResult": true,
  "norderDetails": "2 plates",
  "norderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1487">
<p>3) Introspect token API</p>
</div>
<div class="paragraph data-line-1489">
<p>Request</p>
</div>
<div class="listingblock data-line-1490">
<div class="content">
<pre class="highlight"><code>curl -k -X POST -H "Content-Type: application/x-www-form-urlencoded" -H "accept: application/json" -H "x-ibm-client-id: d02c553d2f05277d91f6fb0189cc13c6" -H "x-ibm-client-secret: e5ef1f10fa79402946f1b30f7af623c0" -d "token_type_hint=access_token&amp;token=AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/introspect |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1493">
<p>Response</p>
</div>
<div class="listingblock data-line-1494">
<div class="content">
<pre class="highlight"><code>{
  "active": true,
  "scope": "details",
  "client_id": "d02c553d2f05277d91f6fb0189cc13c6",
  "username": "foo",
  "token_type": "Bearer",
  "grant_type": "password",
  "ttl": 3387,
  "exp": 1670451993,
  "expstr": "2022-12-07T22:26:33Z",
  "iat": 1670448393,
  "nbf": 1670448393,
  "nbfstr": "2022-12-07T21:26:33Z",
  "consented_on": 1670448393,
  "consented_on_str": "2022-12-07T21:26:33Z",
  "one_time_use": false
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1514">
<p>4) Revoke token API</p>
</div>
<div class="paragraph data-line-1516">
<p>Request</p>
</div>
<div class="listingblock data-line-1517">
<div class="content">
<pre class="highlight"><code>curl -k -X POST -H "Content-Type: application/x-www-form-urlencoded" -H "accept: application/json" -H "x-ibm-client-id: d02c553d2f05277d91f6fb0189cc13c6" -H "x-ibm-client-secret: e5ef1f10fa79402946f1b30f7af623c0" -d "token_type_hint=access_token&amp;token=AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/revoke |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1520">
<p>Response</p>
</div>
<div class="listingblock data-line-1521">
<div class="content">
<pre class="highlight"><code>{"status":"success"}</code></pre>
</div>
</div>
<div class="paragraph data-line-1525">
<p>5) Access API again with revoked token API</p>
</div>
<div class="paragraph data-line-1527">
<p>Request</p>
</div>
<div class="listingblock data-line-1528">
<div class="content">
<pre class="highlight"><code>curl -v -k -X POST -H "X-IBM-Client-Id: d02c553d2f05277d91f6fb0189cc13c6" -H "Authorization: Bearer AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz" -H "Content-Type: application/json" -H "accept: application/json" -d  "{\"orderDetails\": \"2 plates\", \"orderDate\": \"2019-12-25T10:00:00.000Z\" }" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/fakemagento/v3/order |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1531">
<p>Response</p>
</div>
<div class="listingblock data-line-1532">
<div class="content">
<pre class="highlight"><code>{
  "httpCode": "401",
  "httpMessage": "Unauthorized",
  "moreInformation": "Cannot pass the security checks that are required by the target API or operation, Enable debug headers for more details."

}</code></pre>
</div>
</div>
<div class="paragraph data-line-1541">
<p>6) Re-introspect the token API with revoked token</p>
</div>
<div class="paragraph data-line-1543">
<p>Request</p>
</div>
<div class="listingblock data-line-1544">
<div class="content">
<pre class="highlight"><code>curl -k -X POST -H "Content-Type: application/x-www-form-urlencoded" -H "accept: application/json" -H "x-ibm-client-id: d02c553d2f05277d91f6fb0189cc13c6" -H "x-ibm-client-secret: e5ef1f10fa79402946f1b30f7af623c0" -d "token_type_hint=access_token&amp;token=AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzbSW49ATSXFYDCq4HxAezoCfHMTLEL1PFdo3oXRhngC9cxrlJoX_4RvRpwQLWHMLn-khvn7w-SyaDLpGcOcpVdz" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/introspect |jq .</code></pre>
</div>
</div>
<div class="paragraph data-line-1547">
<p>Response</p>
</div>
<div class="listingblock data-line-1548">
<div class="content">
<pre class="highlight"><code>{"active": false}</code></pre>
</div>
</div>
</div>
<div class="sect5 data-line-1551">
<h6 id="_using_postman">Using POSTMAN</h6>
<div class="paragraph data-line-1552">
<p>1) Get token using the "1 -Resource Owner Password Token V2" request</p>
</div>
<div class="imageblock data-line-1554">
<div class="content">
<img src="../images/test-ropc-11.png" alt="Test Get Access Token">
</div>
</div>
<div class="paragraph data-line-1556">
<p>2) Use token to access FakeMagento V2.0.0 API using the "2 -FakeMagentaOrder NativeOAuth API" request</p>
</div>
<div class="imageblock data-line-1558">
<div class="content">
<img src="../images/test-ropc-12.png" alt="Test Access API">
</div>
</div>
<div class="paragraph data-line-1560">
<p>3) Introspect token API using the "Introspect Access Token" request</p>
</div>
<div class="imageblock data-line-1562">
<div class="content">
<img src="../images/test-ropc-13.png" alt="Test Introspect Access Token">
</div>
</div>
<div class="paragraph data-line-1564">
<p>4) Revoke token API using the "3 -Revoke" request</p>
</div>
<div class="imageblock data-line-1566">
<div class="content">
<img src="../images/test-ropc-14.png" alt="Test Revoke Access Token">
</div>
</div>
<div class="paragraph data-line-1568">
<p>5) Access the API again with the revoked token using the "2 -FakeMagentaOrder NativeOAuth API" request</p>
</div>
<div class="imageblock data-line-1570">
<div class="content">
<img src="../images/test-ropc-15.png" alt="Test Access API">
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-1572">
<h4 id="_authorization_code_grant_and_oidc">Authorization Code grant and OIDC</h4>
<div class="sect4 data-line-1574">
<h5 id="_protect_the_api_with_oauth_authorization">Protect the API with OAuth - Authorization</h5>
<div class="paragraph data-line-1575">
<p>After creating a version V4 (from V1). Let&#8217;s protect, the FakeMagento version 4.0.0 API. Click on Develop and select the FakeMagento-4.0.0 API.</p>
</div>
<div class="paragraph data-line-1577">
<p>Create a security scheme for OAuth
Enter:
&gt; Name: Native Authorization Grant</p>
</div>
<div class="ulist data-line-1581">
<ul>
<li class="data-line-1581">
<p>Select OAuth2</p>
</li>
<li class="data-line-1582">
<p>Select nativeprovider for the OAuth Provider</p>
</li>
<li class="data-line-1583">
<p>Select Access code for the Flow</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1585">
<div class="content">
<img src="../images/V10_access-secure-API-sec-def.png" alt="OAuth Access Code API protection Security Definition">
</div>
</div>
<div class="paragraph data-line-1587">
<p>Click on Create button.</p>
</div>
<div class="paragraph data-line-1589">
<p>Add the Security requirement</p>
</div>
<div class="imageblock data-line-1591">
<div class="content">
<img src="../images/V10_access-secure-API-sec.png" alt="OAuth Access Code API protection Security">
</div>
</div>
<div class="paragraph data-line-1593">
<p>Click on Create button.</p>
</div>
</div>
<div class="sect4 data-line-1595">
<h5 id="_tests_4">Tests</h5>
<div class="paragraph data-line-1596">
<p>Not explained in detail here, but we publish the product (or use versioning with the publish capability), we are using the Integration environment. Then we subscribe to the Product with the Gold Plan and approve the subscription. The API is published and ready to use.</p>
</div>
<div class="paragraph data-line-1598">
<p>First we provide an OAuth redirect URL for the Application, I&#8217;m going to use the postman sample URL: <a href="https://oauth.pstmn.io/v1/browser-callback" class="undefined" data-href="https://oauth.pstmn.io/v1/browser-callback">https://oauth.pstmn.io/v1/browser-callback</a>. It is not optional when using the Authorization grant.</p>
</div>
<div class="paragraph data-line-1600">
<p>I edit the application and specify the URL</p>
</div>
<div class="imageblock data-line-1602">
<div class="content">
<img src="../images/V10_specify_redirect_url.png" alt="OAuth Access Code API protection application Redirect URL">
</div>
</div>
<div class="paragraph data-line-1604">
<p>Click Save button.</p>
</div>
</div>
<div class="sect4 data-line-1606">
<h5 id="_using_the_developer_portal_2">Using the Developer portal</h5>
<div class="paragraph data-line-1607">
<p>You enter the following:</p>
</div>
<div class="ulist data-line-1609">
<ul>
<li class="data-line-1609">
<p>The client secret</p>
</li>
<li class="data-line-1610">
<p>Select the <strong>details</strong> scope</p>
</li>
<li class="data-line-1611">
<p>Specify the redirect URL to <a href="https://oauth.pstmn.io/v1/browser-callback" class="undefined" data-href="https://oauth.pstmn.io/v1/browser-callback">https://oauth.pstmn.io/v1/browser-callback</a></p>
</li>
</ul>
</div>
<div class="paragraph data-line-1613">
<p>Then click the Authorize button</p>
</div>
<div class="imageblock data-line-1615">
<div class="content">
<img src="../images/V10_oauth_authorization_get_access_code.png" alt="Authorization Grant Get Access Token">
</div>
</div>
<div class="paragraph data-line-1617">
<p>It opens a new pages, where you can get the access code</p>
</div>
<div class="imageblock data-line-1619">
<div class="content">
<img src="../images/V10_oauth_authorization_copy_access_code.png" alt="Authorization Grant Copy Access Token">
</div>
</div>
<div class="paragraph data-line-1621">
<p>Past the access code, and click on the <strong>Get Token</strong> button</p>
</div>
<div class="imageblock data-line-1623">
<div class="content">
<img src="../images/V10_oauth_authorization_convert_access_code.png" alt="Authorization Grant Convert Access Token">
</div>
</div>
<div class="paragraph data-line-1625">
<p>Now click on generate link and click on <strong>Send</strong> button.</p>
</div>
<div class="imageblock data-line-1627">
<div class="content">
<img src="../images/V10_oauth_authorization_invoke_api.png" alt="Authorization Grant invoke API">
</div>
</div>
<div class="sect5 data-line-1629">
<h6 id="_using_curl_2">Using curl</h6>
<div class="literalblock data-line-1630">
<div class="content">
<pre>1) Get the Access Code
Use a browser and enter
https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/integration/mainprovideroa/oauth2/authorize?response_type=code&amp;redirect_uri=https://www.getpostman.com/oauth2/callback&amp;client_id=3beaa6887601bb3a6c5f802e67372535&amp;scope=details%20openid</pre>
</div>
</div>
<div class="ulist data-line-1634">
<ul>
<li class="data-line-1634">
<p>You get the login pages.</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1636">
<div class="content">
<img src="../images/test-access-31.png" alt="Postman Test Access Token - Get Access Code">
</div>
</div>
<div class="paragraph data-line-1638">
<p>2) Enter the user credentials and click on Login button.
In the Browser URL, you get the Access Code</p>
</div>
<div class="listingblock data-line-1640">
<div class="content">
<pre class="highlight"><code>https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/authorize?response_type=code&amp;redirect_uri=https://oauth.pstmn.io/v1/browser-callback&amp;client_id=d02c553d2f05277d91f6fb0189cc13c6&amp;scope=details</code></pre>
</div>
</div>
<div class="paragraph data-line-1643">
<p>3) Send the Access Code to get the Access Token
Request</p>
</div>
<div class="listingblock data-line-1645">
<div class="content">
<pre class="highlight"><code>curl -k -H "Content-Type: application/x-www-form-urlencoded" -H "Accept: application/json" -d "grant_type=authorization_code&amp;client_id=d02c553d2f05277d91f6fb0189cc13c6&amp;client_secret=e5ef1f10fa79402946f1b30f7af623c0&amp;code=AAK7-QqL0wqWK1MP-CPFEvpYqnobktBSgY-VmreRYbrrSk417CiQ9YqHhN4yEqp7xb17NvpeqpbyDpKDIcDIEkYr&amp;redirect_uri=https%3A%2F%2Foauth.pstmn.io%2Fv1%2Fbrowser-callback&amp;scope=details" https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0000.par01.containers.appdomain.cloud/org1/sandbox/nativeprovider/oauth2/token</code></pre>
</div>
</div>
<div class="paragraph data-line-1648">
<p>Response</p>
</div>
<div class="listingblock data-line-1649">
<div class="content">
<pre class="highlight"><code>{
  "token_type": "Bearer",
  "access_token": "AAIgZDAyYzU1M2QyZjA1Mjc3ZDkxZjZmYjAxODljYzEzYzYla3T-GAkVVQyIw1MQGhOrwl_GwMX2yq6990JmAp3k0I9n_tJnPmiFkjEAlyWeIsvq3-1WIh64hKv53fpbMmpq",
  "scope": "details",
  "expires_in": 3600,
  "consented_on": 1670875409,
  "refresh_token": "AAJruSSuQnT9oNoNUcVjzm_gLRKIccrqMlkhDfxD1s3W3V6mWpQxMdX3Y0RDO3vesSYTuqhKM97sve7jN_AcpceZsRHF8FreTGQraFqHz3YHlw",
  "refresh_token_expires_in": 2682000
}</code></pre>
</div>
</div>
</div>
<div class="sect5 data-line-1661">
<h6 id="_using_postman_2">Using POSTMAN</h6>
<div class="paragraph data-line-1662">
<p>We are using one nice feature of Postman to directly get the access token. It hides a little bit the use of the Access Code. I have provided the request in Postman to exchange the Access Code for the Access Token.
Using the "1 -Access Token Authorization V3" request
Click on the Authorization link, then click on Get New Access Token</p>
</div>
<div class="imageblock data-line-1666">
<div class="content">
<img src="../images/test-access-11.png" alt="Postman Test Access Token">
</div>
</div>
<div class="paragraph data-line-1668">
<p>Then click on Request Token button</p>
</div>
<div class="imageblock data-line-1670">
<div class="content">
<img src="../images/test-access-12.png" alt="Postman Test Access Token">
</div>
</div>
<div class="paragraph data-line-1672">
<p>Enter the credentials for the user. Click Login button. Notice that this page is generated by API Connect, this is the default page for authentication.</p>
</div>
<div class="imageblock data-line-1674">
<div class="content">
<img src="../images/test-access-13.png" alt="Postman Test Access Token">
</div>
</div>
<div class="paragraph data-line-1676">
<p>You get the Access Token and the idtoken. Copy the Access Token.</p>
</div>
<div class="imageblock data-line-1678">
<div class="content">
<img src="../images/test-access-14.png" alt="Postman Test Access Token">
</div>
</div>
<div class="paragraph data-line-1680">
<p>Use the Access Token to access the FakeMagento V3 API.</p>
</div>
<div class="imageblock data-line-1682">
<div class="content">
<img src="../images/test-access-15.png" alt="Postman Test Access Token">
</div>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-1684">
<h4 id="_oauth_client_credentials_grant">OAuth Client Credentials grant</h4>
<div class="sect4 data-line-1686">
<h5 id="_protect_the_api_with_oauth_application">Protect the API with OAuth - Application</h5>
<div class="paragraph data-line-1687">
<p>Let&#8217;s protect, the FakeMagento version 4.0.0 API. Click on Develop and select the FakeMagento-4.0.0 API.
Click on Security Definitions and click on Add button.
Enter:
&gt; Name: Native Application</p>
</div>
<div class="ulist data-line-1692">
<ul>
<li class="data-line-1692">
<p>Description: Using the native OAuth provider for Application grant</p>
</li>
<li class="data-line-1693">
<p>Select OAuth2</p>
</li>
<li class="data-line-1694">
<p>Select NativeProvider for the OAuth Provider</p>
</li>
<li class="data-line-1695">
<p>Select Application for the Flow</p>
</li>
<li class="data-line-1696">
<p>Select details for the scopes</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1698">
<p>Click Save button
image::../images/application-secure-API-sec-def.png[OAuth Application API Security Definition]</p>
</div>
<div class="paragraph data-line-1701">
<p>In the Security selection, select Native Application oauth2 and the details scope.</p>
</div>
<div class="paragraph data-line-1703">
<p>Click Save button.</p>
</div>
<div class="imageblock data-line-1705">
<div class="content">
<img src="../images/application-secure-API-sec.png" alt="OAuth Application API Security">
</div>
</div>
</div>
<div class="sect4 data-line-1707">
<h5 id="_tests_5">Tests</h5>
<div class="paragraph data-line-1708">
<p>Not explained in detail here, but we publish the product (or use versioning with the publish capability), we are using the Integration environment. Then we subscribe to the Product with the Gold Plan and approve the subscription. The API is published and ready to use.</p>
</div>
<div class="sect5 data-line-1710">
<h6 id="_using_postman_3">Using POSTMAN</h6>
<div class="paragraph data-line-1711">
<p>1) Get token using the "1 -Client Credentials V4" request</p>
</div>
<div class="imageblock data-line-1713">
<div class="content">
<img src="../images/test-application-11.png" alt="Test Get Access Token">
</div>
</div>
<div class="paragraph data-line-1715">
<p>2) Use token to access FakeMagento V4.0.0 API using the "2 -FakeMagentaOrder Native OAuth API" request</p>
</div>
<div class="imageblock data-line-1717">
<div class="content">
<img src="../images/test-application-12.png" alt="Test Access API">
</div>
</div>
</div>
<div class="sect5 data-line-1720">
<h6 id="_using_curl_3">Using curl</h6>
<div class="paragraph data-line-1722">
<p>Request</p>
</div>
<div class="listingblock data-line-1723">
<div class="content">
<pre class="highlight"><code>POST /org1/integration/nativeprovider/oauth2/token HTTP/1.1
Content-Type: application/x-www-form-urlencoded
accept: application/json
grant_type=client_credentials&amp;client_id=3beaa6887601bb3a6c5f802e67372535&amp;client_secret=556a75ce26097f96ea281ed47c1cf2e7&amp;scope=details&amp;APIm-Debug=true</code></pre>
</div>
</div>
<div class="paragraph data-line-1729">
<p>Response</p>
</div>
<div class="listingblock data-line-1730">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
X-RateLimit-Limit: name=default,100;
X-RateLimit-Remaining: name=default,76;
X-Client-IP: 10.126.64.177
X-Global-Transaction-ID: 6fc036bd5e87726800066a61
Content-Type: application/json
{
	"token_type": "Bearer",
	"access_token": "AAIgNDIxMjIzZTc3M2YyMzdjNTIzMTg0MjEwMjY2MDg5NmV0AD6QpfILhTsnddGNJQ5MQIHdQI9eESHYs0QyOFDUc4x3A55wFGH2jfbiVLlhDhlddI5tUIe9x-pGgFgHMZZ8IGYVL2wYiB_aOsElY1h8yNRymzvCzDWTFRU4UiaPGH4",
	"scope": "details",
	"expires_in": 3600,
	"consented_on": 1585934952
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1746">
<p>Request</p>
</div>
<div class="listingblock data-line-1747">
<div class="content">
<pre class="highlight"><code>POST /org1/integration/fakemagento/v2/order HTTP/1.1
X-IBM-Client-Id: 3beaa6887601bb3a6c5f802e67372535
Content-Type: application/json
Accept: application/json
Authorization: Bearer AAIgNDIxMjIzZTc3M2YyMzdjNTIzMTg0MjEwMjY2MDg5NmV0AD6QpfILhTsnddGNJQ5MQIHdQI9eESHYs0QyOFDUc4x3A55wFGH2jfbiVLlhDhlddI5tUIe9x-pGgFgHMZZ8IGYVL2wYiB_aOsElY1h8yNRymzvCzDWTFRU4UiaPGH4
{
  "orderDetails": "2 plates",
  "orderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1758">
<p>Response</p>
</div>
<div class="listingblock data-line-1759">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
X-RateLimit-Limit: name=ten,10;
X-RateLimit-Remaining: name=ten,9;
Accept: application/json
X-Client-IP: 10.126.64.177
X-Global-Transaction-ID: 6fc036bd5e877298000817c9
Content-Type: application/json
{
	"norderId": "7275084087558144",
	"norderResult": true,
	"norderDetails": "2 plates",
	"norderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4 data-line-1775">
<h5 id="_using_the_developer_portal_3">Using the Developer portal</h5>
<div class="paragraph data-line-1776">
<p>We do not explain all the steps because it has been done in previous chapters.
We sign in to the developer Portal, then select the FakeMagento V4.0.0 API and click on Try it.
In the first step, we get the token.
We select the MyMobileApp application, then enter the client_secret, enter the username and password and click on the Get Token button.
It returns the Access Token.</p>
</div>
<div class="imageblock data-line-1782">
<div class="content">
<img src="../images/test-application-21.png" alt="Test Get Access Token">
</div>
</div>
<div class="paragraph data-line-1784">
<p>In the second step, we click on Generate link to automatically populate the parameters needed to call the API. Then click on Send button.
This invokes the FakeMagento API using the access Token as a Bearer.</p>
</div>
<div class="imageblock data-line-1787">
<div class="content">
<img src="../images/test-application-22.png" alt="Test Get Access Token">
</div>
</div>
<div class="paragraph data-line-1790">
<p>toto</p>
</div>
</div>
</div>
<div class="sect3 data-line-1792">
<h4 id="_oauth_implicit_grant">OAuth Implicit grant</h4>
<div class="sect4 data-line-1794">
<h5 id="_protect_the_api_with_oauth_implicit">Protect the API with OAuth - Implicit</h5>
<div class="paragraph data-line-1795">
<p>Let&#8217;s protect, the FakeMagento version 6.0.0 API. Click on Develop and select the FakeMagento-6.0.0 API.</p>
</div>
<div class="paragraph data-line-1797">
<p>Click on Security Schemes and click on Add button.
Enter:</p>
</div>
<div class="ulist data-line-1800">
<ul>
<li class="data-line-1800">
<p>Name: Native Implicit</p>
</li>
<li class="data-line-1802">
<p>Description: Using the native OAuth provider for Implicit  grant</p>
</li>
<li class="data-line-1803">
<p>Select OAuth2</p>
</li>
<li class="data-line-1804">
<p>Select nativeprovider</p>
</li>
<li class="data-line-1805">
<p>Select Implicit for the Flow
Click Create button</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1808">
<div class="content">
<img src="../images/V10_oauth_implicit_sec_def.png" alt="OAuth API Implicit Security Definition">
</div>
</div>
<div class="paragraph data-line-1810">
<p>Check that the details scope is selected</p>
</div>
<div class="imageblock data-line-1812">
<div class="content">
<img src="../images/V10_oauth_implicit_sec_scope_def.png" alt="OAuth API Implicit Security Definition">
</div>
</div>
<div class="paragraph data-line-1814">
<p>Click Save button.</p>
</div>
<div class="paragraph data-line-1816">
<p>In the Security definition, click on the Add sign and select the two security schemes clientID and NAtive Implicit and the details scope.</p>
</div>
<div class="imageblock data-line-1818">
<div class="content">
<img src="../images/V10_oauth_implicit_sec_req.png" alt="OAuth Application API Security">
</div>
</div>
<div class="paragraph data-line-1820">
<p>Click Create button.</p>
</div>
<div class="paragraph data-line-1822">
<p>Click Save button.</p>
</div>
</div>
<div class="sect4 data-line-1824">
<h5 id="_tests_6">Tests</h5>
<div class="paragraph data-line-1825">
<p>Not explained in detail here, but we publish the product (or use versioning with the publish capability), we are using the Integration environment. Then we subscribe to the Product with the Gold Plan and approve the subscription. The API is published and ready to use.</p>
</div>
</div>
<div class="sect4 data-line-1827">
<h5 id="_using_the_explorer">Using the Explorer</h5>
<div class="paragraph data-line-1828">
<p>Select the Explorer tab, select the POST /order operation.
Click on Try it.</p>
</div>
<div class="paragraph data-line-1831">
<p>Select the details scope
For the Redirect URI, enter: <a href="https://oauth.pstmn.io/v1/browser-callback" class="undefined" data-href="https://oauth.pstmn.io/v1/browser-callback">https://oauth.pstmn.io/v1/browser-callback</a> which is the OAuth redirect URL associated to the application. Click on the Get Token button.</p>
</div>
<div class="imageblock data-line-1834">
<div class="content">
<img src="../images/V10_oauth_implicit_test_get_token.png" alt="Test Get Token">
</div>
</div>
<div class="paragraph data-line-1836">
<p>Enter the credentials of the user, in my case foo/foo.
Click The Sign in button.</p>
</div>
<div class="imageblock data-line-1840">
<div class="content">
<img src="../images/V10_oauth_implicit_test_enter_creds.png" alt="Test Get Token">
</div>
</div>
<div class="paragraph data-line-1842">
<p>You obtain a web page with a successfull authentication, you can retrieve the access token in the URI, copy it.</p>
</div>
<div class="imageblock data-line-1844">
<div class="content">
<img src="../images/V10_oauth_implicit_test_get_at_creds.png" alt="Test Get Token">
</div>
</div>
<div class="paragraph data-line-1846">
<p>We are ready to invoke the API with the Access Token</p>
</div>
<div class="paragraph data-line-1848">
<p>Paste the Access Token, and click on generate link. And click Send.</p>
</div>
<div class="imageblock data-line-1850">
<div class="content">
<img src="../images/V10_oauth_implicit_test_invoke_api.png" alt="Test Invoke API">
</div>
</div>
<div class="sect5 data-line-1852">
<h6 id="_using_postman_4">Using POSTMAN</h6>
<div class="paragraph data-line-1853">
<p>1) Get token using the "1 -Client Credentials V4" request</p>
</div>
<div class="imageblock data-line-1855">
<div class="content">
<img src="../images/test-application-11.png" alt="Test Get Access Token">
</div>
</div>
<div class="paragraph data-line-1857">
<p>2) Use token to access FakeMagento V4.0.0 API using the "2 -FakeMagentaOrder Native OAuth API" request</p>
</div>
<div class="imageblock data-line-1859">
<div class="content">
<img src="../images/test-application-12.png" alt="Test Access API">
</div>
</div>
</div>
<div class="sect5 data-line-1861">
<h6 id="_using_curl_4">Using curl</h6>
<div class="paragraph data-line-1863">
<p>Request</p>
</div>
<div class="listingblock data-line-1864">
<div class="content">
<pre class="highlight"><code>POST /org1/integration/nativeprovider/oauth2/token HTTP/1.1
Content-Type: application/x-www-form-urlencoded
accept: application/json
grant_type=client_credentials&amp;client_id=3beaa6887601bb3a6c5f802e67372535&amp;client_secret=556a75ce26097f96ea281ed47c1cf2e7&amp;scope=details&amp;APIm-Debug=true</code></pre>
</div>
</div>
<div class="paragraph data-line-1870">
<p>Response</p>
</div>
<div class="listingblock data-line-1871">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
X-RateLimit-Limit: name=default,100;
X-RateLimit-Remaining: name=default,76;
X-Client-IP: 10.126.64.177
X-Global-Transaction-ID: 6fc036bd5e87726800066a61
Content-Type: application/json
{
	"token_type": "Bearer",
	"access_token": "AAIgNDIxMjIzZTc3M2YyMzdjNTIzMTg0MjEwMjY2MDg5NmV0AD6QpfILhTsnddGNJQ5MQIHdQI9eESHYs0QyOFDUc4x3A55wFGH2jfbiVLlhDhlddI5tUIe9x-pGgFgHMZZ8IGYVL2wYiB_aOsElY1h8yNRymzvCzDWTFRU4UiaPGH4",
	"scope": "details",
	"expires_in": 3600,
	"consented_on": 1585934952
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1887">
<p>Request</p>
</div>
<div class="listingblock data-line-1888">
<div class="content">
<pre class="highlight"><code>POST /org1/integration/fakemagento/v2/order HTTP/1.1
X-IBM-Client-Id: 3beaa6887601bb3a6c5f802e67372535
Content-Type: application/json
Accept: application/json
Authorization: Bearer AAIgNDIxMjIzZTc3M2YyMzdjNTIzMTg0MjEwMjY2MDg5NmV0AD6QpfILhTsnddGNJQ5MQIHdQI9eESHYs0QyOFDUc4x3A55wFGH2jfbiVLlhDhlddI5tUIe9x-pGgFgHMZZ8IGYVL2wYiB_aOsElY1h8yNRymzvCzDWTFRU4UiaPGH4
{
  "orderDetails": "2 plates",
  "orderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1899">
<p>Response</p>
</div>
<div class="listingblock data-line-1900">
<div class="content">
<pre class="highlight"><code>HTTP/1.1 200 OK
X-RateLimit-Limit: name=ten,10;
X-RateLimit-Remaining: name=ten,9;
Accept: application/json
X-Client-IP: 10.126.64.177
X-Global-Transaction-ID: 6fc036bd5e877298000817c9
Content-Type: application/json
{
	"norderId": "7275084087558144",
	"norderResult": true,
	"norderDetails": "2 plates",
	"norderDate": "2019-12-25T10:00:00.000Z"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1916">
<p>toto</p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-1918">
<h4 id="_external_oauth_provider">External OAuth Provider</h4>
<div class="paragraph data-line-1919">
<p>In this scenario, we have an external OAuth Provider available, we use the IBM app-id application available in IBM Cloud as an OAuth/OIDC provider ([App-ID documentation](<a href="https://cloud.ibm.com/docs/appid)" class="undefined" data-href="https://cloud.ibm.com/docs/appid)">https://cloud.ibm.com/docs/appid)</a>). The integration with API Connect implies a synchronisation of the API keys (client id/client secret) with the applications defined in the OAuth Provider. It can be done in two ways, either the API keys are created in API Connect and then added to the OAuth Provider, either the API Keys are created in the OAuth Provider and they are added to the application in API Connect using apic CLI. In this scenario, we will use the second option which will give us an opportunity to look at the API Connect CLI.
At runtime, the application first gets the token from the OAuth provider directly, not going through API Connect (this is a more secured approach since the credentials do not flow through API Connect), then the application invokes the API with the Access Token in the Authorization header as a Bearer. API Connect then invokes the OAuth Provider with an Introspect call with the token, if the call returns a 200 (or active=true), then the Access Token is valid and API Connect can proceed.</p>
</div>
<div class="paragraph data-line-1922">
<p>It is important to understand the various identities that do exist in the context and see that it is not obvious to understand all the various identities and that they are related to the different grants that have been chosen.</p>
</div>
<div class="paragraph data-line-1924">
<p>In the following diagram, we can see that there are 3 identities: a user identity (that will be used for Resource Owner Password or Authorization grants), a system identity for the application requesting the access token (for all grants) and finally a system identity representing APIC to access the OAuth provider.</p>
</div>
<div class="imageblock data-line-1926">
<div class="content">
<img src="../images/oauth-third-concepts.png" alt="Third party OAuth Provider flow">
</div>
</div>
<div class="paragraph data-line-1928">
<p>Let&#8217;s stop a few seconds on the configuration on app-id ([App-ID documentation](<a href="https://cloud.ibm.com/docs/appid)" class="undefined" data-href="https://cloud.ibm.com/docs/appid)">https://cloud.ibm.com/docs/appid)</a>). The diagram below shows the objects that I have created for this example. Of course, depending on your OAuth/OIDC provider it may defer (Ping Federate, Auth0, MSAD, &#8230;&#8203;).
As you can see, it important to distinguish the different identities. We have a user identity the person who will be authorized to access the API (Resource Owner Password and Authorization grants), and two system identities, the application that is using the API and also API Connect which is a client of the OAuth provider. The later is used to validate (introspect) a token for example.</p>
</div>
<div class="imageblock data-line-1931">
<div class="content">
<img src="../images/oauth-appid-concepts.png" alt="App-ID concept">
</div>
</div>
<div class="sect4 data-line-1933">
<h5 id="_validating_the_oauth_provider_configuration">Validating the OAuth provider configuration</h5>
<div class="paragraph data-line-1934">
<p>Before configuring and using API Connect, we are making sure the OAuth provider is correctly configured and all the various scenarios are working.</p>
</div>
<div class="paragraph data-line-1936">
<p>I indicate here the Windows style commands (it is easy to convert them into Linux style)</p>
</div>
<div class="literalblock data-line-1938">
<div class="content">
<pre> ====== Get a token (Resource Owner Password grant)
 ```
set app_client_id=&lt;client_id of the application accessing APIC&gt;
set app_client_secret=&lt;client_secret of the application accessing APIC&gt;
set user_id=&lt;uid of the user&gt;
set user_password=&lt;password of the user&gt;
curl -k -u "%app_client_id%:%app_client_secret%" -H "Host: eu-gb.appid.cloud.ibm.com" -H "Accept: application/json" -F "grant_type=password" -F "username=%user_id%" -F "password=%user_password%" -F "scope=credit_scoring details" "https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token" | jq .
 ```
 Response is:
 ```
 {
  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImFwcElkLTYyZDQ1NjZiLWY0MTEtNDYxNC04YWRjLTU4YzA5MDcwNzU4NS0yMDE5LTA1LTI5VDE2OjE2OjA2LjE2MyIsInZlciI6NH0.eyJpc3MiOiJodHRwczovL2V1LWdiLmFwcGlkLmNsb3VkLmlibS5jb20vb2F1dGgvdjQvNjJkNDU2NmItZjQxMS00NjE0LThhZGMtNThjMDkwNzA3NTg1IiwiZXhwIjoxNjY0MjIyNTEyLCJhdWQiOlsiYWYwM2Q3OTUtZTM2Yi00NTcxLTkwMTMtNmRjNWI1M2M4NTc4Il0sInN1YiI6IjkwMDBkN2JlLWNjNTUtNDljNS04NTRiLTA3NjdkZTc1Yzc5OCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJhbXIiOlsiY2xvdWRfZGlyZWN0b3J5Il0sImlhdCI6MTY2NDIxODkxMiwidGVuYW50IjoiNjJkNDU2NmItZjQxMS00NjE0LThhZGMtNThjMDkwNzA3NTg1Iiwic2NvcGUiOiJvcGVuaWQgYXBwaWRfZGVmYXVsdCBhcHBpZF9yZWFkdXNlcmF0dHIgYXBwaWRfcmVhZHByb2ZpbGUgYXBwaWRfd3JpdGV1c2VyYXR0ciBhcHBpZF9hdXRoZW50aWNhdGVkIGNyZWRpdF9zY29yaW5nIGRldGFpbHMifQ.UE8Oavui91iQwQBDjv0iwSlhiUTY1GwUCHh-nsDeBRo5vekQ-sN4jFXcbu82IT2bJHYFxAdVSWhj2ZTX5oNQ1n-yzVyw59y9AxSFVfdlt409ZAQ1sVIWlyP3TEDXIqo9lUKyOCvKe9TmLGuNjvSb2NvOSr7BKJN-gRYg78peNJG_Nxj7wfMZEfJyR_dQcA--DefvIyWZvfHBOebY_XzHWK8kby_hMdB2AFn44kDmNSfC3kz4uLaVINjm_Df0anIjaw9JJKvs4wv1uy_4iqlVbh_p-hv49UyBVMpal6U3_4nhISRWQ77YuvEr2QyTcTtlDt6d9ICumgH6sXp9cc2ilA",
  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImFwcElkLTYyZDQ1NjZiLWY0MTEtNDYxNC04YWRjLTU4YzA5MDcwNzU4NS0yMDE5LTA1LTI5VDE2OjE2OjA2LjE2MyIsInZlciI6NH0.eyJpc3MiOiJodHRwczovL2V1LWdiLmFwcGlkLmNsb3VkLmlibS5jb20vb2F1dGgvdjQvNjJkNDU2NmItZjQxMS00NjE0LThhZGMtNThjMDkwNzA3NTg1IiwiYXVkIjpbImFmMDNkNzk1LWUzNmItNDU3MS05MDEzLTZkYzViNTNjODU3OCJdLCJleHAiOjE2NjQyMjI1MTIsInRlbmFudCI6IjYyZDQ1NjZiLWY0MTEtNDYxNC04YWRjLTU4YzA5MDcwNzU4NSIsImlhdCI6MTY2NDIxODkxMiwiZW1haWwiOiJhcm5hdWxkX2Rlc3ByZXRzQGZyLmlibS5jb20iLCJuYW1lIjoiQXJuYXVsZCBEZXNwcmV0cyIsInN1YiI6IjkwMDBkN2JlLWNjNTUtNDljNS04NTRiLTA3NjdkZTc1Yzc5OCIsImVtYWlsX3ZlcmlmaWVkIjp0cnVlLCJnaXZlbl9uYW1lIjoiQW5hdWxkIiwiZmFtaWx5X25hbWUiOiJEZXNwcmV0cyIsImlkZW50aXRpZXMiOlt7InByb3ZpZGVyIjoiY2xvdWRfZGlyZWN0b3J5IiwiaWQiOiJkNWQ4YzY5ZS1mMzhhLTRkMjMtYjM5YS05ZmEzYzYwNjhlMzcifV0sImFtciI6WyJjbG91ZF9kaXJlY3RvcnkiXX0.GhN38JsqgjCevK-o8zGENWd_kDOAa4EYo1B2JAfJAY9fQyJhjdytR5TWv4sg7OX_JiX15IQt10EDcZXpncbtZQcdBwK55SavTeHYmWgQKn4frgHc24ZRD_kw3MvUwQihRDKZwXctrE01eq566btUDD0lBVuEme8yjPdu6JfXY5DyhVFCPP20BXZMfIxgKtD9prJbi7krd8CK_Hu2FwxpWvXi6zDZpGSwoKqY_6aQcfEr2wVIb6cYucn6KxBzF1Sk-S0sFrp_l9daBmY5web5_8onp7pmcXrn0Lw0PDicgmc9fqVKTGaLdgyXekHdtafHYDCrT4_qpBarXyLCVd4bIQ",
  "refresh_token": "6a3a3471470627f4cb78247cc6eae58291220ebcea97a6ab2991c5f8fa1daf506001fc4a383798c2af0d2f997fc570bea2b1a92f713e60796518bf8a2c4faef8e86c1182bb29e4d23847576c9afb629da4275025ff655481a8f2eb956a482fa8abdb5faaf2fcc4f87a708f430ed6813bf6a3eeab7fc9cd8572f082798c5ad3099fe197c4e0b0e81c287e0ea6c0cf8a9f59e96471e372298c8e0a4b6f6ab67c1e57d47c9e8345d85270cc3e1b9e485c9faf602531327efb34b488c250c2e6eb98da40eec0890d81a74ed0ac08700f4889df9f8e69dd559786e370d5f63642a8391dc6e29600d177e92eb598bc46aefd477a79eaa233e8df9814085d33c3f225048cb10a330ddd8dc0c84b108d807f33eb288ba9dc9d363510a22a6cf5d33d4d5c9267a36cc55a73e1f37f0a5c89c069b0dce2340c824a39190bb8a2970c45c4104d758c82a8966898cf939873a429715b3eeda9a92d51c806ba90a76e6488818c8b174bcbf8e7645a96893c52db2ce5014432a990d93d6bc9c8680eb2647428f3a80bd910ede179865598cc77a8fa3d8116cedf22d5225394a00aedb46d85c24ab55dd1e04755d068bbd2dba40f8f8ab46a3b8f88a533b06d5f6af3b579df2d9e6ed8a0a6c577b0772fa749e5d9ca2f4a1258b19a86c0fb80ac4457d0791c983f3681bc9d5ebc91cbf077b3b04df48f9a811125e7ab6f10d0c58886b3437d21c155b2b10135bae477394a28b6adaa373ced8754e9b5280c0f2db733e61dbca60c0cabcb44aa56114fb353484c440bb261d26046095627e0673dcae184cb419a6175d13767b7e7122e0a2c936414fe2cdd38549bcedff9db12e0853ac58beff195b05f26497b2267a6771fe0013625bab11e012effa0c788910638650c1469c7112211fb305ce7d18399598c7a93aec4aca11f46323e02267e66bb2ae03f3cfaca6f3315faa76214ff26713ca82e8953b3b09790d080b3a6bd1a19c8081454bf87720d47755a07c1a7fe6ca227eddbf87a",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": "openid appid_default appid_readuserattr appid_readprofile appid_writeuserattr appid_authenticated credit_scoring details"
}
 ```</pre>
</div>
</div>
<div class="literalblock data-line-1958">
<div class="content">
<pre>====== Introspect the access token
```
set btoken=&lt;access_token value got from the above command&gt;
set authorizationhapic=&lt;base64(client_id of the application representing APIC system identity:client_secret of the application representing APIC system identity)&gt;
curl -k -H "Authorization: Basic %authorizationhapic%" -F "token=%btoken%" "https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/introspect"</pre>
</div>
</div>
<div class="literalblock data-line-1964">
<div class="content">
<pre> ```
Response is</pre>
</div>
</div>
<div class="listingblock data-line-1966">
<div class="content">
<pre class="highlight"><code>{
	"active": true,
	"scope": "openid appid_default appid_readuserattr appid_readprofile appid_writeuserattr appid_authenticated credit_scoring details"
}</code></pre>
</div>
</div>
<div class="paragraph data-line-1973">
<p>We are all set, we can create a token, and we can introspect and get a <strong>valid:true</strong> response, we can now configure API Connect who is going to do the same introspect call.</p>
</div>
</div>
<div class="sect4 data-line-1975">
<h5 id="_create_the_oauth_provider_in_api_connect">Create the OAuth Provider in API Connect</h5>
<div class="paragraph data-line-1976">
<p>We have decided to create the OAuth Provider in the API Connect Cloud Manager using the Cloud Management Console, it could have been at an organisation level uisng the API Connect Manager.</p>
</div>
<div class="paragraph data-line-1978">
<p>As previously, click on Resources, then OAuth Providers. Click Add button selecting Third Party OAuth Provider on top left.
Enter:
&gt;Title: AppId</p>
</div>
<div class="ulist data-line-1982">
<ul>
<li class="data-line-1982">
<p>Keep Access code selected and select Application</p>
</li>
<li class="data-line-1983">
<p>Select DataPower API Gateway</p>
</li>
</ul>
</div>
<div class="imageblock data-line-1985">
<div class="content">
<img src="../images/oauth-third-configV10.png" alt="Third party OAuth Provider config">
</div>
</div>
<div class="paragraph data-line-1987">
<p>Click Next button
In the Endpoints panel, enter:
&gt;Authorization URL: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorize" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorize">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorize</a></p>
</div>
<div class="ulist data-line-1991">
<ul>
<li class="data-line-1991">
<p>Token URL: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token</a></p>
</li>
<li class="data-line-1992">
<p>Introspect URL: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/introspect" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/introspect">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/introspect</a></p>
</li>
<li class="data-line-1993">
<p>TLS profile (optional): Default TLS client profile:1.0.0</p>
</li>
<li class="data-line-1994">
<p>TLS profile (optional): Default TLS client profile:1.0.0</p>
</li>
<li class="data-line-1995">
<p>Security (optional): Basic Authentication</p>
</li>
<li class="data-line-1996">
<p>Basic authentication  request header name (optional): x-introspect-basic-authorization-header, you can use whatever, this header is used to overwrite the value of the two following fields from a client perspective. If you do not use this header then the two values defined below will be used.</p>
</li>
<li class="data-line-1997">
<p>Basic authentication username (optional): &lt;client_id of apic system identity&gt;</p>
</li>
<li class="data-line-1998">
<p>Basic authentication password (optional): &lt;client_secret of apic system identity&gt;</p>
</li>
<li class="data-line-1999">
<p>Select Active for Token validation
Click Next button</p>
</li>
</ul>
</div>
<div class="paragraph data-line-2002">
<p>The only used endpoint is the Introspect URL. The Authorization and Token URLs are used in the documentation only and published with the API.</p>
</div>
<div class="imageblock data-line-2004">
<div class="content">
<img src="../images/oauth-third-endpointsV10.png" alt="Third party OAuth Provider endpoints">
</div>
</div>
<div class="paragraph data-line-2006">
<p>For the scope enter:</p>
</div>
<div class="ulist data-line-2008">
<ul>
<li class="data-line-2008">
<p>details for elevated access</p>
</li>
<li class="data-line-2009">
<p>openid for OIDC support</p>
</li>
<li class="data-line-2010">
<p>and then click Save button</p>
</li>
</ul>
</div>
<div class="imageblock data-line-2012">
<div class="content">
<img src="../images/oauth-third-scopesV10.png" alt="Third party OAuth Provider config">
</div>
</div>
<div class="paragraph data-line-2014">
<p>We are done with the configuration of the OAuth provider. We can now leave the Cloud Manager console.</p>
</div>
</div>
<div class="sect4 data-line-2016">
<h5 id="_associate_the_oauth_provider_with_the_different_catalogs">Associate the OAuth Provider with the different catalogs</h5>
<div class="paragraph data-line-2017">
<p>We need to make this OAuth Provider accessible in the various catalogs where we want to use it.
In the Manager Console, click on Manage and select Sandbox, then Settings and OAuth Providers. Click on Edit button on the top left.</p>
</div>
<div class="imageblock data-line-2020">
<div class="content">
<img src="../images/oauth-native-manager-associateV10.png" alt="OAuth provider association to Catalog Edit">
</div>
</div>
<div class="paragraph data-line-2022">
<p>Click on the checkbox close to AppId.</p>
</div>
<div class="imageblock data-line-2024">
<div class="content">
<img src="../images/third-oauth-sandbox-associate-editV10.png" alt="OAuth provider association to Catalog">
</div>
</div>
<div class="paragraph data-line-2026">
<p>Repeat the same operation with the Integration Catalog.
It is not yet accessible because we are not using it in any API.</p>
</div>
</div>
<div class="sect4 data-line-2029">
<h5 id="_protect_the_api_with_oauth_third_party">Protect the API with OAuth - Third Party</h5>
<div class="paragraph data-line-2030">
<p>Let&#8217;s protect, the FakeMagento version 5.0.0 API. Click on Develop and select the FakeMagento-5.0.0 API.
Click on Security Definitions and click on Add button:
Enter:
&gt; Name: AppId Third Party Authorization</p>
</div>
<div class="ulist data-line-2035">
<ul>
<li class="data-line-2035">
<p>Description: Using App ID third party OAuth provider for Authorization grant</p>
</li>
<li class="data-line-2036">
<p>Select OAuth2</p>
</li>
<li class="data-line-2037">
<p>Select  AppId for the OAuth Provider</p>
</li>
<li class="data-line-2038">
<p>Select Access code for the Flow</p>
</li>
</ul>
</div>
<div class="imageblock data-line-2040">
<div class="content">
<img src="../images/third-party-access-secure-API-sec-defV10.png" alt="OAuth Access Code API protection Security Definition">
</div>
</div>
<div class="paragraph data-line-2042">
<p>Click Save button.</p>
</div>
<div class="paragraph data-line-2044">
<p>In the Security section, select AppId Third Party Authorization and the two scope details and openid, then click Save button.</p>
</div>
<div class="imageblock data-line-2046">
<div class="content">
<img src="../images/third-party-access-secure-API-sec.png" alt="OAuth Access Code API protection Security">
</div>
</div>
</div>
<div class="sect4 data-line-2048">
<h5 id="_synchronize_the_client_credentials_from_appid_into_api_connect_application_definition">Synchronize the client credentials from AppId into API Connect Application definition</h5>
<div class="paragraph data-line-2049">
<p>What we do here is get the API keys defined in App ID for the application and then use the CLI to add this set of credentials to the MyMobileApp application. The only way to do this is using the CLI or the REST API. As said previously, an alternative would have been to update the credentials from API Connect to AppId with the AppId API.</p>
</div>
<div class="ulist data-line-2051">
<ul>
<li class="data-line-2051">
<p>Log to the manager</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2052">
<div class="content">
<pre class="highlight"><code>apic.exe login -s &lt;manager-endpoint&gt; -u &lt;user&gt; -p &lt;password&gt; -r provider/default-idp-2</code></pre>
</div>
</div>
<div class="paragraph data-line-2056">
<p><strong>Note:</strong> From now on, I&#8217;m going to use a short cut/alias to simplify what I type. And notice that I&#8217;m using Windows so you may have to slightly modify those command if on Linux.</p>
</div>
<div class="listingblock data-line-2057">
<div class="content">
<pre class="highlight"><code>set  apic10=&lt;path-to-apic&gt; -s &lt;manager-endpoint&gt; -o &lt;organisation&gt;</code></pre>
</div>
</div>
<div class="paragraph data-line-2061">
<p>Typing <code>%apic10%</code> provides an extensive help.
To update the application credentials, we need to find the name of the consumer org in the integration catalog and the name of the application.</p>
</div>
<div class="ulist data-line-2064">
<ul>
<li class="data-line-2064">
<p>Get the name of the consumer organisation</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2065">
<div class="content">
<pre class="highlight"><code>%apic10% consumer-orgs:list -c integration
orgdev1    [state: enabled]   https://manager.159.8.70.38.xip.io/api/consumer-orgs/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda</code></pre>
</div>
</div>
<div class="ulist data-line-2070">
<ul>
<li class="data-line-2070">
<p>Get the name of the application</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2071">
<div class="content">
<pre class="highlight"><code>%apic10% apps:list -c integration --scope catalog
mymobileapp    [state: enabled]   https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a</code></pre>
</div>
</div>
<div class="ulist data-line-2076">
<ul>
<li class="data-line-2076">
<p>We need to specify the credentials information in a json file. Create a file called appidcredentialSet.json for example.</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2077">
<div class="content">
<pre class="highlight"><code>{
	"type": "credential",
	"api_version": "2.0.0",
	"name": "appid-credentials",
	"title": " AppId Credentials for MyMobileApp",
	"summary": " AppId Credentials for MyMobileApp",
	"client_id": "9ce0b78a-289c-4d2b-8968-165b5f9c726d",
	"client_secret": "NzNiMGJmYmUtMjNiYi00YmExLWIwY2UtZDg5MDAxZjFjZDI3"
}</code></pre>
</div>
</div>
<div class="ulist data-line-2088">
<ul>
<li class="data-line-2088">
<p>We can now update API connect:</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2089">
<div class="content">
<pre class="highlight"><code>%apic10% -c integration --consumer-org orgdev1 -a mymobileapp credentials:create C:\temp\appidcredentialSet.json</code></pre>
</div>
</div>
<div class="ulist data-line-2093">
<ul>
<li class="data-line-2093">
<p>Let&#8217;s check that the credentials have been correctly updated</p>
</li>
</ul>
</div>
<div class="listingblock data-line-2095">
<div class="content">
<pre class="highlight"><code>%apic10% -c integration --consumer-org orgdev1 -a mymobileapp credentials:list --format json

{
    "total_results": 2,
    "results": [
        {
            "type": "credential",
            "api_version": "2.0.0",
            "id": "43a84659-28e4-4bb9-8dbe-998cd478c6c0",
            "name": "appid-credentials",
            "title": " AppId Credentials for MyMobileApp",
            "summary": " AppId Credentials for MyMobileApp",
            "client_id": "9ce0b78a-289c-4d2b-8968-165b5f9c726d",
            "client_secret_hashed": "uSCwG4YW8Fg+PRf1U0UXYDkgQw5BLMDn4G5vOL+RERI=",
            "created_at": "2020-04-01T14:05:43.592Z",
            "updated_at": "2020-04-01T14:05:43.592Z",
            "org_url": "https://manager.159.8.70.38.xip.io/api/orgs/3f015cc4-9cb5-4d72-a202-008473d14a11",
            "catalog_url": "https://manager.159.8.70.38.xip.io/api/catalogs/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026",
            "consumer_org_url": "https://manager.159.8.70.38.xip.io/api/consumer-orgs/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda",
            "app_url": "https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a",
            "url": "https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a/credentials/43a84659-28e4-4bb9-8dbe-998cd478c6c0"
        },
        {
            "type": "credential",
            "api_version": "2.0.0",
            "id": "d8d6b731-5a46-41dc-a27f-a073c76c72dc",
            "name": "credential-for-mymobileapp",
            "title": "Credential for MyMobileApp",
            "summary": "Credential for MyMobileApp",
            "client_id": "3beaa6887601bb3a6c5f802e67372535",
            "client_secret_hashed": "91IcbIJ+mL/oC0EnPrroU7mzRGMrwROoja8KhT8s4RQ=",
            "created_at": "2020-03-05T13:28:03.994Z",
            "updated_at": "2020-03-05T13:28:03.994Z",
            "org_url": "https://manager.159.8.70.38.xip.io/api/orgs/3f015cc4-9cb5-4d72-a202-008473d14a11",
            "catalog_url": "https://manager.159.8.70.38.xip.io/api/catalogs/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026",
            "consumer_org_url": "https://manager.159.8.70.38.xip.io/api/consumer-orgs/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda",
            "app_url": "https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a",
            "url": "https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a/credentials/d8d6b731-5a46-41dc-a27f-a073c76c72dc"
        }
    ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-2140">
<p>Note: using the --debug on apic gives the equivalent curl requests. The it is possible to directly invoke object with REST API. You can get the URL of each object using the web-dev-tools in your browser. In the command below, you can get the Access Token, client_id and client_secret using the --debug option on the login call.</p>
</div>
<div class="paragraph data-line-2142">
<p>curl -k -H "accept: application/json" -H "Authorization: Bearer &lt;AT&gt;" -H "X-Ibm-Client-Id: &lt;client_id&gt;" -H "X-Ibm-Client-Secret: &lt;client_secret&gt;" "https://manager.159.8.70.38.xip.io/api/apps/3f015cc4-9cb5-4d72-a202-008473d14a11/35409cde-6895-44e6-a297-6f3b8736c026/b226cc4a-28bd-4f6b-8197-65e4e45c8dda/8ec77979-0877-443f-bc6d-17ba55f48b5a/credentials"</p>
</div>
<div class="imageblock data-line-2144">
<div class="content">
<img src="../images/web-dev-tools.png" alt="Postman Test Access Token">
</div>
</div>
<div class="paragraph data-line-2147">
<p>Below a curl invocation sample (The Access token has been generated using the Resource Owner Grant. The client-id is defined in App-id for the MobileApp Application (App-ID terminology) and also for the MyMobileApp application in API connect (API Connect terminology). The uid/pwd to get the Access Token is a User defined in the Cloud Directory Users (IdP).</p>
</div>
<div class="paragraph data-line-2150">
<p>Request</p>
</div>
<div class="listingblock data-line-2151">
<div class="content">
<pre class="highlight"><code>curl -v -k --request POST \
  --url https://rgw.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0001.par01.containers.appdomain.cloud/org1/sandbox/fakemagento/v5/order \
  --header 'Authorization: Bearer \&lt;Bearer token\&gt;' \
  --header 'X-IBM-Client-Id: \&lt;client-id\&gt;' \
  --header 'accept: application/json' \
  --header 'content-type: application/json' \
  --header 'APIm-Debug: true' \
  --data '{"orderDetails":"2 plates","orderDate":"2019-12-25T10:00:00.000Z"}'</code></pre>
</div>
</div>
<div class="paragraph data-line-2162">
<p>Response</p>
</div>
<div class="listingblock data-line-2163">
<div class="content">
<pre class="highlight"><code>{"norderId":"7275084087558144","norderResult":true,"norderDetails":"2 plates","norderDate":"2019-12-25T10:00:00.000Z"}</code></pre>
</div>
</div>
<div class="imageblock data-line-2167">
<div class="content">
<img src="../images/oauth-third-ropsw-test-curl.png" alt="curl Test Access Token">
</div>
</div>
</div>
<div class="sect4 data-line-2169">
<h5 id="_tests_7">Tests</h5>
<div class="paragraph data-line-2170">
<p>Not explained in detail here, but we publish the product (or use versioning with the publish capability), we are using the Integration environment. Then we subscribe to the Product with the Gold Plan and approve the subscription. The API is published and ready to use.</p>
</div>
<div class="sect5 data-line-2172">
<h6 id="_using_postman_5">Using POSTMAN</h6>
<div class="paragraph data-line-2173">
<p>As for the Authorization grant with the native OAuth Provider we use Postman to directly get the access token.</p>
</div>
<div class="paragraph data-line-2175">
<p>Using the "1 -Access Token Authorization V5" request.
Click on the Authorization link, then click on Get New Access Token</p>
</div>
</div>
<div class="sect5 data-line-2178">
<h6 id="_using_curl_5">Using curl</h6>

</div>
</div>
</div>
<div class="sect3 data-line-2180">
<h4 id="_custom_jwt_generate_and_validate">Custom JWT Generate and Validate</h4>
<div class="paragraph data-line-2181">
<p>Not done yet</p>
</div>
</div>
<div class="sect3 data-line-2183">
<h4 id="_using_an_oidc_registry_to_protect_the_platform">Using an OIDC Registry to protect the platform</h4>
<div class="sect4 data-line-2184">
<h5 id="_gather_the_various_information_needed">Gather the various information needed</h5>
<div class="paragraph data-line-2186">
<p>So far, we have looked mostly at API Security, now let&#8217;s see the protection of the platform (Cloud Manager, API Manager and Portal).
The most common and simple way to protect the platform is to use one or more LDAP servers. A very simple way is also to use the Local User Registry, but if it is ok to include users in it for the Cloud Manager, because we may say that the number of users should be small (the platform administrators), it is probably not suitable for large number of users in the provider organizations and for the Portal sites.
The concern here being the management side and the fact that the Local User Registry is not integrated with the enterprise IAM solution. With the adoption of OIDC, API Connect offers the possibility to also use an OIDC provider to protect the platform (Cloud Manager, API Manager and Portal). As seen previously, you can combine the various authentication mechanisms as well and have different ways of authenticating for two organizations and also various ways for portal sites.</p>
</div>
<div class="paragraph data-line-2190">
<p>In this first section, we are going to configure an OIDC provider to protect a portal site.</p>
</div>
<div class="paragraph data-line-2192">
<p>We need to find some information from the OIDC provider, in our case AppId. This information will be used to complete the definitions in API Connect.</p>
</div>
<div class="paragraph data-line-2194">
<p>The first thing is to get the various endpoints, there is a very easy way to get them. Go to the Service Credentials section in AppId. Copy the discoveryEndpoint URL.
For me, this is <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/tenant_id_value/.well-known/openid-configuration" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/tenant_id_value/.well-known/openid-configuration">https://eu-gb.appid.cloud.ibm.com/oauth/v4/tenant_id_value/.well-known/openid-configuration</a> (where tenant_id_value is my tenant id).</p>
</div>
<div class="imageblock data-line-2197">
<div class="content">
<img src="../images/appid-service-credentials.png" alt="AppId Credentials">
</div>
</div>
<div class="paragraph data-line-2199">
<p>Then in a browser, paste it, it gives you all endpoints.</p>
</div>
<div class="imageblock data-line-2201">
<div class="content">
<img src="../images/appid-service-discovery.png" alt="AppId Discovery">
</div>
</div>
<div class="paragraph data-line-2203">
<p>You also need to get a client_id and client_secret to access AppId from API Connect. In my case, I use the application called my_apic (any application from AppID can be used).</p>
</div>
<div class="imageblock data-line-2205">
<div class="content">
<img src="../images/appid-application.png" alt="AppId Discovery">
</div>
</div>
<div class="paragraph data-line-2207">
<p>We need to update one aspect of the configuration, the redirect URL. So far, we used a dummy value. This time we need to use a proper value. The value is &lt;consumer_endpoint&gt;/consumer-api/oauth2/redirect, in my case: <a href="https://consumer.159.8.70.38.xip.io/consumer-api/oauth2/redirect" class="undefined" data-href="https://consumer.159.8.70.38.xip.io/consumer-api/oauth2/redirect">https://consumer.159.8.70.38.xip.io/consumer-api/oauth2/redirect</a>
In AppId, click on Manage Authentication, then Authentication Settings, then enter the Web redirect URL, select the + sign.</p>
</div>
<div class="imageblock data-line-2210">
<div class="content">
<img src="../images/appid-redirect-url.png" alt="Create User registry">
</div>
</div>
</div>
<div class="sect4 data-line-2212">
<h5 id="_create_the_oidc_user_registry">Create the OIDC User Registry</h5>
<div class="paragraph data-line-2214">
<p>We are ready to configure API Connect. In the API Cloud Manager, click on Resources, then User Registries and click on the Create button</p>
</div>
<div class="imageblock data-line-2216">
<div class="content">
<img src="../images/oidc-ur-buttonV10.png" alt="Create User registry">
</div>
</div>
<div class="paragraph data-line-2218">
<p>Select OpenID Connect (OIDC)</p>
</div>
<div class="imageblock data-line-2220">
<div class="content">
<img src="../images/oidc-ur-choiceV10.png" alt="OIDC User Registry">
</div>
</div>
<div class="paragraph data-line-2222">
<p>Enter the following:
&gt; Title: AppId</p>
</div>
<div class="ulist data-line-2225">
<ul>
<li class="data-line-2225">
<p>Summary: AppId as an OIDC provider</p>
</li>
<li class="data-line-2226">
<p>Authorization Endpoint: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorization" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorization">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/authorization</a></p>
</li>
<li class="data-line-2227">
<p>Token Endpoint: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/token</a></p>
</li>
<li class="data-line-2228">
<p>UserInfo Endpoint: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/userinfo" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/userinfo">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/userinfo</a></p>
</li>
<li class="data-line-2229">
<p>JWKS Endpoint: <a href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/publickeys" class="undefined" data-href="https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/publickeys">https://eu-gb.appid.cloud.ibm.com/oauth/v4/62d4566b-f411-4614-8adc-58c090707585/publickeys</a></p>
</li>
<li class="data-line-2230">
<p>Client_id: \&lt;client_id\&gt;</p>
</li>
<li class="data-line-2231">
<p>Client_secret: \&lt;client_secret\&gt;</p>
</li>
</ul>
</div>
<div class="paragraph data-line-2233">
<p>I also changed the User mapping and replaced sub (like subject) by name in to get the right identifier displayed when the user is logged on. You must make sure that this is possible in your environment and that the subject is unique.</p>
</div>
<div class="imageblock data-line-2235">
<div class="content">
<img src="../images/oidc-ur-createV10.png" alt="OIDC User Registry creation">
</div>
</div>
</div>
<div class="sect4 data-line-2237">
<h5 id="_associate_the_oidc_user_registry_to_provide_access_to_an_organization">Associate the OIDC User Registry to provide access to an organization</h5>
<div class="paragraph data-line-2238">
<p>In this case we use the OIDC provider to provide access to the Manager for all the organizations. Notice that it is possible to restrain the use of the User Registry to one or more Organizations.
To make it work we need to make sure that the redirect URL is registered in the OIDC Provider configuration in our case AppId.</p>
</div>
<div class="paragraph data-line-2241">
<p><strong>Hint</strong>: A simple way to get the exact value is to let the authentication fail., and then copy it from the URL.</p>
</div>
<div class="imageblock data-line-2243">
<div class="content">
<img src="../images/oidc-platform-invalid-redirect-url.png%20)." alt="OIDC Invalid Redirect URL">
</div>
</div>
<div class="paragraph data-line-2245">
<p>Example: redirect_uri=https://api.a10cad-par01-b34dfa42ccf328c7da72e2882c1627b1-0001.par01.containers.appdomain.cloud/api/oauth2/redirect&amp;state=b11df288-2f41-4f91-bdb6-010322b7bb97</p>
</div>
<div class="paragraph data-line-2247">
<p>Then add it in AppId:
image::../images/app-id-add-redirect-url.png[AppId add Redirect URL]</p>
</div>
<div class="paragraph data-line-2250">
<p>Now, we can register the user from the OIDC Provider.</p>
</div>
<div class="paragraph data-line-2252">
<p><strong>Notice</strong>: In my case, I like the idea that the owner (of the organization) is using the local registry and all the other users are in the OIDC registry. This allows to have a special user who does not depend on the external system. It can be a real user or not. I understand that some security policies will not allow this everywhere, so it is not applicable all the time.</p>
</div>
<div class="paragraph data-line-2254">
<p>I&#8217;m using the owner of the organization (org1owner), this user is defined in the local User registry). Notice, that we now can also login with AppId</p>
</div>
<div class="imageblock data-line-2256">
<div class="content">
<img src="../images/oidc-lur-login.png" alt="Login with LUR">
</div>
</div>
<div class="paragraph data-line-2258">
<p>This user being the owner of the organization is going to invite another member which is defined in the OIDC Registry.
Click on Member and then Add &#8594; Invite Member</p>
</div>
<div class="imageblock data-line-2261">
<div class="content">
<img src="../images/oidc-org-invite-member.png" alt="OIDC User Registry Invite member">
</div>
</div>
<div class="paragraph data-line-2263">
<p>Specify the email of the user and the roles he will perform.</p>
</div>
<div class="imageblock data-line-2265">
<div class="content">
<img src="../images/oidc-org-invite-member-fill.png" alt="OIDC User Registry Invite member">
</div>
</div>
<div class="paragraph data-line-2267">
<p>The user receives an email, in our case I simply copy the activation link provided</p>
</div>
<div class="imageblock data-line-2269">
<div class="content">
<img src="../images/oidc-org-invite-member-activation-link.png" alt="OIDC Invite Member Activation link">
</div>
</div>
<div class="paragraph data-line-2271">
<p>The link provides the opportunity to sign up to API Connect.
It is important to choose the OIDC Provider registry.</p>
</div>
<div class="imageblock data-line-2274">
<div class="content">
<img src="../images/oidc-org-sign-choose-ur.png" alt="OIDC Org Sign in">
</div>
</div>
<div class="paragraph data-line-2276">
<p>the click on Sign up</p>
</div>
<div class="imageblock data-line-2278">
<div class="content">
<img src="../images/oidc-org-sign-up-start.png" alt="OIDC Org Sign up">
</div>
</div>
<div class="paragraph data-line-2280">
<p>You are redirected to the OIDC Provider login page</p>
</div>
<div class="imageblock data-line-2282">
<div class="content">
<img src="../images/oidc-login-page.png" alt="OIDC Org Login Page">
</div>
</div>
<div class="paragraph data-line-2284">
<p>Enter Credentials and click Sign in</p>
</div>
<div class="paragraph data-line-2286">
<p>You are redirected to API connect and you are now logged in. Notice, that the Account shows the right information because we used name to be mapped to the subject.</p>
</div>
<div class="imageblock data-line-2288">
<div class="content">
<img src="../images/oidc-org-logged-in.png" alt="OIDC Org API Connect home page">
</div>
</div>
</div>
<div class="sect4 data-line-2290">
<h5 id="_associate_the_oidc_user_registry_with_a_catalog">Associate the OIDC User Registry with a Catalog</h5>
<div class="paragraph data-line-2291">
<p>We are going to associate it with the Integration Catalog.
Click on Manage, then on Integration Catalog, then on Settings, then on Onboarding.</p>
</div>
<div class="imageblock data-line-2294">
<div class="content">
<img src="../images/oidc-catalog-onboarding-link.png" alt="OIDC User Registry association to a Catalog">
</div>
</div>
<div class="paragraph data-line-2296">
<p>Click on the Edit button, close to Catalog User Registries, and select AppId.</p>
</div>
<div class="imageblock data-line-2298">
<div class="content">
<img src="../images/oidc-ur-portal-onboarding.png" alt="OIDC User Registry association to a Catalog">
</div>
</div>
<div class="paragraph data-line-2300">
<p>Set as default user registry, click on the three vertical dots, closed to AppId and select Set default.</p>
</div>
<div class="imageblock data-line-2302">
<div class="content">
<img src="../images/oidc-ur-portal-set-default.png" alt="Set the User Registry as the default user registry">
</div>
</div>
<div class="paragraph data-line-2304">
<p>We are ready to test the configuration</p>
</div>
</div>
<div class="sect4 data-line-2306">
<h5 id="_test_the_new_configuration">Test the new configuration</h5>
<div class="paragraph data-line-2307">
<p>Let&#8217;s go to the Integration Developer Portal. In a browser enter the URL of your portal, in my case,  <a href="https://portal.159.8.70.38.xip.io/org1/integration/user/login" class="undefined" data-href="https://portal.159.8.70.38.xip.io/org1/integration/user/login">https://portal.159.8.70.38.xip.io/org1/integration/user/login</a>. The page has changed, you can now see the a new button to authenticate to AppId. Click on the AppId button.</p>
</div>
<div class="imageblock data-line-2309">
<div class="content">
<img src="../images/oidc-portal-signin.png" alt="OIDC Developer Portal Sign in">
</div>
</div>
<div class="paragraph data-line-2311">
<p>You are redirected to the login page of the OIDC Provider. Notice that in my case, it is configured to also provide additional ways of authentication.</p>
</div>
<div class="imageblock data-line-2313">
<div class="content">
<img src="../images/oidc-portal-signin-appid-signin.png" alt="OIDC Developer Portal Sign in">
</div>
</div>
<div class="paragraph data-line-2315">
<p>The user is logged in. Because the user has never logged in to the Portal, it needs to create the consumer organization.
Enter OIDCConsOrg1 for example.</p>
</div>
<div class="imageblock data-line-2318">
<div class="content">
<img src="../images/oidc-portal-consumer-org-creation.png" alt="OIDC Developer Portal Sign in">
</div>
</div>
<div class="paragraph data-line-2320">
<p>Below a sequence diagram explaining the various interactions including the several redirection that have happened under the cover. The OIDC implementation is based on [Hybrid Flow as definied in OpenID Connect Core 1.0](<a href="https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth" class="undefined" data-href="https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth">https://openid.net/specs/openid-connect-core-1_0.html#HybridFlowAuth</a>)</p>
</div>
<div class="imageblock data-line-2322">
<div class="content">
<img src="../images/oidc-portal-seq-diag.png" alt="OIDC Developer Portal Sign in">
</div>
</div>
</div>
</div>
<div class="sect3 data-line-2324">
<h4 id="_oidc_provider_for_an_organisation">OIDC Provider for an organisation</h4>
<div class="paragraph data-line-2325">
<p>In this chapter, we don&#8217;t detail everything because it is very similar to the protection of the Portal with an OIDC provider.
We need to add a redirect URI for the Organization to come back from the OIDC Provider to API Connect.</p>
</div>
<div class="paragraph data-line-2328">
<p>The redirect URI must be the one of the platform endpoint in this case (using an OIDC provider as user registry for the Cloud Manager or API Manager).</p>
</div>
<div class="imageblock data-line-2330">
<div class="content">
<img src="../images/oidc-mgr-redirect.png" alt="OIDC For an organisation Redirect URL in the OIDC Provider">
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2332">
<h3 id="_step_13_testing_the_quality_of_your_api">Step 13 - Testing the quality of your API</h3>
<div class="paragraph data-line-2333">
<p>In this step we are going to see quickly how to use IBM API Connect Test and Monitor. The documentation associated with IBM API Connect Test and Monitor is available at <a href="https://ibm-apiconnect.github.io/test-and-monitor/gettingstarted" class="undefined" data-href="https://ibm-apiconnect.github.io/test-and-monitor/gettingstarted">https://ibm-apiconnect.github.io/test-and-monitor/gettingstarted</a>.
This tool addresses in a no code approach testing the API with a fine granularity in the test and either on demand or with scheduled testing.
This provides capabilities to create tests that are very fined grained, in the sense that you are able to validate API (or group of API) either onDemand or on a regular schedule. This then allows to display functional and performance dashboards to better understand how the API are behaving. This is not for performance testing but quality testing. If an error occur you can receive an email, and deep dive to understand why it failed. It is also a mechanism to validate that all your API are still working if a change was performed to the platform, API, etc &#8230;&#8203;</p>
</div>
<div class="sect3 data-line-2337">
<h4 id="_creating_a_test">Creating a test</h4>
<div class="paragraph data-line-2338">
<p>There are several ways to create a test using: a call, a Postman collection, from scratch.
Using a compose feature
image::../images/test-and-monitor-no-code-generated-test.png[Test and Monitor Create a test]</p>
</div>
</div>
<div class="sect3 data-line-2342">
<h4 id="_running_a_test">Running a test</h4>

</div>
<div class="sect3 data-line-2344">
<h4 id="_scheduling_a_test">Scheduling a test</h4>
<div class="imageblock data-line-2345">
<div class="content">
<img src="../images/test-and-monitor-schedule.png" alt="Test and Monitor Create a schedule">
</div>
</div>
</div>
<div class="sect3 data-line-2347">
<h4 id="_using_the_dashboards">Using the dashboards</h4>
<div class="imageblock data-line-2348">
<div class="content">
<img src="../images/test-and-monitor-api-quality.png" alt="Test and Monitor Using the Quality dashboard">
</div>
</div>
</div>
</div>
<div class="sect2 data-line-2350">
<h3 id="_step_14_cicd_integration">Step 14 - CI/CD integration</h3>
<div class="sect3 data-line-2351">
<h4 id="_managing_the_api_automatically">Managing the API automatically</h4>
<div class="paragraph data-line-2352">
<p>Since APIC is expose API or CLI to perform anything, it is very simple to perform any automatic tasks.</p>
</div>
</div>
<div class="sect3 data-line-2354">
<h4 id="_testing_during_the_build_phase">Testing during the build phase</h4>
<div class="paragraph data-line-2355">
<p>It is possible to create an API Hook in API Connect Test and Monitor.
See [Test and Monitor API Hook](<a href="https://www.ibm.com/support/knowledgecenter/SSMNED_v10/com.ibm.apic.atm.doc/Creating-An-API-Hook.html" class="undefined" data-href="https://www.ibm.com/support/knowledgecenter/SSMNED_v10/com.ibm.apic.atm.doc/Creating-An-API-Hook.html">https://www.ibm.com/support/knowledgecenter/SSMNED_v10/com.ibm.apic.atm.doc/Creating-An-API-Hook.html</a>)
This Hook allows the generation of a report for any tests for example during the build phase.
For example adding an Execute shell block for a build step within a build in Jenkins. Then you can add a JUnit test result report under a Post-build Actions.</p>
</div>
<div class="paragraph data-line-2360">
<p>Below a sample, output in Jenkins
image::../images/test-and-monitor-ci-cd-jenkins-result.png[Test and Monitor Test result in Jenkins]</p>
</div>
<div class="paragraph data-line-2363">
<p>Congratulations. You have completed this Lab!</p>
</div>
</div>
<div class="sect3 data-line-2365">
<h4 id="_acknowledgments">Acknowledgments</h4>
<div class="paragraph data-line-2366">
<p>Thanks to my colleague Philippe Curmin who has done a thorough review of this document.</p>
</div>
</div>
</div>
<div class="sect2 data-line-2368">
<h3 id="_additional_resources">Additional Resources</h3>
<div class="paragraph data-line-2370">
<p>For additional resources please look at the to the following:
- [IBM Middleware User Community](<a href="https://community.ibm.com/community/user/middleware/communities/cloud-integration-home" class="undefined" data-href="https://community.ibm.com/community/user/middleware/communities/cloud-integration-home">https://community.ibm.com/community/user/middleware/communities/cloud-integration-home</a>)
- [IBM API Connect Version 10 documentation](<a href="https://www.ibm.com/support/knowledgecenter/SSMNED_v10/mapfiles/getting_started.html" class="undefined" data-href="https://www.ibm.com/support/knowledgecenter/SSMNED_v10/mapfiles/getting_started.html">https://www.ibm.com/support/knowledgecenter/SSMNED_v10/mapfiles/getting_started.html</a>)
- [Follow us @ibmapiconnect](<a href="https://twitter.com/ibmapiconnect" class="undefined" data-href="https://twitter.com/ibmapiconnect">https://twitter.com/ibmapiconnect</a>)
- [POT API Connect Customization](<a href="https://ibm-apiconnect.github.io/faststart/" class="undefined" data-href="https://ibm-apiconnect.github.io/faststart/">https://ibm-apiconnect.github.io/faststart/</a>)
- [Royal mail portal](<a href="https://developer.royalmail.net/node/2757" class="undefined" data-href="https://developer.royalmail.net/node/2757">https://developer.royalmail.net/node/2757</a>)
- [API Connect Test and Monitor](<a href="https://ibm-apiconnect.github.io/test-and-monitor/" class="undefined" data-href="https://ibm-apiconnect.github.io/test-and-monitor/">https://ibm-apiconnect.github.io/test-and-monitor/</a>)
- [API reference architecture](<a href="https://www.ibm.com/cloud/architecture/architectures/apiArchitecture/reference-architecture" class="undefined" data-href="https://www.ibm.com/cloud/architecture/architectures/apiArchitecture/reference-architecture">https://www.ibm.com/cloud/architecture/architectures/apiArchitecture/reference-architecture</a>)</p>
</div>
<div class="paragraph data-line-2379">
<p>[IBM Cloud]:  <a href="https://cloud.ibm.com" class="undefined" data-href="https://cloud.ibm.com">https://cloud.ibm.com</a>
[IBM Cloud Catalog]: <a href="https://cloud.ibm.com/catalog" class="undefined" data-href="https://cloud.ibm.com/catalog">https://cloud.ibm.com/catalog</a></p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-01-11 19:24:03 +0100
</div>
</div>
</body>
</html>